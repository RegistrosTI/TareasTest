/**
 * ParamQuery Pro v2.0.3
 * 
 * Copyright (c) 2012-2013 Paramvir Dhindsa (http://paramquery.com)
 * Released under Commercial license
 * http://paramquery.com/pro/license
 * 
 */     	
(function(a){a.paramquery=(a.paramquery==null)?{}:a.paramquery;a.paramquery.pqgrid=(a.paramquery.pqgrid==null)?{}:a.paramquery.pqgrid;a.paramquery.xmlToArray=function(d,e){var c=e.itemParent;var g=e.itemNames;var b=[];var f=a(d).find(c);f.each(function(k,l){var j=a(l);var h=[];a(g).each(function(i,m){h.push(j.find(m).text())});b.push(h)});return b};a.paramquery.xmlToJson=function(d,e){var c=e.itemParent;var g=e.itemNames;var b=[];var f=a(d).find(c);f.each(function(n,o){var l=a(o);var k={};for(var m=0,h=g.length;m<h;m++){var p=g[m];k[p]=l.find(p).text()}b.push(k)});return b};a.paramquery.tableToArray=function(h){var i=a(h);var c=[];var f=[];var g=[];var e=[];var b=i.find("tr:first");var d=i.find("tr:eq(1)");b.find("th,td").each(function(p,m){var j=a(m);var r=j.html();var k=j.width();var s="string";var n=d.find("td:eq("+p+")");var l=n.text();var q=n.attr("align");l=l.replace(/,/g,"");if(parseInt(l)==l&&(parseInt(l)+"").length==l.length){s="integer"}else{if(parseFloat(l)==l){s="float"}}var o={title:r,width:k,dataType:s,align:q,dataIndx:p};c.push(o)});i.find("tr").each(function(k,m){if(k==0){return}var l=a(m);var j=[];l.find("td").each(function(n,o){j.push(a.trim(a(o).html()))});f.push(j)});return{data:f,colModel:c}};a.paramquery.formatCurrency=function(h){h=Math.round(h*10)/10;h=h+"";if(h.indexOf(".")==-1){h=h+".0"}var c=h.length;var e=h.substring(0,c-2),g=h.substring(c-2,c),b=e.match(/\d/g).reverse(),d=[];for(var f=0;f<b.length;f++){if(f>0&&f%3==0){d.push(",")}d.push(b[f])}d=d.reverse();e=d.join("");return e+g};a.paramquery.validation={is:function(b,c){if(b=="string"||!b){return true}b=b.substring(0,1).toUpperCase()+b.substring(1,b.length);return this["is"+b](c)},isFloat:function(c){var b=parseFloat(c);if(!isNaN(b)&&b==c){return true}else{return false}},isInteger:function(c){var b=parseInt(c);if(!isNaN(b)&&b==c){return true}else{return false}},isDate:function(c){var b=Date.parse(c);if(!isNaN(b)){return true}else{return false}}}})(jQuery);(function(b){var a={};a.options={curPage:0,totalPages:0,totalRecords:0,msg:"",rPPOptions:[10,20,30,40,50,100],rPP:20};a._regional={strDisplay:"Displaying {0} to {1} of {2} items.",strFirstPage:"First Page",strLastPage:"Last Page",strNextPage:"Next Page",strPage:"Page {0} of {1}",strPrevPage:"Previous Page",strRefresh:"Refresh",strRpp:"Records per page:{0}"};b.extend(a.options,a._regional);a._create=function(){var d=this,c=this.options;this.element.addClass("pq-pager");this.first=b("<button type='button' title='"+c.strFirstPage+"'></button>",{}).appendTo(this.element).button({icons:{primary:"ui-icon-seek-first"},text:false}).bind("click.paramquery",function(e){if(d.options.curPage>1){if(d._trigger("change",e,{curPage:1})!==false){d.option({curPage:1})}}});this.prev=b("<button type='button' title='"+c.strPrevPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-prev"},text:false}).bind("click",function(e){if(d.options.curPage>1){var f=d.options.curPage-1;if(d._trigger("change",e,{curPage:f})!==false){d.option({curPage:f})}}});b("<span class='pq-separator'></span>").appendTo(this.element);this.pageHolder=b("<span class='pq-page-placeholder'></span>").appendTo(this.element);b("<span class='pq-separator'></span>").appendTo(this.element);this.next=b("<button type='button' title='"+this.options.strNextPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-next"},text:false}).bind("click",function(e){var f=d.options.curPage+1;if(d._trigger("change",e,{curPage:f})!==false){d.option({curPage:f})}});this.last=b("<button type='button' title='"+this.options.strLastPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-end"},text:false}).bind("click",function(e){var f=d.options.totalPages;if(d._trigger("change",e,{curPage:f})!==false){d.option({curPage:f})}});b("<span class='pq-separator'></span>").appendTo(this.element);this.rPPHolder=b("<span class='pq-page-placeholder'></span>").appendTo(this.element);this.$refresh=b("<button type='button' title='"+this.options.strRefresh+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-refresh"},text:false}).bind("click",function(e){if(d._trigger("refresh",e)!==false){}});b("<span class='pq-separator'></span>").appendTo(this.element);this.$msg=b("<span class='pq-pager-msg'></span>").appendTo(this.element);this._refresh()};a._refreshPage=function(){var g=this;this.pageHolder.empty();var m=this.options,c=m.strPage,f=c.split(" "),j=[];for(var e=0,h=f.length;e<h;e++){var l=f[e];if(l=="{0}"){j.push("<input type='text' tabindex='0' class='ui-corner-all' />")}else{if(l=="{1}"){j.push("<span class='total'></span>")}else{j.push("<span>",l,"</span>")}}}var d=j.join("");var k=b(d).appendTo(this.pageHolder);this.page=k.filter("input").bind("change",function(i){var n=b(this),o=n.val();if(isNaN(o)||o<1){n.val(m.curPage);return false}o=parseInt(o);if(o>m.totalPages){n.val(m.curPage);return false}if(g._trigger("change",i,{curPage:o})!==false){g.option({curPage:o})}else{n.val(m.curPage);return false}});this.$total=k.filter("span.total")};a._refresh=function(){this._refreshPage();var d=this.$rPP,l=this,s=this.options;this.first.attr("title",s.strFirstPage);this.prev.attr("title",s.strPrevPage);this.next.attr("title",s.strNextPage);this.last.attr("title",s.strLastPage);this.$refresh.attr("title",s.strRefresh);this.rPPHolder.empty();if(s.strRpp){var c=s.rPPOptions,j=s.strRpp;if(j.indexOf("{0}")!=-1){var q=["<select class='ui-corner-all'>"];for(var h=0,m=c.length;h<m;h++){var f=c[h];q.push('<option value="',f,'">',f,"</option>")}q.push("</select>");var e=q.join("");j=j.replace("{0}","</span>"+e);j="<span>"+j+"<span class='pq-separator'></span>"}else{j="<span>"+j+"</span><span class='pq-separator'></span>"}this.$rPP=b(j).appendTo(this.rPPHolder).filter("select").val(s.rPP).change(function(i){var t=b(this).val();if(l._trigger("change",i,{rPP:t})!==false){l.options.rPP=t;return false}})}if(s.curPage>=s.totalPages){this.next.button({disabled:true});this.last.button({disabled:true})}else{this.next.button({disabled:false});this.last.button({disabled:false})}if(s.curPage<=1){this.first.button({disabled:true});this.prev.button({disabled:true})}else{this.first.button({disabled:false});this.prev.button({disabled:false})}this.page.val(s.curPage);this.$total.text(s.totalPages);if(this.options.totalRecords>0){var k=s.rPP;var o=s.curPage;var n=s.totalRecords;var r=(o-1)*k;var p=o*k;if(p>n){p=n}var g=s.strDisplay;g=g.replace("{0}",r+1);g=g.replace("{1}",p);g=g.replace("{2}",n);this.$msg.html(g)}else{this.$msg.html("")}};a._destroy=function(){this.element.empty().removeClass("pq-pager").enableSelection()};a._setOption=function(c,d){if(c=="curPage"||c=="totalPages"){d=parseInt(d)}b.Widget.prototype._setOption.call(this,c,d)};a._setOptions=function(){b.Widget.prototype._setOptions.apply(this,arguments);this._refresh()};b.widget("paramquery.pqPager",a);b.paramquery.pqPager.regional={};b.paramquery.pqPager.regional.en=a._regional;b.paramquery.pqPager.setDefaults=function(d){for(var c in d){a.options[c]=d[c]}b.widget("paramquery.pqPager",a);b(".pq-pager").each(function(f,e){b(e).pqPager("option",d)})}})(jQuery);(function(b){var a={};a.options={length:200,num_eles:3,cur_pos:0,timeout:350,pace:"optimum",direction:"vertical"};a._destroy=function(){this.element.removeClass("pq-scrollbar-vert").enableSelection().removeClass("pq-scrollbar-horiz").unbind("click.pq-scrollbar").empty();this.element.removeData()};a._create=function(){var f=this,d=this.options;var g=this.element.empty();if(d.direction=="vertical"){g.addClass("pq-scrollbar-vert");g.html(["<div class='top-btn pq-sb-btn'></div>","<div class='pq-sb-slider'>","<div class='vert-slider-top'></div>","<div class='vert-slider-bg'></div>","<div class='vert-slider-center'></div>","<div class='vert-slider-bg'></div>","<div class='vert-slider-bottom'></div>","</div>","<div class='bottom-btn pq-sb-btn'></div>"].join(""))}else{g.addClass("pq-scrollbar-horiz");g.width(this.width);g.html(["<div class='left-btn pq-sb-btn'></div>","<div class='pq-sb-slider pq-sb-slider-h'>","<span class='horiz-slider-left'></span><span class='horiz-slider-bg'></span><span class='horiz-slider-center'></span><span class='horiz-slider-bg'></span><span class='horiz-slider-right'></span>","</div>","<div class='right-btn pq-sb-btn'></div>"].join(""))}this.element.disableSelection().bind("click.pq-scrollbar",function(j){if(f.options.disabled){return}if(f.$slider.is(":hidden")){return}if(d.direction=="vertical"){var o=j.pageY;var m=f.element.offset().top;var l=m+d.length;var i=f.$slider.offset().top;var k=i+f.$slider.height();if(o<i&&o>m+17){var p=o-m;f.$slider.css("top",p);f._updateCurPosAndTrigger(j)}else{if(o>k&&o<l-17){f.$slider.css("top",o-m-f.$slider.height());f._updateCurPosAndTrigger(j)}}}else{var n=j.pageX;i=f.$slider.offset().left;k=i+f.$slider.width();if(n<i){f.$slider.css("left",n-f.element.offset().left);f._updateCurPosAndTrigger(j)}else{if(n>k){f.$slider.css("left",n-f.element.offset().left-f.$slider.width());f._updateCurPosAndTrigger(j)}}}});var e="x";if(d.direction=="vertical"){e="y"}this.$slider=b("div.pq-sb-slider",this.element).draggable({axis:e,helper:function(i,j){f._setDragLimits();return this},start:function(i){f.topWhileDrag=null},drag:function(i){f.dragging=true;var j=f.options.pace;if(j=="optimum"){f._setNormalPace(i)}else{if(j=="fast"){f._updateCurPosAndTrigger(i)}}},stop:function(i){f._updateCurPosAndTrigger(i);f.dragging=false;f._refresh()}});function c(i){if(f.options.cur_pos>0){f.options.cur_pos--;f.updateSliderPos();f.scroll(i)}}this.$top_btn=b("div.top-btn,div.left-btn",this.element).click(function(i){if(f.options.disabled){return}c(i);i.preventDefault();return false}).mousedown(function(i){if(f.options.disabled){return}f.mousedownTimeout=window.setTimeout(function(){f.mousedownInterval=window.setInterval(function(){c(i)},50)},f.options.timeout)}).bind("mouseup mouseout",function(i){if(f.options.disabled){return}f._mouseup(i)});function h(i){var j=f.options;if(j.cur_pos<j.num_eles-1){j.cur_pos++}f.updateSliderPos();f.scroll(i)}this.$bottom_btn=b("div.bottom-btn,div.right-btn",this.element).click(function(i){if(f.options.disabled){return}h(i);i.preventDefault();return false}).mousedown(function(i){if(f.options.disabled){return}f.mousedownTimeout=window.setTimeout(function(){f.mousedownInterval=window.setInterval(function(){h(i)},50)},f.options.timeout)}).bind("mouseup mouseout",function(i){if(f.options.disabled){return}f._mouseup(i)});this._refresh()};a._mouseup=function(c){if(this.options.disabled){return}var d=this;window.clearTimeout(d.mousedownTimeout);d.mousedownTimeout=null;window.clearInterval(d.mousedownInterval);d.mousedownInterval=null};a._setDragLimits=function(){var c=this.options;if(c.direction=="vertical"){var d=this.element.offset().top+17;var e=(d+c.length-34-this.slider_length);this.$slider.draggable("option","containment",[0,d,0,e])}else{d=this.element.offset().left+17;e=(d+c.length-34-this.slider_length);this.$slider.draggable("option","containment",[d,0,e,0])}};a._refresh=function(){var c=this.options;if(c.num_eles<=1){this.element.css("display","none")}else{this.element.css("display","")}this._validateCurPos();this.$slider.css("display","");if(c.direction=="vertical"){this.element.height(c.length);this._setSliderBgLength();this.scroll_space=c.length-34-this.slider_length;if(this.scroll_space<4||c.num_eles<=1){this.$slider.css("display","none")}this.updateSliderPos(c.cur_pos)}else{this.element.width(c.length);this._setSliderBgLength();this.scroll_space=c.length-34-this.slider_length;if(this.scroll_space<4||c.num_eles<=1){this.$slider.css("display","none")}this.updateSliderPos(c.cur_pos)}};a._setSliderBgLength=function(){var e=this.options,f=e.length,g=e.num_eles*40+f,d=f-34,c=d*f/g,h=Math.round((c-(8+3+3))/2);if(h<1){h=1}this.slider_length=8+3+3+2*h;if(e.direction=="vertical"){b("div.vert-slider-bg",this.element).height(h);this.$slider.height(this.slider_length)}else{b(".horiz-slider-bg",this.element).width(h);this.$slider.width(this.slider_length)}};a._updateCurPosAndTrigger=function(c,i){var f=this,e=this.options,h=e.direction,j=f.$slider;if(i==null){i=(h=="vertical")?parseInt(j[0].style.top,10):parseInt(j[0].style.left,10)}var g=e.length-34-((h=="vertical")?j[0].offsetHeight:j[0].offsetWidth);var d=(i-17)*(e.num_eles-1)/g;d=Math.round(d);if(e.cur_pos!=d){if(this.dragging){if(this.topWhileDrag!=null){if(this.topWhileDrag<i&&e.cur_pos>d){return}else{if(this.topWhileDrag>i&&e.cur_pos<d){return}}}this.topWhileDrag=i}f.options.cur_pos=d;this.scroll(c)}};a._setNormalPace=function(c){if(this.timer){window.clearInterval(this.timer);this.timer=null}var e=this,d=this.options,f=d.direction;e.timer=window.setInterval(function(){var h=e.$slider;var g=(f=="vertical")?parseInt(h[0].style.top,10):parseInt(h[0].style.left,10);if(e.prev_top==g){e._updateCurPosAndTrigger(c,g);window.clearInterval(e.timer);e.timer=null}e.prev_top=g},20)};a.setNumEles=function(c){this.options.num_eles=c;this.updateSliderPos()};a._validateCurPos=function(){var c=this.options;if(c.cur_pos>=c.num_eles){c.cur_pos=c.num_eles-1}if(c.cur_pos<0){c.cur_pos=0}};a.updateSliderPos=function(){var d=this.options;var c=(this.scroll_space*(d.cur_pos))/(d.num_eles-1);if(d.direction=="vertical"){this.$slider.css("top",17+c)}else{this.$slider.css("left",17+c)}};a.scroll=function(c){var d=this.options;this._trigger("scroll",c,{cur_pos:d.cur_pos,num_eles:d.num_eles})};a._setOption=function(c,d){if(c=="disabled"){if(d==true){this.$slider.draggable("disable")}else{this.$slider.draggable("enable")}}b.Widget.prototype._setOption.call(this,c,d)};a._setOptions=function(){b.Widget.prototype._setOptions.apply(this,arguments);this._refresh()};b.widget("paramquery.pqScrollBar",a)})(jQuery);(function(g){g("body").delegate(".pq-editor-focus","focus",function(){g(".pq-grid").find(".pq-cont").enableSelection()});g("body").delegate(".pq-editor-focus","blur",function(){g(".pq-grid").find(".pq-cont").disableSelection()});var d=function(n){this.that=n;this.hidearrHS1=[];this.offset=null};g.paramquery.cGenerateView=d;var h=d.prototype;h.generateView=function(q){var y=this.that,C=y.options,u=C.virtualX,A=C.numberCell,r=y.colModel,v=y.initH,G=y.finalH,F=C.groupModel,E=parseInt(C.freezeCols),D=parseInt(C.freezeRows),z,M;if(q){var I=this._generateTables(null,null,q);q.$cont.empty();var H=g(I);q.$cont.append(H);if(!y.tables){y.tables=[]}var L=-1;for(var J=0;J<y.tables.length;J++){var p=y.tables[J].cont;if(p==q.$cont[0]){L=J}}if(L==-1){y.tables.push({$tbl:H,cont:q.$cont[0]})}else{y.tables[L].$tbl=H}}else{y._bufferObj_calcInitFinal();var K=y.init;this.init=y.init;var t=y["final"];this["final"]=y["final"];var o=this._generateTables(K,t,q);if(y.$td_edit!=null){y.quitEditMode({silent:true})}y.$cont.empty();if(y.totalVisibleRows===0){y.$cont.append("<div class='pq-cont-inner pq-grid-norows' >"+C.strNoRows+"</div>")}else{if(!u&&(E||A.show)){y.$cont.append("<div class='pq-cont-inner'>"+o+"</div><div class='pq-cont-inner'>"+o+"</div>")}else{y.$cont.append("<div class='pq-cont-inner'>"+o+"</div>")}}var n=y.$cont.children("div");if(n.length==2){var x=g(n[0]);var s=g(n[1]);H=y.$cont.children().children("table");y.$tbl=H;var B=g(H[1]);z=i.call(y,-1,E);x.css({width:z,zIndex:1});M=i.call(y,E,v);s.css({left:z+"px",width:y.$tbl[0].scrollWidth,position:"absolute"});B.css({left:(-1*(M+z))+"px"})}else{H=y.$tbl=y.$cont.children().children("table");var w=g(n[0]);M=i.call(y,E,v);if(!u){H.css({left:"-"+(M)+"px"})}}y._fixTableViewPort();y._trigger("refresh",null,{dataModel:C.dataModel,colModel:r,pageData:(F?y.dataGM:y.data),initV:y.init,finalV:y["final"],initH:v,finalH:G})}};h._generateTables=function(ab,M,T){var N=this.that,U=N.colModel,y=U.length,B=N.options,v=B.virtualX,K=N.initH,Y=N.finalH,V=B.numberCell,ac=B.columnBorders,G=B.rowBorders,r=B.scrollModel,o=B.groupModel,H=N.hidearrHS,D=B.freezeCols,n=parseInt(B.freezeRows),X=false,p=N.outerWidths,z=0,Z=(T)?T.data.length-1:M,P="",Q=o?true:false,C=B.treeModel,ad=(T&&T.data)?T.data:(Q?N.dataGM:(N.data)),R=N.rowIndxOffset;if(!T&&(ab==null||Z==null)){N.$cont.empty();N.$tbl=null;return}if(!T){N._trigger("beforeTableView",null,{pageData:ad,initV:ab,finalV:M,initH:K,finalH:Y,colModel:U})}var s="pq-grid-table ";if(ac){s+="pq-grid-td-border-right "}if(G){s+="pq-grid-td-border-bottom "}var E=["<table class='"+s+"' cellpadding=0 cellspacing=0 >"];this.hidearrHS1=[];if(1===1){E.push("<tr class='pq-row-hidden'>");if(V.show){var t=V.width+1;E.push("<td style='width:"+t+"px;' ></td>")}for(var u=0;u<=Y;u++){if((v||T)&&H[u]){this.hidearrHS1.push(u);continue}var S=U[u];if(S.hidden){continue}t=p[u];E.push("<td style='width:"+t+"px;' pq-top-col-indx="+u+"></td>")}E.push("</tr>")}this.offsetRow=null;for(var z=0;z<=Z;z++){if(z<ab&&z>=n){z=ab}var q=ad[z],W=q,x=Q?(q.rowIndx-R):z,A=(q)?q.pq_hidden:false;if(A){continue}X=false;if(n&&N.lastFrozenRow==z){X=true}if(this.offsetRow==null&&x!=null){N.offsetRow=(z-x)}if(o&&q.groupTitle){this._generateTitleRow(o,q,E,X)}else{if(o&&q.groupSummary){this._generateSummaryRow(q.data,U,E,X)}else{var O=W.pq_detail,I=false;if(O&&O.show){I=true}this._generateRow(W,x,U,E,T,X,I);if(I){this._generateDetailRow(W,x,U,E,T,X)}}}}N.scrollMode=false;E.push("</table>");var J=E.join("");if(T){T.$cont.empty();var w=g(J);T.$cont.append(w);if(!N.tables){N.tables=[]}var F=-1;for(var aa=0;aa<N.tables.length;aa++){var L=N.tables[aa].cont;if(L==T.$cont[0]){F=aa}}if(F==-1){N.tables.push({$tbl:w,cont:T.$cont[0]})}else{N.tables[F].$tbl=w}}else{}return J};h._renderCell=function(q){var v=this.that,s=v.options,A=s.dataModel,p=q.rowIndxPage,x=q.rowIndx,y=q.rowData,E=q.colIndx,u=q.$td,F=q.expandIndx,I=q.expanded,K=q.treeMarginLeft,J=q.isLeaf,r=q.column,t=r.type,B=r.dataIndx,C=y[B],z=q.wrap;if(!y){return}var G;if(t=="checkBoxSelection"){G="<input type='checkbox' "+(C?"checked='checked'":"")+" />"}else{if(t=="detail"){var D=v.options.detailModel;var n=(C&&C.show)?D.expandIcon:D.collapseIcon;G="<div class='ui-icon "+n+"'></div>"}else{if(r.render){G=r.render({data:v.data,dataModel:A,rowData:y,cellData:C,rowIndxPage:p,rowIndx:x,colIndx:E,column:r,dataIndx:B})}else{G=C}}}if(G===""||G==undefined){G="&nbsp;"}var o="pq-td-div";if(z==false){o+=" pq-wrap-text"}var L="";if(B==F){var w="";if(J){w="ui-icon-radio-off"}else{if(I){w="ui-icon-triangle-1-se pq-tree-expand-icon"}else{w="ui-icon-triangle-1-e pq-tree-expand-icon"}}L=["<div class='pq-tree-icon-container' style='width:",K,"px;'>","<div class='ui-icon ",w," pq-tree-icon' ></div></div>"].join("")}var H="<div class='"+o+"'>"+L+G+"</div>";if(u!=undefined){u.html(H)}return H};h._generateRow=function(V,D,U,H,T,X,K){var r="pq-grid-row";if(X){r+=" pq-last-freeze-row"}if(K){r+=" pq-detail-master"}var P=this.that,E=P.options,G=E.freezeCols,W=E.numberCell,F=E.treeModel,ac=E.columnBorders,Z=E.wrap,B=U.length,y=E.virtualX,N=P.initH,aa=P.finalH,R=this.offset,J=P.hidearrHS,ad=E.customData;var Y="pq-grid-cell ";if(!E.wrap||T){Y+="pq-wrap-text "}var C;if(F){var t=F.levelIndx,v=F.leafIndx,ab=F.expandIndx,I=V[v],u=V[t],L=(u+1)*18,n=P._getRowPQData(D,"expanded"),C={rowIndx:D+R,rowIndxPage:D,rowData:V,wrap:Z,customData:ad,treeMarginLeft:L,expandIndx:ab,isLeaf:I,expanded:n}}else{C={rowIndx:D+R,rowIndxPage:D,rowData:V,wrap:Z,customData:ad}}if(E.stripeRows&&(D/2==parseInt(D/2))){r+=" pq-grid-oddRow"}if(V.pq_rowselect){r+=" pq-row-select ui-state-highlight"}var s;var x=V.pq_rowcls;var q=V.pq_cellcls;if(x!=null){r+=" "+x}H.push("<tr pq-row-indx='"+D+"' class='"+r+"' >");if(W.show){H.push(["<td class='pq-grid-number-cell ui-state-default'>","<div class='pq-td-div'>",((T)?"&nbsp;":(D+1)),"</div></td>"].join(""))}for(var w=0;w<=aa;w++){if(w<N&&w>=G&&(y||T)){w=N;if(w>aa){throw ("initH>finalH");break}}var S=U[w],Q=S.dataIndx;if(S.hidden){continue}C.column=S;C.colIndx=w;C.dataIndx=Q;var o=false;if(1===1){var ae=V.pq_cellselect;if(ae){o=ae[Q]}}var O="";var p=Y;if(S.align=="right"){p+=" pq-align-right"}else{if(S.align=="center"){p+=" pq-align-center"}}if(w==G-1&&ac){p+=" pq-last-freeze-col"}if(S.cls){p=p+" "+S.cls}if(o){p=p+" pq-cell-select ui-state-highlight"}if(q){var s=q[Q];if(s){p+=" "+s}}var z="pq-col-indx='"+w+"'";if(T){z+=" pq-dataIndx='"+Q+"'"}var A="";var M=["<td ",A," class='",p,"' style='",O,"' ",z," >",this._renderCell(C),"</td>"].join("");H.push(M)}H.push("</tr>");return H};var j=function(){this.focusSelection=null};var a=j.prototype;a.getFocusSelection=function(){var o=document.activeElement?g(document.activeElement):null,q=this.that,p;if(this instanceof l){if(o&&o.hasClass("pq-grid-row")){var n=q.getRowIndx({$tr:o});n.$tr=o;return n}else{if((p=this.focusSelection)&&this.isSelected(p)){var n=q.getRowIndx(p);n.rowData=p.rowData;return n}}}else{if(this instanceof c){if(o&&o.hasClass("pq-grid-cell")){var n=q.getCellIndices({$td:o});n.$td=o;return n}else{if((p=this.focusSelection)&&this.isSelected(p)){var r=p.rowData;var n=q.getRowIndx({rowData:r});n.rowData=r;n.dataIndx=p.dataIndx;return n}}}}};a.getFirstSelection=function(){var n=this.firstSelection;if(n&&this.isSelected(n)){return n}};a.getLastSelection=function(){var t=this.lastSelection;if(t){var w=this.that,x=this.options,z=x.dataModel,y=x.pageModel,o=y.type,r=t.rowIndx,p=t.rowData,q=w.rowIndxOffset,n=r-q,s=z.data,v=(o=="remote")?n:r,u=s[v];if(p==u&&this.isSelected(t)){return t}else{return false}}else{return null}};a.getLastSelectionCurPage=function(){var n=this.lastSelection;if(n&&this.isSelected(n)){var q=n.rowIndx,o=this.that.options.pageModel;if(o.type){var p=o.curPage,r=o.rPP;if(Math.ceil((q+1)/r)==p){return n}else{return null}}else{return n}}else{return null}};a.getSelection=function(){this.refresh();return this.selection};a.getSelectionCurPage=function(){var r=this.that,t=this.getSelection(),v=[],w=r.options,x=w.dataModel,u=w.pageModel;if(u.type){var s=x.curPage,q=x.rPP;for(var p=0;p<t.length;p++){var n=t[p],o=n.rowIndx;if(Math.ceil((o+1)/q)==s){v.push(n)}}return v}else{return t}};a.setDirty=function(){};var l=function(n){this.that=n;this.options=n.options;this.selection=[];this.isDirty=false};g.paramquery.cRows=l;var b=l.prototype=new j;b._addToDataNotUsed=function(n){var o=this.that.getRowData(n);o.pq_rowselect=true};b.extendSelection=function(v){var r=this.that,o=v.rowIndx,q=r.options.selectionModel.mode,u=v.evt;var t=r.iRows.getFirstSelection();if(t==null){r.setSelection({rowIndx:o});return}if(q!="single"){var n=t.rowIndx,p=n,s=o;if(n>o){p=o;s=n}this.selectRange({initRowIndx:p,finalRowIndx:s,evt:u});this.add({rowIndx:o})}};b.removeAll=function(o){this.refresh();var s=o.raiseEvent,r=this.that,u=(o.offset==null)?r.getRowIndxOffset():o.offset;var t=this.selection.slice(0);for(var p=0;p<t.length;p++){var n=t[p];var q=n.rowIndx;this.remove({rowIndx:q,offset:u})}this.lastSelection=null};b.refresh=function(){this.selection=[];var v=this.that,x=v.options,y=x.dataModel,w=x.pageModel,o=w.type,n=(o=="remote")?true:false,r=v.rowIndxOffset,t=y.data;if(!t){return}for(var s=0,u=t.length;s<u;s++){var p=t[s];if(p.pq_rowselect){var q=(n)?(s+r):s;this.selection.push({rowIndx:q})}}};b.replace=function(r){var q=r.rowIndx,s=(r.offset==null)?this.that.getRowIndxOffset():r.offset,n=q-s,p=r.$tr,o=r.evt;r.offset=s;r.rowIndxPage=n;this.removeAll({raiseEvent:true});this.add(r)};b._add=function(x){var u=this.that,r=x.rowIndx,n=x.rowIndxPage,q=u.rowIndxOffset,r=(r==null)?(n+q):r,n=(n==null)?(r-q):n,p=u.getRowData(x),t=x.$tr,w=x.evt,s=x.skipFocus,o=this.isSelected({rowData:p});x.rowIndxPage=n;if(o==null){return false}else{if(o==false){var v=this._boundRow(x),t=v;p.pq_rowselect=true;u._trigger("rowSelect",w,{rowIndx:r,rowIndxPage:n,rowData:p,$tr:t})}}this.lastSelection={rowIndx:r,rowData:p};if(!s){if(!t||!t.length){t=u.getRow({rowIndxPage:n})}if(t){t=g(t[0]);t.attr("tabindex","0");t.focus();u._fixTableViewPort();this.focusSelection={rowData:p,rowIndx:r}}}if(x.setFirst){this.firstSelection={rowIndx:r,rowData:p}}};b.add=function(p){var t=this.that,s=this.options,q=p.evt;if(typeof p.rowIndx.splice=="function"){var o=p.rowIndx;for(var r=0,n=o.length;r<n;r++){var u={rowIndx:o[r]};u.noTrigger=true;this._add(u)}t._trigger("rowSelect",q,{rowIndx:o,dataModel:s.dataModel})}else{this._add(p)}};b.remove=function(v){var t=this.that,r=v.rowIndx,n=v.rowIndxPage,q=t.rowIndxOffset,r=(r==null)?(n+q):r,n=(n==null)?(r-q):n,p=t.getRowData(v),s=v.$tr,u=v.evt,o=this.isSelected({rowData:p});if(o){var s=t.getRow({rowIndxPage:n});if(s){s.removeClass("pq-row-select ui-state-highlight");s.removeAttr("tabindex")}t._trigger("rowUnSelect",u,{rowIndx:r,rowData:p,$tr:s});this._removeFromData({rowData:p})}};b.indexOf=function(q){this.refresh();var o=q.rowIndx,p=this.selection;for(var n=0;n<p.length;n++){if(p[n].rowIndx==o){return n}}return -1};b.isSelected=function(n){var o=this.that,p=o.getRowData(n);return(p)?((p.pq_rowselect==null)?false:p.pq_rowselect):null};b._removeFromData=function(n){var o=n.rowData;o.pq_rowselect=false};b._boundRow=function(q){var n=q.rowIndxPage,p=this.that,o=(q.$tr==null)?p.getRow({rowIndxPage:n}):q.$tr;if(o==null||o.length==0){return false}o.addClass("pq-row-select ui-state-highlight");return o};b.selectRange=function(x){var r=this.that,p=x.initRowIndx,s=x.finalRowIndx,u=x.evt,t=this.getSelection(),n=t.slice(0);for(var q=0;q<n.length;q++){var o=n[q],w=o.rowIndx;if(w<p||w>s){this.remove({rowIndx:w})}}if(p>s){var v=p;p=s;s=v}for(var w=p;w<=s;w++){this.add({rowIndx:w,skipFocus:true})}};var c=function(n){this.options=n.options;this.that=n;this.selection=[]};var m=c.prototype=new j;m._addToData=function(n){var o=n.dataIndx,p=this.that.getRowData(n);if(!p.pq_cellselect){p.pq_cellselect={}}p.pq_cellselect[o]=true};m.extendSelection=function(z){var w=this.that,n=this.getFirstSelection(),s=z.rowIndx,p=z.colIndx,v=w.options.selectionModel.mode,y=z.evt;if(n==null){w.setSelection({rowIndx:s,colIndx:p});return}var o=n.rowIndx,r=w.getColIndx({dataIndx:n.dataIndx}),t=o,x=s,q=r,u=p;if(o>s){t=s;x=o}if(v=="range"){if(o>s){q=p;u=r}if(s==o&&p<r){q=p;u=r}this.selectRange({initRowIndx:t,initColIndx:q,finalRowIndx:x,finalColIndx:u,evt:y});this.add({rowIndx:s,colIndx:p})}else{if(v=="block"){if(r>p){q=p;u=r}this.selectBlock({initRowIndx:t,initColIndx:q,finalRowIndx:x,finalColIndx:u,evt:y});this.add({rowIndx:s,colIndx:p})}}};m._removeFromData=function(n){var o=n.rowData;if(o&&o.pq_cellselect){delete o.pq_cellselect[n.dataIndx]}};m.removeAll=function(o){this.refresh();var u=o.raiseEvent,t=this.that,n=this.selection.slice(0);for(var r=0;r<n.length;r++){var q=n[r];var s=q.rowIndx,p=q.dataIndx;this.remove({rowIndx:s,dataIndx:p})}this.lastSelection=null};m.isSelected=function(n){var p=this.that,q=p.getRowData(n),o=n.dataIndx,o=(o==null)?p.colModel[n.colIndx].dataIndx:o;if(q==null){return null}if(q.pq_cellselect){if(q.pq_cellselect[o]){return true}}return false};m.refresh=function(){this.selection=[];var w=this.that,z=w.options.dataModel,y=w.options.pageModel,t=z.data,p=y.type,o=(p=="remote")?true:false,s=w.rowIndxOffset;if(!t){return}for(var u=0,v=t.length;u<v;u++){var q=t[u];var n=q.pq_cellselect;if(n){var r=(o)?(u+s):u;for(var x in n){if(n[x]){this.selection.push({rowIndx:r,dataIndx:x})}}}}this.isDirty=false};m.replace=function(r){var p=r.rowIndx,q=r.colIndx,t=(r.offset==null)?this.that.getRowIndxOffset():r.offset,n=p-t,s=r.$td,o=r.evt;r.rowIndxPage=n;r.offset=t;this.removeAll({raiseEvent:true});this.add(r)};m._add=function(z){var w=this.that,u=z.rowIndx,n=z.rowIndxPage,t=w.rowIndxOffset,u=(u==null)?(n+t):u,n=(n==null)?(u-t):n,s=w.getRowData(z),q=z.colIndx,x=z.dataIndx,q=(q==null)?w.getColIndx({dataIndx:x}):q,r=w.colModel[q],x=(x==null)?r.dataIndx:x,v=z.skipFocus,y=z.evt,p=this.isSelected({rowData:s,dataIndx:x});if(p==null){return false}else{if(p==false){var o=w.getCell({rowIndxPage:n,colIndx:q});if(o){o.addClass("pq-cell-select ui-state-highlight")}this._addToData({rowData:s,dataIndx:x});if(!z.noTrigger){w._trigger("cellSelect",y,{rowIndx:u,rowIndxPage:n,colIndx:q,dataIndx:x,column:r,rowData:s})}}}this.lastSelection={rowIndx:u,dataIndx:x,rowData:s};if(!v){if(!o||!o.length){o=w.getCell({rowIndxPage:n,dataIndx:x})}if(o&&o.length){o.attr("tabindex","0");o.focus();w._fixTableViewPort();this.focusSelection={rowData:s,rowIndx:u,dataIndx:x}}}if(z.setFirst){this.firstSelection={rowIndx:u,rowData:s,dataIndx:x}}};m.add=function(o){var s=this.that,r=this.options,p=o.evt;if(typeof o.splice=="function"){for(var q=0,n=o.length;q<n;q++){var t=o[q];t.noTrigger=true;this._add(t)}s._trigger("cellSelect",p,{cells:o,dataModel:r.dataModel})}else{this._add(o)}};m.remove=function(y){var v=this.that,u=y.rowIndx,n=y.rowIndxPage,t=v.rowIndxOffset,u=(u==null)?(n+t):u,n=(n==null)?(u-t):n,s=v.getRowData(y),q=y.colIndx,w=y.dataIndx,q=(q==null)?v.getColIndx({dataIndx:w}):q,r=v.colModel[q],w=(w==null)?r.dataIndx:w,x=y.evt,p=this.isSelected({rowData:s,dataIndx:w});if(p){var o=v.getCell({rowIndxPage:n,colIndx:q});if(o){o.removeClass("pq-cell-select ui-state-highlight");o.removeAttr("tabindex")}v._trigger("cellUnSelect",x,{rowIndx:u,colIndx:q,dataIndx:w,rowData:s});this._removeFromData({rowData:s,dataIndx:w})}};m.indexOf=function(t){this.refresh();var s=t.rowIndx,r=this.that,o=(t.dataIndx==null)?r.colModel[t.colIndx].dataIndx:t.dataIndx;t.dataIndx=o;var n=this.selection;for(var p=0;p<n.length;p++){var q=n[p];if(q.rowIndx==s&&q.dataIndx==o){return p}}return -1};m.selectRange=function(A){var w=this.that,u=A.initRowIndx,r=A.initColIndx,y=A.finalRowIndx,v=A.finalColIndx,o=this.getSelection(),q=o.slice(0);for(var t=0;t<q.length;t++){var s=q[t],z=s.rowIndx,x=s.dataIndx,n=w.getColIndx({dataIndx:x});if(z<u||z>y){this.remove({rowIndx:z,colIndx:n,dataIndx:x})}else{if(z==u&&n<r){this.remove({rowIndx:z,colIndx:n,dataIndx:x})}else{if(z==y&&n>v){this.remove({rowIndx:z,colIndx:n,dataIndx:x})}}}}for(var n=0;n<w.colModel.length;n++){var p=w.colModel[n];if(p.hidden){continue}var x=p.dataIndx;var z=u;do{if(z==u&&n<r){}else{if(z==y&&n>v){break}else{this.add({rowIndx:z,colIndx:n,dataIndx:x,skipFocus:true})}}z++}while(z<=y)}};m.selectBlock=function(B){var x=this.that,v=B.initRowIndx,r=B.initColIndx,z=B.finalRowIndx,w=B.finalColIndx,o=this.getSelection(),q=o.slice(0);for(var u=0;u<q.length;u++){var t=q[u],A=t.rowIndx,y=t.dataIndx,n=x.getColIndx({dataIndx:y});if(n<r||n>w){this.remove({rowIndx:A,dataIndx:y,colIndx:n})}else{if(A<v||A>z){this.remove({rowIndx:A,dataIndx:y,colIndx:n})}}}var s=[];for(var n=r;n<=w;n++){var p=x.colModel[n];var y=p.dataIndx;if(p.hidden){continue}var A=v;do{s.push({rowIndx:A,colIndx:n,dataIndx:y,skipFocus:true});A++}while(A<=z);this.add(s)}};var e=function(n){this.options=n.options;this.that=n};var f=e.prototype;var k={widgetEventPrefix:"pqgrid"};k.options={collapsible:true,colModel:null,columnBorders:true,customData:null,dataModel:{cache:false,location:"local",sorting:"local",sortDir:"up",method:"GET"},direction:"",draggable:false,editable:true,editModel:{cellBorderWidth:1,clicksToEdit:1,filterKeys:true,keyUpDown:true,saveKey:"",select:false},editor:{type:"contenteditable"},validation:{icon:"ui-icon-alert",cls:"ui-state-error"},flexHeight:false,flexWidth:false,freezeCols:0,freezeRows:0,getDataIndicesFromColIndices:true,height:400,hoverMode:"row",minWidth:50,numberCell:{width:30,title:"",resizable:false,minWidth:30,show:true},pageModel:{curPage:1,totalPages:0,rPP:10,rPPOptions:[10,20,50,100]},resizable:false,roundCorners:true,rowBorders:true,scrollModel:{pace:"fast",horizontal:true,lastColumn:"auto",autoFit:false},selectionModel:{type:"row",mode:"range"},showBottom:true,showHeader:true,showTitle:true,showToolbar:true,showTop:true,sortable:true,sql:false,stripeRows:true,title:"&nbsp;",treeModel:null,width:600,wrap:true};k._regional={strAdd:"Add",strDelete:"Delete",strEdit:"Edit",strLoading:"Loading",strNextResult:"Next Result",strNoRows:"No rows to display.",strNothingFound:"Nothing found",strPrevResult:"Previous Result",strSearch:"Search",strSelectedmatches:"Selected {0} of {1} match(es)"};g.extend(k.options,k._regional);k._destroyResizable=function(){if(this.element.data("resizable")){this.element.resizable("destroy")}};k._destroyDraggable=function(){if(this.element.data("draggable")){this.element.draggable("destroy")}};k._disable=function(){if(this.$disable==null){this.$disable=g("<div class='pq-grid-disable'></div>").css("opacity",0.2).appendTo(this.element)}};k._enable=function(){if(this.$disable){this.element[0].removeChild(this.$disable[0]);this.$disable=null}};k._destroy=function(){this._destroyResizable();this._destroyDraggable();this.element.empty();this.element.css("height","");this.element.css("width","");this.element.removeClass("pq-grid ui-widget ui-widget-content ui-corner-all").removeData()};k._findCellFromEvtCoords=function(A){throw ("not in use");if(this.$tbl==null){return null}var y=g(A.target).closest(".pq-editor-border-edit");if(y.length>0){return null}var z=A.pageY-this.$cont.offset().top;var s=A.pageX-this.$cont.offset().left;var r=this.$tbl.find("tr.pq-grid-row");var x=0,o=0,t=0;for(var v=1;v<r.length;v++){if(r[v].offsetTop>z){break}else{x++}}var w=g(r[x]);o=parseInt(w.attr("pq-row-indx"));var n=w.find("td.pq-grid-cell");var x=0,q=false;for(var v=0;v<n.length;v++){var u=n[v];if(u.offsetLeft<s&&u.offsetLeft+u.offsetWidth>s){q=true;break}else{if(u.offsetLeft>s){break}else{x++}}}if(!q){return null}var p=g(n[x]);if(p[0].nodeName.toUpperCase()!="TD"){p=g(A.target).parent("td")}t=parseInt(p.attr("pq-col-indx"));if(isNaN(t)){return null}return{$td:p,rowIndxPage:o,rowIndx:o+this.rowIndxOffset,colIndx:t,dataIndx:this.colModel[t].dataIndx}};k._createIconList=function(){var r=this,t=this.options,o=t.toolbarIcons;if(!o){return}var p="<div class='pq-icon-list'>";for(var q=0;q<o.length;q++){var w=o[q],s=w.iconCls,u=w.title;p+="<span class='pq-icon-holder' title='"+u+"'><span class='ui-icon "+s+"'></span></span>"}p+="</div>";var v=g(p).appendTo(this.$bottom);v.find("span.pq-icon-holder").mouseover(function(x){g(this).addClass("ui-state-hover")}).mouseout(function(x){g(this).removeClass("ui-state-hover")});for(var q=0;q<o.length;q++){var w=o[q],s=w.iconCls,n=w.toolbar;v.find("span."+s).parent(".pq-icon-holder").click(function(x){return function(y){var A=g(this),z=g(x).pqToolbar({a:"b"});if(A.hasClass("ui-state-active")){A.removeClass("ui-state-active")}else{A.addClass("ui-state-active")}}}(n))}};k._createSlidingTop=function(){var r=this,s=this.$top,p=false,q=0,n=g(["<div class='pq-slider-icon' style='z-index:5;' >","<span class='ui-icon ui-icon-circle-triangle-n'></span>","</div>"].join("")).appendTo(s),o=n.children("span");n.mouseover(function(t){n.addClass("ui-state-hover")}).mouseout(function(t){n.removeClass("ui-state-hover")}).click(function(t){var v=r.element,u=r.options;if(p){v.animate({height:q},function(){r.refresh();o.addClass("ui-icon-circle-triangle-n").removeClass("ui-icon-circle-triangle-s");r.$toolbar.pqToolbar("enable")});p=false}else{q=(u.flexHeight)?v[0].offsetHeight:u.height;q=parseInt(q)+"px";v.animate({height:"23px"},function(){o.addClass("ui-icon-circle-triangle-s").removeClass("ui-icon-circle-triangle-n");if(v.hasClass("ui-resizable")){v.resizable("destroy")}r.$toolbar.pqToolbar("disable")});p=true}});this.$collapsible=n};if(g.paramquery.pqg_incr==null){g.paramquery.pqg_incr=0}k._create=function(){var r=this;this.iGenerateView=new d(this);this.iKeyNav=new e(this);var o=r.widgetEventPrefix.toLowerCase();this.element.on(o+"celleditkeydown",function(t,u){return r.iKeyNav.filterKeys(t,u)});this.cols=[];this.widths=[];this.outerWidths=[];this.rowHeight=22;this.hidearr=[];this.hidearrHS=[];this.tables=[];var r=this,q=this.options;this.$tbl=null;this._calcThisColModel();this._refreshSorters();g.paramquery.pqg_incr++;var s=g.paramquery.pqg_incr;this.element.empty().addClass("pq-grid ui-widget ui-widget-content"+(q.roundCorners?" ui-corner-all":"")).append(["<div class='pq-grid-top ui-widget-header",(q.roundCorners?" ui-corner-top":""),"'>","<div class='pq-grid-title",(q.roundCorners?" ui-corner-top":""),"'>&nbsp;</div></div>","<div class='pq-grid-inner' tabindex='",s,"'><div class='pq-grid-right'>","<div class='pq-header-outer ui-widget-header'>","<span class='pq-grid-header ui-state-default'></span><span class='pq-grid-header ui-state-default'></span>","</div>","<div class='pq-cont-right' >","<div class='pq-cont pq-cont-",s,"'></div>","</div>","</div></div>","<div class='pq-grid-bottom ui-widget-header",(q.roundCorners?" ui-corner-bottom":""),"'>","<div class='pq-grid-footer'>&nbsp;</div>","</div>"].join(""));this._trigger("render",null,{dataModel:this.options.dataModel,colModel:this.colModel});this.$top=g("div.pq-grid-top",this.element);this.$title=g("div.pq-grid-title",this.element);if(!q.showTitle){this.$title.css("display","none")}if(q.collapsible){this._createSlidingTop()}this.$toolbar=g("div.pq-grid-toolbar",this.element);this.$grid_inner=g("div.pq-grid-inner",this.element);this.$grid_right=g(".pq-grid-right",this.element);this.$header_o=g("div.pq-header-outer",this.$grid_right);if(!q.showTop){this.$top.css("display","none")}this.$header=g(".pq-grid-header",this.$grid_right);this.$header_left=g(this.$header[0]);this.$header_right=g(this.$header[1]);this.$bottom=g("div.pq-grid-bottom",this.element);if(!q.showBottom){this.$bottom.css("display","none")}this.$footer=g("div.pq-grid-footer",this.element);this.$cont_o=g("div.pq-cont-right",this.$grid_right);this.$cont_fixed=g("div.pq-cont-fixed",this.$grid_right);this.$cont=g("div.pq-cont",this.$grid_right);this.$cont.on("click",function(t){r._onClickCont(t)});this.$cont.on("click",".pq-tree-expand-icon",function(t){return r.cTreeView._onClickTreeExpandIcon(t)});this.$cont.on("click","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onClickCell(t)}});this.$cont.on("click","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onClickRow(t)}});this.$cont.on("contextmenu","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onRightClickCell(t)}});this.$cont.on("contextmenu","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onRightClickRow(t)}});this.$cont.on("dblclick","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onDblClickCell(t)}});this.$cont.on("dblclick","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onDblClickRow(t)}});this.$cont.on("mousedown","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onCellMouseDown(t)}});this.$cont.on("mousedown","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onRowMouseDown(t)}});this.$cont.on("mousemove","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onCellMouseMove(t)}});this.$cont.on("mousemove","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onRowMouseMove(t)}});this.$cont.on("mouseup","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onCellMouseUp(t)}});this.element.on("mouseup",function(t){if(r._trigger("mouseUp",t,{dataModel:r.options.dataModel})==false){return false}});this.$cont.on("mouseenter","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onCellMouseEnter(t,g(this))}});this.$cont.on("mouseenter","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onRowMouseEnter(t,g(this))}});this.$cont.on("mouseleave","td.pq-grid-cell",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onCellMouseLeave(t,g(this))}});this.$cont.on("mouseleave","tr.pq-grid-row",function(t){if(g(t.target).closest(".pq-grid")[0]==r.element[0]){return r._onRowMouseLeave(t,g(this))}});this.$cont.bind("mousewheel DOMMouseScroll",function(t){return r._onMouseWheel(t)});var n=0;this.$hvscroll=g("<div class='pq-hvscroll-square ui-widget-content'></div>").appendTo(this.$grid_inner);this.$vscroll=g("<div class='pq-vscroll'></div>").appendTo(this.$grid_inner);this.prevVScroll=0;this.$vscroll.pqScrollBar({pace:r.options.scrollModel.pace,direction:"vertical",cur_pos:0,scroll:function(t,v){r.scrollMode=true;r.selectCellRowCallback(function(){r.iGenerateView.generateView()});var u;if(t.originalEvent&&t.originalEvent.type=="drag"){u=r._setScrollVNumEles()}else{u=r._setScrollVNumEles(true)}if(u<=1){r._setScrollHLength()}}});var p=0;this.$hscroll=g("<div class='pq-hscroll'></div>").appendTo(this.$grid_inner);this.$hscroll.pqScrollBar({direction:"horizontal",pace:r.options.scrollModel.pace,cur_pos:0,scroll:function(t,u){r.refresh()}});this._refreshGridWidth();this.element.height(q.height);this.disableSelection();if(window.opera){this.$grid_inner.bind("keypress.pq-grid",{that:this},function(t){r._keyPressDown(t)})}else{this.$grid_inner.bind("keydown.pq-grid",{that:this},function(t){r._keyPressDown(t)})}this._refreshOptions();this._refreshTitle();this._refreshDataIndices();this._createSelectedRowsObject();this._createSelectedCellsObject();this.generateLoading();this._initPager();this._refresh();this.refreshDataAndView();var o=r.widgetEventPrefix.toLowerCase();r.element.one(o+"load",function(t,u){r._refresh()})};k._refreshGridWidth=function(){var r=this.options,t;if((r.width+"").indexOf("%")!=-1){var s=this.element.parent();var o=s.width(),v=null;if(o==0){while(s[0].tagName.toUpperCase()!="BODY"){var u=s.parent();if(u[0]==null){v=s;break}else{s=u}}if(v){var p=v.css("position"),n=v.css("left"),q=v.css("top");v.css({position:"absolute",left:"-2000",top:"-2000"}).appendTo(g(document.body));o=this.element.parent().width();v.css({position:p,left:n,top:q})}}var t=parseInt(r.width)*o/100}else{t=r.width}this.element.width(t);this.element.width(this.element.width())};k._onMouseWheel=function(o){if(this.options.flexHeight){return true}var r=this;var q=0;var o=o.originalEvent;if(o.wheelDelta){q=o.wheelDelta/120}else{if(o.detail){q=o.detail*-1/3}}var p=parseInt(r.$vscroll.pqScrollBar("option","cur_pos"));var n=p-q;if(n>=0){r.$vscroll.pqScrollBar("option","cur_pos",p-q).pqScrollBar("scroll")}return false};k._onDblClickCell=function(o){var q=this;var u=g(o.currentTarget);var s=q.getCellIndices({$td:u});var n=s.rowIndxPage,t=q.rowIndxOffset,p=n+t,r=s.colIndx;if(r==null){return}if(q._trigger("cellDblClick",o,{$td:u,rowIndxPage:n,rowIndx:p,colIndx:r,column:q.colModel[r],rowData:q.data[n]})==false){return false}if(q.options.editModel.clicksToEdit>1&&this.isEditableRow({rowIndx:p})&&this.isEditableCell({colIndx:r,rowIndx:p})){q._editCell(u)}};k._onClickCont=function(n){var o=this};k._onClickRow=function(p){var t=this;var s=g(p.currentTarget);var o=parseInt(s.attr("pq-row-indx")),u=t.rowIndxOffset,r=o+u;if(isNaN(o)){return}var n={rowIndx:r,evt:p},q=this.options;if(t._trigger("rowClick",p,{$tr:s,rowIndxPage:o,rowIndx:r,rowData:t.data[o]})==false){return false}return};k._onRightClickRow=function(o){var s=this,r=g(o.currentTarget),n=parseInt(r.attr("pq-row-indx")),t=s.rowIndxOffset,q=n+t;if(isNaN(n)){return}var p=this.options;if(s._trigger("rowRightClick",o,{$tr:r,rowIndxPage:n,rowIndx:q,rowData:s.data[n]})==false){return false}};k._onDblClickRow=function(o){var r=this;var q=g(o.currentTarget);var n=parseInt(q.attr("pq-row-indx")),s=r.getRowIndxOffset(),p=n+s;if(r._trigger("rowDblClick",o,{$tr:q,rowIndxPage:n,rowIndx:p,rowData:r.data[n]})==false){return false}};k._isValid=function(C){var v=this,x=C.rowData,E=g.trim(C.value),q=C.column,B=q.dataIndx,A=this.options.validation,p=q.validations;if(p&&p.length>0){for(var F=0;F<p.length;F++){var D=p[F],D=g.extend({},A,D),r=D.type,t=D.msg,t=t?t:"&nbsp;",K=D.icon,o=D.cls,o=o?o:"",H="padding:3px 10px;"+D.style,z=D.css,s=true,J={valid:false,msg:t,dataIndx:B},y=D.value;if(r=="minLen"&&E.length<y){s=false}else{if(r=="maxLen"&&E.length>y){s=false}else{if(r=="gt"&&E<=y){s=false}else{if(r=="gte"&&E<y){s=false}else{if(r=="lt"&&E>=y){s=false}else{if(r=="lte"&&E>y){s=false}else{if(r=="regexp"&&(new RegExp(y)).test(E)==false){s=false}else{if(typeof r=="function"){var G={column:q,value:E,rowData:x,msg:t};if(r.call(v.element,G)==false){s=false;if(G.msg!=t){t=G.msg}}}}}}}}}}if(!s){var w=this.getRowIndx({rowData:x}).rowIndx;if(w!=null){this.goToPage({rowIndx:w});this.scrollRow({rowIndx:w});this.editCell({rowIndx:w,dataIndx:B})}var n=this.getEditCell();if(n&&n.$cell){var u=n.$cell;u.attr("title",t);try{u.tooltip("destroy")}catch(I){}u.tooltip({position:{my:"left top",at:"right top"},content:function(){var M=g(this),L=(K=="")?"":("<span class='ui-icon "+K+" pq-tooltip-icon'></span>");return L+t},open:function(M,N){if(o){N.tooltip.addClass(o)}if(H){var L=N.tooltip.attr("style");N.tooltip.attr("style",L+";"+H)}if(z){N.tooltip.css(z)}}}).tooltip("open");u.find(".pq-editor-focus").focus()}return J}}}return{valid:true}};k.isValid=function(q){var s=q.rowList,n=this.getRowData(q),v=q.dataIndx;if(v==null){var p=this.colModel;for(var r=0,u=p.length;r<u;r++){var o=p[r],t=o.hidden;if(t){continue}var v=o.dataIndx,w=n[v],x=this._isValid({rowData:n,value:w,column:o});if(!x.valid){return x}}}else{var o=this.getColumn({dataIndx:v}),w=(q.value===undefined)?n[v]:q.value,x=this._isValid({rowData:n,value:w,column:o});if(!x.valid){return x}}return{valid:true}};k.isEditableRow=function(n){var p=this.options,o=p.editable;if(o!=null){if(typeof o=="function"){var q=n.rowIndx,r=p.dataModel.data[q];return o.call(this.element,{rowData:r,rowIndx:q})}else{return o}}else{return true}};k.isEditableCell=function(n){var t=n.colIndx,o=n.dataIndx,t=(t==null)?this.getColIndx({dataIndx:o}):t,q=this.colModel[t],o=(o==null)?q.dataIndx:o,p=q.editable;if(n.checkVisible&&q.hidden){return false}if(p!=null){if(typeof p=="function"){var r=n.rowIndx,s=this.getRowData(n);return p.call(this.element,{rowIndx:r,rowData:s,column:q,dataIndx:o})}else{return p}}else{return true}};k._getRowPQData=function(n,o,p){var p=(p==null)?this.data[n]:p;return p?p[o]:null};k._setRowPQData=function(o,n,q){var q=(q==null)?this.data[o]:q;if(!q){return}for(var p in n){q[p]=n[p]}};k._onCellMouseDown=function(o){var p=this;var q=g(o.currentTarget);var n=p.getCellIndices({$td:q});n.$td=q;n.dataModel=p.options.dataModel;if(p._trigger("cellMouseDown",o,n)==false){return false}return true};k._onRowMouseDown=function(o){var q=this;var p=g(o.currentTarget);var n=q.getRowIndx({$tr:p});n.$tr=p;n.dataModel=q.options.dataModel;if(q._trigger("rowMouseDown",o,n)==false){return false}return true};k._onCellMouseEnter=function(n,p){var q=p,o=this;if(o._trigger("cellMouseEnter",n,{$td:q,dataModel:o.options.dataModel})==false){return false}if(o.options.hoverMode=="cell"){o.highlightCell(q)}return true};k._onRowMouseEnter=function(o,s){var r=s,q=this;var p=q.getRowIndx({$tr:r});var n=p.rowIndxPage;if(q._trigger("rowMouseEnter",o,{$tr:r,dataModel:q.options.dataModel})==false){return false}if(q.options.hoverMode=="row"){q.highlightRow(n)}return true};k._onCellMouseLeave=function(n,p){var q=p,o=this;if(o._trigger("cellMouseLeave",n,{$td:q,dataModel:o.options.dataModel})==false){return false}if(o.options.hoverMode=="cell"){o.unHighlightCell(q)}return true};k._onRowMouseLeave=function(o,s){var r=s,q=this;var p=q.getRowIndx({$tr:r});var n=p.rowIndxPage;if(q._trigger("rowMouseLeave",o,{$tr:r,dataModel:q.options.dataModel})==false){return false}if(q.options.hoverMode=="row"){q.unHighlightRow(n)}return true};k._onCellMouseMove=function(o){var p=this;var q=g(o.currentTarget);var n=p.getCellIndices({$td:q});n.$td=q;n.dataModel=p.options.dataModel;if(p._trigger("cellMouseMove",o,n)==false){return false}return true};k._onRowMouseMove=function(o){var q=this;var p=g(o.currentTarget);var n=q.getRowIndx({$tr:p});n.$tr=p;n.dataModel=q.options.dataModel;if(q._trigger("rowMouseMove",o,n)==false){return false}return true};k._onCellMouseUp=function(o){var p=this;var q=g(o.currentTarget);var n=p.getCellIndices({$td:q});n.$td=q;n.dataModel=p.options.dataModel;if(p._trigger("cellMouseUp",o,n)==false){return false}return true};k._onClickCell=function(z){var u=this,x=this.options,r=this.colModel,w=x.editModel,y=x.selectionModel;var o=g(z.currentTarget);var A=u.getCellIndices({$td:o});var n=A.rowIndxPage,t=u.rowIndxOffset,s=n+t,p=A.colIndx;A.rowIndx=s;if(p==null){return}var q=r[p],v=q.dataIndx;A.dataIndx=v;A.evt=z;if(u._trigger("cellClick",z,{$td:o,rowIndxPage:n,rowIndx:s,colIndx:p,dataIndx:v,column:q,rowData:u.data[n]})==false){return false}if(w.clicksToEdit==1&&this.isEditableRow({rowIndx:s})&&this.isEditableCell({colIndx:p,rowIndx:s})){window.setTimeout(function(){u.editCell(A)},0);return}};k._onRightClickCell=function(w){var o=g(w.currentTarget);var z=this.getCellIndices({$td:o});var u=this,n=z.rowIndxPage,s=this.rowIndxOffset,t=n+s,p=z.colIndx,r=this.colModel,y=this.options,x=y.DM;if(p==null){return}var q=r[p],v=q.dataIndx;if(this._trigger("cellRightClick",w,{$td:o,rowIndxPage:n,rowIndx:t,colIndx:p,dataIndx:v,column:q,rowData:u.data[n]})==false){return false}};k.highlightCell=function(n){n.addClass("pq-grid-cell-hover ui-state-hover")};k.unHighlightCell=function(n){n.removeClass("pq-grid-cell-hover ui-state-hover")};k.highlightRow=function(o){if(isNaN(o)){}else{var n=this.getRow({rowIndxPage:o});if(n){n.addClass("pq-grid-row-hover ui-state-hover")}}};k.unHighlightRow=function(o){if(isNaN(o)){}else{var n=this.getRow({rowIndxPage:o});if(n){n.removeClass("pq-grid-row-hover ui-state-hover")}}};k._createSelectedRowsObject=function(){this.iRows=new l(this)};k._createSelectedCellsObject=function(){this.iCells=new c(this)};k._getCreateEventData=function(){return{dataModel:this.options.dataModel,data:this.data,colModel:this.options.colModel}};k._refreshOptions=function(){this._refreshDataOptions()};k._refreshDataOptions=function(){};k.enableSelection=function(){this.$cont.enableSelection()};k.disableSelection=function(){this.$cont.disableSelection();this.$header.find("tr.pq-grid-title-row").disableSelection()};k._isEditCell=function(p){var n=g(p.target);var o=n.closest("div.pq-editor-border-edit");if(o&&o.length>0){return true}return false};k._findCellFromEvt=function(o){var n=g(o.target);var q=n.closest(".pq-grid-cell");if(q==null||q.length==0){return{rowIndxPage:null,colIndx:null,$td:null}}else{var p=this.getCellIndices({$td:q});p.$td=q;return p}};k._initPager=function(){var n=this.options.pageModel;var o=this;var p={rPP:n.rPP,rPPOptions:n.rPPOptions,change:function(q,s){o.quitEditMode();var r=o.options.pageModel;if(s.curPage!=undefined){r.prevPage=r.curPage;r.curPage=s.curPage}if(s.rPP!=undefined){r.rPP=s.rPP}if(r.type=="remote"){o.remoteRequest()}else{o.refreshDataFromDataModel();o._refresh()}},refresh:function(q){o.refreshDataAndView()}};if(n.type){this.$footer.pqPager(p)}else{}};k._initDataNotUsed=function(){var o=this;var n=this.options.dataModel;if(n==undefined){throw ("dataModel not found.")}this._initPager();if(n.location=="remote"){var o=this;this.generateLoading();this.remoteRequest()}else{this.refreshDataFromDataModel()}};k._refreshHideArrHS=function(){var s=this,o=this.colModel,q=s.hidearrHS,r=s.initH,u=s.finalH,t=parseInt(this.options.freezeCols);for(var p=0;p<t;p++){q[p]=false}for(var p=t;p<r;p++){q[p]=true}for(var p=r;p<=u;p++){q[p]=false}for(var p=u+1,n=o.length;p<n;p++){q[p]=true}};k.generateLoading=function(){if(this.$loading){this.$loading.remove()}this.$loading=g("<div class='pq-loading'></div>").appendTo(this.element);g(["<div class='pq-loading-bg'></div><div class='pq-loading-mask ui-state-highlight'><div>",this.options.strLoading,"...</div></div>"].join("")).appendTo(this.$loading);this.$loading.find("div.pq-loading-bg").css("opacity",0.2)};k._refreshLoadingString=function(){this.$loading.find("div.pq-loading-mask").children("div").html(this.options.strLoading)};k.showLoading=function(){if(this.showLoadingCounter==null){this.showLoadingCounter=0}this.showLoadingCounter++;this.$loading.show()};k.hideLoading=function(){if(this.showLoadingCounter>0){this.showLoadingCounter--}if(!this.showLoadingCounter){this.$loading.hide()}};k.refreshDataFromDataModel=function(){this._trigger("beforeRefreshData",null,{});var q=this.options,p=q.dataModel,s=q.pageModel,r=p.data,o=s.type;this.rowIndxOffset=0;if(r==null||r.length==0){if(o){s.curPage=0;s.totalPages=0;s.totalRecords=0}this.data=r;return}if(o&&o=="local"){s.totalRecords=r.length;s.totalPages=Math.ceil(r.length/s.rPP);if(s.curPage>s.totalPages){s.curPage=s.totalPages}if(s.curPage<1&&s.totalPages>0){s.curPage=1}var u=(s.curPage-1)*s.rPP;var n=s.curPage*s.rPP;if(n>r.length){n=r.length}this.data=r.slice(u,n)}else{if(o=="remote"){var t=Math.ceil(s.totalRecords/s.rPP);s.totalPages=t;if(t&&!s.curPage){s.curPage=1}var n=s.rPP;if(n>r.length){n=r.length}this.data=r.slice(0,n)}else{this.data=r.slice(0)}}if(o=="local"||o=="remote"){this.rowIndxOffset=(s.rPP*(s.curPage-1))}};g.paramquery.filter=function(){var n={begin:{text:"Begins With",TR:true},contain:{text:"Contains",TR:true},notcontain:{text:"Does not contain",TR:true},equal:{text:"Equal To",TR:true},notequal:{text:"Not Equal To",TR:true},empty:{text:"Empty",TR:false},notempty:{text:"Not Empty",TR:false},end:{text:"Ends With",TR:true},less:{text:"Less Than",TR:true},great:{text:"Great Than",TR:true}};return{conditions:n,getConditions:(function(){var o=[];for(var p in n){o.push(p)}return o})(),getTRConditions:(function(){var o=[];for(var p in n){if(n[p].TR){o.push(p)}}return o})(),getWTRConditions:(function(){var o=[];for(var p in n){if(!n[p].TR){o.push(p)}}return o})()}}();k.getQueryStringSort=function(){var q=this.sorters,t="",r=this.options.sql;if(r){for(var p=0;p<q.length;p++){var s=q[p],o=s.dataIndx,n=s.dir=="up"?"asc":"desc";t+=(p>0?", ":"")+o+" "+n}return t}else{if(q.length){return JSON.stringify(q)}else{return""}}};k.getQueryStringCRUD=function(){return""};k.getQueryStringFilter=function(){var w=this.options,z=w.sql?true:false,r=w.filterModel,n=r.mode,p=this.getFilterData(),x=g.paramquery.filter.getTRConditions,o="";if(r&&r.on&&p){if(z){o=[];for(var s=0;s<p.length;s++){var u=p[s],q=u.condition,v=u.dataIndx,y=g.trim(u.value);if(q==="contain"){o.push(v+" like '%"+y+"%'")}else{if(q==="notcontain"){o.push(v+" not like '%"+y+"%'")}else{if(q==="begin"){o.push(v+" like '"+y+"%'")}else{if(q==="end"){o.push(v+" like '%"+y+"'")}else{if(q==="equal"){o.push(v+"='"+y+"'")}else{if(q==="notequal"){o.push(v+"!='"+y+"'")}else{if(q==="empty"){o.push("isnull("+v+",'')=''")}else{if(q==="notempty"){o.push("isnull("+v+",'')!=''")}else{if(q==="less"){o.push(v+"<'"+y+"'")}else{if(q==="great"){o.push(v+">'"+y+"'")}}}}}}}}}}}o=o.join(" "+n+" ")}else{if(p.length){var t={mode:n,data:p};o=JSON.stringify(t)}else{o=""}}}return o};k.remoteRequest=function(B){if(this.loading){this.xhr.abort()}var u=this,n="",p="",v=this.options,D=this.colModel,C=v.dataModel,y=v.pageModel;if(typeof C.getUrl=="function"){var x={colModel:D,dataModel:C,groupModel:v.groupModel,filterModel:v.filterModel};var s=C.getUrl.call(this.element,x);if(s&&s.url){n=s.url}if(s&&s.data){p=s.data}}else{if(typeof C.url=="string"){n=C.url;var w={},A={},q={};if(C.sorting=="remote"){var z=this.getQueryStringSort();if(z){w={pq_sort:z}}}if(y.type=="remote"){q={pq_curpage:y.curPage,pq_rpp:y.rPP}}var r=this.getQueryStringFilter();if(r){A={pq_filter:r}}var o=C.postData,t=C.postDataOnce;if(o&&typeof o=="function"){o=o.call(this.element,{colModel:D,dataModel:C})}p=g.extend({pq_datatype:C.dataType},A,q,w,o,t)}}if(!n){return}this.loading=true;this.showLoading();this.xhr=g.ajax({url:n,dataType:C.dataType,async:true,cache:C.cache,type:C.method,data:p,beforeSend:function(F,E){if(typeof C.beforeSend=="function"){return C.beforeSend(F,E)}},success:function(E,I,G){var F=false;if(typeof C.getData=="function"){var H=C.getData(E,I,G);C.data=H.data;if(y.type){if(y.type=="remote"){if(H.curPage){y.curPage=H.curPage}if(H.totalRecords){y.totalRecords=H.totalRecords}}}if(C.sorting=="local"&&u.sorters&&u.sorters.length>0){u._refreshSortingDataAndView({sorting:true})}else{u._onDataAvailable();u.refreshDataFromDataModel();u._refreshViewAfterDataSort()}}else{throw ("getData callback not found!")}u.hideLoading();u.loading=false;u._trigger("load",null,{dataModel:u.options.dataModel,colModel:D,data:u.data});if(typeof B=="function"){B()}},error:function(E,G,F){u.hideLoading();u.loading=false;if(typeof C.error=="function"){C.error(E,G,F)}else{if(F!="abort"){throw ("Error : "+F)}}}})};k._fixFireFoxContentEditableIssue=function(){if(window.postMessage){}};k.selectCellRowCallback=function(n){var o=this;n.call(o);if(this.options.flexHeight){this.setGridHeightFromTable()}if(this.options.flexWidth){this._setGridWidthFromTable()}};k._refreshTitle=function(){this.$title.html(this.options.title)};k._refreshDraggable=function(){if(this.options.draggable){this.$title.addClass("draggable");this.element.draggable({handle:this.$title,start:function(n,o){}})}else{this._destroyDraggable()}};k._refreshResizable=function(){var n=this;if(this.options.resizable){this.element.resizable({helper:"ui-state-highlight",delay:0,start:function(o,p){g(p.helper).css({opacity:0.5,background:"#ccc",border:"1px solid steelblue"})},resize:function(o,p){},stop:function(o,p){n.options.height=n.element.height();n.options.width=n.element.width();n._refresh();n.element.css("position","relative")}})}else{this._destroyResizable()}};k.refresh=function(n){if(n&&n.header===false){this.refreshHeaderView=false}this._refresh();this.refreshHeaderView=null};k._refreshDataIndices=function(){if(this.options.getDataIndicesFromColIndices==false){return}var n=this.colModel,q=n.length;for(var o=0;o<q;o++){var p=n[o];if(p.dataIndx==null){p.dataIndx=o}}};k.refreshView=function(){if(this.$td_edit!=null){this.quitEditMode()}this.refreshDataFromDataModel();this._refresh()};k._refresh=function(){var n=this;this._refreshGridWidth();this._refreshDataIndices();this._refreshResizable();this._refreshDraggable();this._refreshWidths();this._computeOuterWidths(true);this._setScrollHNumEles();this._bufferObj_calcInitFinalH();this._refreshHideArrHS();if(this.refreshHeaderView!==false){this._createHeader()}else{this.refreshHeaderView=null}this._refreshHeaderSortIcons();this._setInnerGridHeight();this._setRightGridHeight();this.selectCellRowCallback(function(){n.iGenerateView.generateView();n._computeOuterWidths()});this._setScrollHLength();this._setScrollVLength();this._setScrollVNumEles(true);this._setScrollHLength();this._setScrollHVLength();this._refreshPager();this._refreshFreezeLine();this.disableSelection();this.options.dataModel.postDataOnce=undefined};k._setScrollHVLength=function(){if(this.$hscroll.is(":hidden")){this.$hvscroll.css("visibility","hidden")}};k._refreshPager=function(){var q=this.options,p=q.pageModel,o=this.$footer,n=p.type?true:false,s=p.rPP,t=p.totalRecords;if(n){var r=q.pageModel;if(o.hasClass("pq-pager")==false){this._initPager()}o.pqPager("option",r);if(t>s){this.$bottom.css("display","")}}else{if(o.hasClass("pq-pager")){o.pqPager("destroy")}if(q.showBottom){this.$bottom.css("display","")}else{this.$bottom.css("display","none")}}};k._refreshViewAfterDataSort=function(){this._refresh()};k.refreshSortingDataAndView=function(){this._refreshSortingDataAndView({sorting:true})};k._addRowsData=function(t){var s=t.data,r=this.options.dataModel.data,p=t.rowIndx;if(r==null){r=[]}if(p==null){for(var o=0,n=s.length;o<n;o++){var q=s[o];r.push(q)}}else{if(p<r.length){for(var o=0,n=s.length;o<n;o++){var q=s[o];r.splice(p,0,q);p++}}else{return false}}return true};k.addRows=function(n){if(this._addRowsData(n)){this.refreshDataFromDataModel();this.refresh();return true}else{return false}};k.refreshDataAndView=function(p){var n=this.options.dataModel,o=(p&&p.keepSelection!=null)?p.keepSelection:true;if(p&&p.header===false){this.refreshHeaderView=false}this._refreshSorters();if(n.location=="remote"){this.remoteRequest()}else{this._refreshSortingDataAndView({keepSelection:o,sorting:true})}};k.getColIndx=function(r){var p=r.dataIndx;if(p===undefined){throw ("dataIndx NA")}var o=this.colModel;for(var q=0,n=o.length;q<n;q++){if(o[q].dataIndx==p){return q}}};k.getColumn=function(s){if(s.dataIndx===undefined){throw ("dataIndx N/A")}var p=s.dataIndx;var o=this.colModel;for(var q=0,n=o.length;q<n;q++){var r=o[q];if(r.dataIndx==p){return r}}return null};k._refreshSortingDataAndView=function(t){var s=t.sorting,q=t.fn,p=t.keepSelection,o=this.options.dataModel;var n=o.sortDir;var r=this;if(s==true){if(o.sorting=="remote"){this.remoteRequest(q)}else{this._onDataAvailable();if(r.$td_edit!=null){r.quitEditMode()}this._sortLocalData(o.data);this.refreshDataFromDataModel();r._refreshViewAfterDataSort();if(typeof q=="function"){q()}}}else{if(o.location=="remote"){this.remoteRequest(q)}else{if(this.data==null){this.refreshDataFromDataModel()}r._refreshViewAfterDataSort();if(typeof q=="function"){q()}}}};k._onDataAvailable=function(){};k._computeOuterWidths=function(p){var s=this.options,r=s.columnBorders,o=s.numberCell,n=this.colModel,u=n.length;for(var q=0;q<u;q++){var t=n[q];this.outerWidths[q]=parseInt(t.width)+((r)?1:0)}if(o.show){this.numberCell_outerWidth=o.width+1}return};k._setOption=function(n,o){if(n=="height"){this.element.height(o);this._super.call(this,n,o)}else{if(n=="width"){this._super.call(this,n,o);this._refreshGridWidth()}else{if(n=="title"){this._super.call(this,n,o);this._refreshTitle()}else{if(n=="roundCorners"){if(o){this.element.addClass("ui-corner-all");this.$top.addClass("ui-corner-top");this.$bottom.addClass("ui-corner-bottom")}else{this.element.removeClass("ui-corner-all");this.$top.removeClass("ui-corner-top");this.$bottom.removeClass("ui-corner-bottom")}}else{if(n=="freezeCols"){if(!isNaN(o)&&o>=0&&parseInt(o)<=this.colModel.length-2){this.options.freezeCols=parseInt(o);this._refreshFreezeLine();this._setScrollHLength();this._super.call(this,n,o)}}else{if(n=="resizable"){this._super.call(this,n,o)}else{if(n=="scrollModel"){var p=o;for(var n in p){this.options.scrollModel[n]=p[n]}}else{if(n=="dataModel"){this._super.call(this,n,o)}else{if(n=="pageModel"){this._super.call(this,n,o)}else{if(n==="selectionModel"){var p=o;for(var n in p){this.options.selectionModel[n]=p[n]}}else{if(n==="colModel"){this._super.call(this,n,o);this._calcThisColModel();this._refresh()}else{if(n==="disabled"){if(o===true){this._disable()}else{this._enable()}}else{if(n==="numberCell"){this._super.call(this,n,o)}else{if(n==="customData"){this._super.call(this,n,o)}else{if(n==="strLoading"){this._super.call(this,n,o);this._refreshLoadingString()}else{if(n==="showTop"){if(o===true){this.$top.css("display","")}else{this.$top.css("display","none")}}else{if(n==="showTitle"){if(o===true){this.$title.css("display","")}else{this.$title.css("display","none")}}else{if(n==="showToolbar"){if(o===true){this.$toolbar.css("display","")}else{this.$toolbar.css("display","none")}}else{if(n==="collapsible"){if(o===true){if(!this.$collapsible){this._createSlidingTop()}this.$collapsible.css("display","")}else{if(this.$collapsible){this.$collapsible.css("display","none")}}}else{if(n==="showBottom"){if(o===true){this.$bottom.css("display","")}else{this.$bottom.css("display","none")}}else{this._super.call(this,n,o)}}}}}}}}}}}}}}}}}}}}};k._setOptions=function(){this._super.apply(this,arguments)};k._generateCellRowOutline=function(v){var r=v.$td,D=v.$tr,B=v.rowIndxStart,z=this.options.editModel.cellBorderWidth,A=v.colIndxStart,y=v.rowIndxEnd,x=v.colIndxEnd,s=this;if(D){var t=s._calcRightEdgeCol(s.colModel.length-1);t-=4;var C=D[0].offsetHeight-4;var u=g(D[0].offsetParent);var n=u[0].offsetParent;var E=D[0].offsetLeft+u[0].offsetLeft;var w=D[0].offsetTop+u[0].offsetTop;s._generateCellHighlighter(n,E,w,t,C)}else{if(r){var u=g(r[0].offsetParent);var n=u[0].offsetParent;var t=r[0].offsetWidth-(z?(z*2):1);var C=r[0].offsetHeight-(z?(z*2):1);var E=r[0].offsetLeft+u[0].offsetLeft;var w=r[0].offsetTop+u[0].offsetTop-this.$cont.scrollTop();s._generateCellHighlighter(n,E,w,t,C,r)}else{if(B!=null){throw ("checking whether used");var u=this.$tbl;var n=this.$cont;var C=0,t=0;if(B<this.init){B=this.init}if(y>this["final"]){y=this["final"]}if(B>y){return}var o=this.getCell({rowIndxPage:B,colIndx:A});var q=this.getCell({rowIndxPage:y,colIndx:x});var E=o[0].offsetLeft+u[0].offsetLeft;var w=o[0].offsetTop+u[0].offsetTop;var t=q[0].offsetLeft+q[0].offsetWidth-o[0].offsetLeft-4;var C=q[0].offsetTop+q[0].offsetHeight-o[0].offsetTop-4;var p=1;s._generateCellHighlighter(n,E,w,t,C,p)}}}};k._removeCellRowOutline=function(n){if(n&&n.old&&this.$div_focus_old){var o=this.$div_focus_old.find(".pq-editor-focus");if(o[0]&&o[0]==document.activeElement){throw ("assert failed")}this.$div_focus_old.remove();this.$div_focus_old=null}else{if(this.$div_focus){var o=this.$div_focus.find(".pq-editor-focus");if(o[0]==document.activeElement){o.blur()}this.$div_focus.remove();this.$div_focus=null}}};k._generateCellHighlighter=function(q,r,t,o,n,u){var p=this.options.editModel.cellBorderWidth,s=this.$div_focus;if(s){this.$div_focus_old=s}this.$div_focus=g("<div class='pq-editor-border'></div>").appendTo(this.$cont_o);this.$div_focus.css({left:r,top:t,height:n,width:o,borderWidth:p})};k._onHeaderCellClick=function(t){var s=this,r=s.colModel[t],q=this.options,p=q.dataModel,o=r.dataIndx,n=r.dataType;if(s._trigger("headerCellClick",null,{dataModel:p,data:s.data,dataIndx:o})==false){return}if(!q.sortable){return}if(r.sortable==false){return}if(s._trigger("beforeSort",null,{dataModel:p,column:r,dataIndx:o})==false){return}this._refreshSorters(o);s._refreshSortingDataAndView({sorting:true,keepSelection:true,fn:function(){s._trigger("sort",null,{dataModel:p,column:r,dataIndx:o})}})};k._refreshSorters=function(o){var n=this.options.dataModel,p=[];if(o!=null){if(n.sortIndx==o){n.sortDir=(n.sortDir=="up")?"down":"up"}else{n.sortIndx=o;n.sortDir="up"}p=[{dataIndx:o,dir:n.sortDir}]}else{if(n.sortIndx!=null){p=[{dataIndx:n.sortIndx,dir:n.sortDir}]}}this.sorters=p};k._selectRow=function(o,n){this.selectRow(o,n)};k._findfirstUnhiddenColIndx=function(){for(var n=0;n<this.colModel.length;n++){if(!this.colModel[n].hidden){return n}}};k.selectRow=function(p){var o=p.rowIndx,n=p.evt,q=p.offset;if(n&&(n.type=="keydown"||n.type=="keypress")){if(this.iRows.replace(p)==false){return false}}else{if(this.iRows.add(p)==false){return false}}if(n!=null){}return true};k.scrollY=function(n){this.$vscroll.pqScrollBar("option","cur_pos",n).pqScrollBar("scroll")};k._get$Tbl=function(n,o){return this.$tbl};k.scrollCell=function(n){this.scrollRow(n);this.scrollColumn(n)};k.scrollRow=function(A){var p=A.rowIndxPage,v=(this.iHierarchy?true:false),w=A.rowIndx,o=this.scrollCurPos,p=(p==null)?(w-this.rowIndxOffset):p,y=this.options,z=parseInt(y.freezeRows);if(p<z){return}var C=this._calcCurPosFromRowIndxPage(p);if(C==null){return}if(C<o){this.$vscroll.pqScrollBar("option","cur_pos",C).pqScrollBar("scroll")}var E=this._get$Tbl(p);var G=E.children("tbody").children("tr[pq-row-indx="+p+"]"),J=G.last(),u=J;if(G.length>1){u=G.first()}if(J[0]==undefined){this.$vscroll.pqScrollBar("option","cur_pos",C).pqScrollBar("scroll")}else{var x=J[0].offsetTop+J[0].offsetHeight,F=this.$cont[0].offsetHeight,q=parseInt(E.css("marginTop")),B=this._getScollBarHorizontalHeight(),r=u.prev("tr");if(r.hasClass("pq-row-hidden")||r.hasClass("pq-last-freeze-row")){return}else{if(x>F-B-q){var D=x-(F-B-q);var G=E.children().children("tr");var H=0,I=0;var s;if(z){s=G.filter("tr.pq-last-freeze-row").last().next();if(s.length==0){s=G.filter("tr.pq-row-hidden").next()}}else{s=G.filter("tr.pq-row-hidden").next()}do{H+=s[0].offsetHeight;if(s[0]==J[0]){break}else{if(!v||(s.hasClass("pq-detail-child")==false)){I++;if(H>=D){break}}else{if(H>=D){break}}}s=s.next()}while(1===1);var t=o+I;if(t>C){t=C}var n=this.$vscroll.pqScrollBar("option","num_eles");if(n<t+1){n=t+1}this.$vscroll.pqScrollBar("option",{num_eles:n,cur_pos:t}).pqScrollBar("scroll")}}}};k._bringCellToView=function(D){if(D.rowIndxPage==null||D.colIndx==null){throw"rowIndxPage/colIndx NA"}var o=D.rowIndxPage,s=D.colIndx,t=false,A=this.options.freezeCols;var q;if(this.hidearrHS[s]){this.hidearrHS[s]=false;var z=s-A-this._calcNumHiddenUnFrozens(s);this.$hscroll.pqScrollBar("option","cur_pos",z).pqScrollBar("scroll");t=true}else{var q=this.getCell(D);if(q==null||q.length==0){return false}var v=this._calcRightEdgeCol(s).width;var C=this._getScollBarVerticalWidth();if(v>this.$cont[0].offsetWidth-C){var B=i.call(this,-1,s+1)-(this.$cont[0].offsetWidth-C);var n=q.parent("tr").children("td");var u=this.colModel,y=this.outerWidths,p=u.length;var r=0,x=0;for(var w=A;w<p;w++){if(!u[w].hidden){r+=y[w]}if(w==s){x=w-A-this._calcNumHiddenUnFrozens(w);break}else{if(r>=B){x=w-A-this._calcNumHiddenUnFrozens(w)+1;break}}}this.$hscroll.pqScrollBar("option","cur_pos",x).pqScrollBar("scroll");t=true}}if(t){var q=this.getCell({rowIndxPage:o,colIndx:s});return q}else{return q}};k.scrollColumn=function(t){var p=(t.colIndx==null)?getColIndx({dataIndx:t.dataIndx}):t.colIndx,w=this.options.freezeCols,q=false;if(this.hidearrHS[p]){this.hidearrHS[p]=false;var v=p-w-this._calcNumHiddenUnFrozens(p);this.$hscroll.pqScrollBar("option","cur_pos",v).pqScrollBar("scroll");q=true}else{var r=this._calcRightEdgeCol(p).width;var y=this._getScollBarVerticalWidth();if(r>this.$cont[0].offsetWidth-y){var x=i.call(this,-1,p+1)-(this.$cont[0].offsetWidth-y);var n=this.colModel.length;var o=0,u=0;for(var s=w;s<n;s++){if(!this.colModel[s].hidden){o+=this.outerWidths[s]}if(s==p){u=s-w-this._calcNumHiddenUnFrozens(s);break}else{if(o>=x){u=s-w-this._calcNumHiddenUnFrozens(s)+1;break}}}this.$hscroll.pqScrollBar("option","cur_pos",u).pqScrollBar("scroll");q=true}}};k.selection=function(q){var o=q.rowIndx,p=q.colIndx,r=q.method,n=q.type;if(n=="row"){return this["iRows"][r](q)}else{if(n=="cell"){return this["iCells"][r](q)}}return};k.setSelection=function(n){if(n==null||n.rowIndx==null){this.iRows.removeAll({raiseEvent:true});this.iCells.removeAll({raiseEvent:true})}else{this._bringPageIntoView(n);return this._setSelection(n)}};k._bringPageIntoView=function(u){var s=u.rowIndx,r=this;var o=this.options.pageModel;if(o.type=="local"&&s>=0){var q=o.curPage;var t=o.rPP;var p=(q-1)*t;var n=q*t;if(s>=p&&s<n){}else{o.curPage=Math.ceil((s+1)/t);this.refreshDataFromDataModel();this._refreshViewAfterDataSort()}}};k.goToPage=function(s){var n=this.options.pageModel;if(n.type=="local"||n.type=="remote"){var p=s.rowIndx,r=n.rPP,q=(s.page==null)?Math.ceil((p+1)/r):s.page,o=n.curPage;if(q!=o){n.curPage=q;if(n.type=="local"){this.refreshDataFromDataModel();this._refresh()}else{this.refreshDataAndView()}}}};k._setSelection=function(s){if(s==null){this.iRows.removeAll({raiseEvent:true});this.iCells.removeAll({raiseEvent:true});return false}var q=this.data;var t=this.rowIndxOffset,p=s.rowIndx,n=s.rowIndxPage,p=(p==null)?n+t:p,n=(n==null)?p-t:n,r=(s.colIndx==null&&s.dataIndx!==undefined)?this.getColIndx({dataIndx:s.dataIndx}):s.colIndx,o=s.evt;s.rowIndx=p;s.colIndx=r;s.rowIndxPage=n;if(n<0||r<0){return false}if(q==null||q.length==0){return false}if(n>=q.length||r>=this.colModel.length){return false}this.scrollRow({rowIndxPage:n});if(r==null){return this._selectRow(s)}else{this._bringCellToView({rowIndxPage:n,colIndx:r});return this.selectCell(s)}};k.getColModel=function(){return this.colModel};k.saveEditCell=function(o){if(this.$td_edit==null){return}var s=this.$td_edit,B=o?o.evt:null,z=this.getCellIndices({$td:s}),r=this.getRowIndxOffset(),C=z.colIndx,n=z.rowIndxPage,u=n+r,D=this.colModel,p=D[C],y=p.dataIndx,v=this.data[n],q=this.options,x=q.dataModel,w;if(v==null){return}else{w=v[y]}z.rowIndx=u;z.column=p;z.dataIndx=y;if(n!=null){var E=this._getEditCellData(z);if(E=="<br>"){E=""}if(w==null&&E==""){E=null}var A={rowIndx:u,dataIndx:y,column:p,newVal:E,value:E,oldVal:w,rowData:v,dataModel:x};if(this._trigger("cellBeforeSave",B,A)===false){return false}if(E!=w){v[y]=E;this._trigger("cellSave",B,A);if(q.track){var v=this.getRowData({rowIndx:u});this.iHistory.push({type:"update",rowData:v,dataIndx:y,oldVal:w,newVal:E});this.iUCData.update({rowData:v,dataIndx:y,oldVal:w,newVal:E})}this.refreshCell(z);this._fixTableViewPort();var t=this;if(q.flexHeight){t.setGridHeightFromTable();t._fixIEFooterIssue()}else{t.scrollRow({rowIndxPage:n})}}return true}};k._fixTableViewPort=function(){var n=this.$cont[0];n.scrollTop=0;n.scrollLeft=0};k._fixIEFooterIssue=function(){g(".pq-grid-footer").css({position:"absolute"});g(".pq-grid-footer").css({position:"relative"})};k.refreshColumn=function(q){var t=this.options.customData,p=(q.colIndx==null)?this.getColIndx({dataIndx:q.dataIndx}):q.colIndx,s=this.getRowIndxOffset();q.colIndx=p;for(var r=this.init;r<=this["final"];r++){var n=r;q.rowIndx=n+s;q.rowIndxPage=n;var o=this.colModel[p];q.$td=this.getCell(q);q.rowData=this.data[n];q.customData=t;q.column=o;this.iGenerateView._renderCell(q)}};k.refreshCell=function(v){if(!this.data){return}var t=this.rowIndxOffset,u=v.rowIndx=(v.rowIndx==null)?v.rowIndxPage+t:v.rowIndx,n=v.rowIndxPage=(v.rowIndxPage==null)?v.rowIndx-t:v.rowIndxPage,w=v.dataIndx,p=v.colIndx=(v.colIndx==null)?this.getColIndx({dataIndx:w}):v.colIndx,o=v.$td=(v.$td==null)?this.getCell(v):v.$td,r=v.column=this.colModel[p],q=this.data[n];if(!q){return}var s=v;s.rowData=q;s.customData=this.options.customData;if(o&&o.length>0){this.iGenerateView._renderCell(s)}};k.refreshRow=function(u){if(!this.data){return}var v=this.options,r=this.rowIndxOffset,t=u.rowIndx=(u.rowIndx==null)?u.rowIndxPage+r:u.rowIndx,n=u.rowIndxPage=(u.rowIndxPage==null)?u.rowIndx-r:u.rowIndxPage,s=(u.$tr==null)?this.getRow(u):u.$tr,p=this.colModel,o=this.data[n];if(!o){return}var q=[];this.iGenerateView._generateRow(o,n,p,q,null);var w=q.join("");s.replaceWith(w);this._trigger("refresh",null,{type:"row",dataModel:v.dataModel,colModel:p,rowData:o,rowIndx:t,rowIndxPage:n});return};k.quitEditMode=function(B){var v=this,p=false,x=false,r=false,y=this.options.selectionModel,z=undefined;if(B){p=B.old;x=B.silent;r=B.fireOnly;z=B.evt}var o=p?this.$td_edit_old:this.$td_edit;if(o){var t,n,q,s,w,A=function(){if(p){v.$td_edit_old=null}else{v.$td_edit=null}};if(!p){this.disableSelection()}var u=this.getCellIndices({$td:o});if(u&&u.rowIndx!=null){t=u.rowIndx;n=t-this.offsetRowIndx,q=u.colIndx;s=this.colModel[q];w=s.dataIndx}else{A();return}if(!p&&!r){if(y.type=="cell"){o.attr("tabindex","0").focus()}else{if(y.type=="row"){o.parent("tr.pq-grid-row").attr("tabindex","0").focus()}}}if(!x&&!p){this._trigger("quitEditMode",z,{$td:o,rowIndx:t,rowIndxPage:n,colIndx:q,column:s,dataIndx:w,rowData:this.data[n]})}if(!r){this._removeCellRowOutline(B);A()}}};k.getData=function(){return this.data};k.getViewPortRowsIndx=function(){return{beginIndx:this.init,endIndx:this["final"]}};k.getRowIndxOffset=function(){return this.rowIndxOffset};k.selectCell=function(q){var o=q.rowIndx,p=q.colIndx,n=q.evt;if(n&&(n.type=="keydown"||n.type=="keypress")){if(this.iCells.replace(q)==false){return false}}else{if(this.iCells.add(q)==false){return false}}if(n!=null){}return true};k._setGridFocus=function(){var n=this;var o=true;window.setTimeout(function(){if(n.$td_edit==null){if(o){o=false}}},0)};k.getEditCell=function(){if(this.$td_edit){return{$td:this.$td_edit,$cell:this.$div_focus}}else{return null}};k.editCell=function(n){var o=this.getCell(n);if(o!=null&&o.length>0){this._editCell(o);return o}};k.getFirstEditableColIndx=function(n){if(n.rowIndx==null){throw"rowIndx NA"}if(!this.isEditableRow(n)){return -1}var o=this.colModel;for(var p=0;p<o.length;p++){n.colIndx=p;if(!this.isEditableCell(n)){continue}else{if(o[p].hidden){continue}}return p}return -1};k.editFirstCellInRow=function(o){var s=this.rowIndxOffset,p=o.rowIndx,n=o.rowIndxPage,p=(p==null)?(n+s):p,n=(n==null)?(p-s):n,q=this.getFirstEditableColIndx({rowIndx:p});if(q!=-1){this.scrollRow({rowIndxPage:n});var r=this._bringCellToView({colIndx:q,rowIndxPage:n});if(r&&r.length>0){this._editCell(r)}}};k._editCell=function(Y){var I=this;var o=I.getCellIndices({$td:Y});var t=o.rowIndxPage,M=this.rowIndxOffset,y=t+M,w=o.colIndx,R=this.colModel[w],v=R.editor,u=this.options.editor,n=v?g.extend({},u,v):u,T=I.data[t],L=false,J=R.dataIndx;if(this.$td_edit){if(this.$td_edit[0]==Y[0]){return false}else{this.$td_edit_old=this.$td_edit;this.quitEditMode({fireOnly:true})}}this.$td_edit=Y;this._generateCellRowOutline({$td:Y});var K=this.$div_focus.addClass("pq-editor-border-edit");if(R.align=="right"){K.addClass("pq-align-right")}else{if(R.align=="center"){K.addClass("pq-align-center")}else{K.addClass("pq-align-left")}}var V=K.width()-8,Z=T[J],O;var N=n.type,B=n.select,D=n.cls?n.cls:"",q="pq-editor-focus "+D,p=q+" pq-cell-editor ",x=n.attr?n.attr:"",H=n.style,H=(H?H:""),r=H?("style='"+H+"'"):"",U="style='width:"+V+"px;"+H+"'",S=H?("style='"+H+"'"):"";if(typeof N=="function"){O=N.call(I.element,{$cell:K,cellData:Z,rowData:T,cls:q,dataIndx:J,data:n.data,column:R});K.find('*[name="'+J+'"]').val(Z)}else{if(N=="checkbox"){var E=Z?"checked='checked'":"";O="<input "+E+" class='"+p+"' "+x+" "+S+" type=checkbox name='"+J+"' />";K.html(O)}else{if(N=="textarea"||N=="select"||N=="textbox"){if(N=="textarea"){O="<textarea class='"+p+"' "+x+" "+U+" name='"+J+"' ></textarea>"}else{if(N=="select"){var C=n.options;var C=C?C:[];O=["<select class='"+p+"' "+x+" "+U+" name='"+J+"' >"];if(typeof C==="function"){C=C.call(I.element,{column:R,rowData:T})}for(var W=0,G=C.length;W<G;W++){var A=C[W];if(typeof A=="object"){for(var Q in A){O.push('<option value="'+Q+'">'+A[Q]+"</option>")}}else{O.push("<option>"+A+"</option>")}}O.push("</select>");O=O.join("")}else{O="<input class='"+p+"' "+x+" "+U+" type=text name='"+J+"' />"}}K.html(O);K.children().val(Z)}else{O="<div contenteditable='true' tabindx='0' "+r+" "+x+" class='pq-grid-editor-default "+q+"'></div>";K.html(O);K.children().html(Z);L=true}}}var I=this;if(I.$td_edit!=null){var K=I.$div_focus,z=K.children(".pq-editor-focus");z.focus();z.bind("keydown",function(aa){I.iKeyNav._bodyKeyPressDownInEdit(aa)});if(I._trigger("cellEditFocus",null,{$cell:K,$editor:z,dataIndx:J,column:R,rowIndx:y,rowData:T})==false){return false}if(B){if(L){try{var X=z[0];var s=document.createRange();s.selectNodeContents(X);var F=window.getSelection();F.removeAllRanges();F.addRange(s)}catch(P){}}else{z.select()}}}if(I.$td_edit_old){I.quitEditMode({old:true})}};k.getRow=function(s){var o=s.rowIndxPage,r=s.rowIndx,t=this.rowIndxOffset,p=this.options.dataModel;var q,u=this.$tbl;if(u!=undefined){var n=u.children("tbody");if(o!=null){q=n.children("tr[pq-row-indx="+o+"]")}else{if(r!=null){q=n.children("tr[pq-row-indx="+(r-t)+"]")}}}return q};k.getCell=function(s){var o=s.rowIndxPage,r=s.rowIndx,o=(o==null)?(r-this.rowIndxOffset):o,q=s.colIndx,t=s.dataIndx,q=(q==null)?this.getColIndx({dataIndx:t}):q,n=this.$tbl,p,v=this.options,u=v.freezeCols;if(n!=undefined){if(n.length>1){if(q>=u){n=g(n[1])}else{n=g(n[0])}}var p=n.children().children("tr[pq-row-indx="+o+"]").children("td[pq-col-indx="+q+"]")}if(p.length==0||p[0].style.visibility=="hidden"){return null}return p};k.getEditCellData=function(){if(this.$td_edit){var n=this.getCellIndices({$td:this.$td_edit});return this._getEditCellData(n)}else{return null}};k._getEditCellData=function(v){if(v.colIndx==undefined||v.rowIndxPage==undefined){throw ("colIndx, rowIndxpage N/A")}var o=v.colIndx,n=v.rowIndxPage,t=(v.rowIndx!=null)?v.rowIndx:n+this.rowIndxOffset,r=(v.column)?v.column:this.colModel[o],p=r.editor,q=this.options.editor,w=p?g.extend({},q,p):q,x=r.dataIndx,y=(v.$cell)?v.$cell:this.$div_focus,z;var u=w.getData;if(typeof u=="function"){z=w.getData({$cell:y,dataIndx:x,rowIndx:t,rowIndxPage:n,column:r})}else{var A=w.type;if(A=="checkbox"){z=y.children().is(":checked")?true:false}else{if(A=="contenteditable"){z=y.children().html()}else{var s=y.find('*[name="'+x+'"]');if(s&&s.length){z=s.val()}else{var s=y.find(".pq-editor-focus");if(s&&s.length){z=s.val()}}}}}return z};k.getCellIndices=function(o){var r=o.$td;if(r==null||r.length==0||r.closest("table")[0]!=this.$tbl[0]){return{rowIndxPage:null,colIndx:null}}var p=r.parent("tr");var n=p.attr("pq-row-indx");if(n==null){return{rowIndxPage:null,colIndx:null}}n=parseInt(n);var q=r.attr("pq-col-indx");if(q==null){return{rowIndxPage:n,colIndx:null}}q=parseInt(q);return{rowIndxPage:n,rowIndx:n+this.rowIndxOffset,colIndx:q,dataIndx:this.colModel[q].dataIndx}};k.getRowsByClass=function(r){var y=this.options,z=y.dataModel,v=y.pageModel,n=v.type,t=(n=="remote")?true:false,p=this.rowIndxOffset,s=z.data,x=[];if(s==null){return x}for(var q=0,u=s.length;q<u;q++){var o=s[q];r.rowData=o;if(this.hasClass(r)){var w={rowData:o};if(t){w.rowIndx=(q+p)}else{w.rowIndx=q}x.push(w)}}return x};k.addClass=function(s){var r=s.rowIndx,w=s.dataIndx,y=s.cls,q=this.rowIndxOffset,o=this.getRowData(s);if(!o){return}if(r==null){r=this.getRowIndx({rowData:o}).rowIndx}var p=y.split(" ");for(var t=0;t<p.length;t++){var A=p[t];if(w==null&&this.hasClass({rowData:o,cls:A})===false){var x=o.pq_rowcls;if(x){o.pq_rowcls=g.trim(x)+" "+A}else{o.pq_rowcls=A}if(r!=null){var u=this.getRow({rowIndxPage:(r-q)});if(u){u.addClass(A)}}}else{if(this.hasClass({rowData:o,dataIndx:w,cls:A})===false){var z=o.pq_cellcls;if(z){var v=z[w];if(v){z[w]=g.trim(v)+" "+A}else{z[w]=A}}else{var z={};z[w]=A;o.pq_cellcls=z}if(r!=null){var n=this.getCell({rowIndxPage:(r-q),dataIndx:w});if(n){n.addClass(A)}}}}}};k.removeClass=function(s){var q=s.rowIndx,p=this.getRowData(s),v=s.dataIndx,w=s.cls,n=(v!=null&&p)?p.pq_cellcls:null,t=p?p.pq_rowcls:null;if(p==null){return}if(q==null){q=this.getRowIndx({rowData:p}).rowIndx}if(v==null){if(t){p.pq_rowcls=this._removeClass(t,w)}if(q!=null){var u=this.getRow({rowIndx:q});if(u){u.removeClass(w)}}}else{if(n){var r=n[v];if(r){p.pq_cellcls[v]=this._removeClass(r,w)}if(q!=null){var o=this.getCell({rowIndx:q,dataIndx:v});if(o){o.removeClass(w)}}}}};k.hasClass=function(s){var o=s.dataIndx,n=s.cls,r=this.getRowData(s),q=new RegExp("\\b"+n+"\\b"),t;if(r){if(o==null){t=r.pq_rowcls;if(t&&q.test(t)){return true}else{return false}}else{var p=r.pq_cellcls;if(p&&p[o]&&q.test(p[o])){return true}else{return false}}}else{return null}};k._removeClass=function(w,p){if(w){var s=w.split(" "),v=p.split(" "),u=[];for(var q=0,t=s.length;q<t;q++){var x=s[q],y=false;for(var o=0,n=v.length;o<n;o++){var r=v[o];if(x===r){y=true;break}}if(!y){u.push(x)}}if(u.length>1){return u.join(" ")}else{if(u.length===1){return u[0]}else{return null}}}};k.getRowIndx=function(v){var x=v.$tr,q=v.rowData;if(q){var A=this.options,B=A.dataModel,z=A.pageModel,o=z.type,w=(o=="remote")?true:false,u=B.data,p=false;for(var t=0,y=u.length;t<y;t++){if(u[t]==q){p=true;break}}if(p){var s=this.rowIndxOffset,n=(w)?t:(t-s),r=(w)?(t+s):t;return{rowIndxPage:n,rowIndx:r}}else{return{}}}else{if(x==null||x.length==0){return{rowIndxPage:null}}var n=x.attr("pq-row-indx");if(n==null){return{rowIndxPage:null}}n=parseInt(n);return{rowIndxPage:n,rowIndx:n+this.rowIndxOffset}}};f._incrRowIndx=function(o,r){var u=this.that,s=o,r=(r==null)?1:r,p=u.data,n=0;for(var q=o+1,v=p.length;q<v;q++){var t=p[q].pq_hidden;if(!t){n++;s=q;if(n==r){return s}}}return s};f._decrRowIndx=function(n,q){var s=this.that,p=n,u=s.data,q=(q==null)?1:q,o=0;for(var r=n-1;r>=0;r--){var t=u[r].pq_hidden;if(!t){o++;p=r;if(o==q){return p}}}return p};k.addColumn=function(q,r){var p=this.options,n=p.colModel,t=p.dataModel.data;n.push(q);this._calcThisColModel();for(var o=0;o<t.length;o++){var s=t[o];s.push("")}};k.rowNextSelect=function(){var p=this.selection({type:"row",method:"getSelection"}),o,n,q=this.rowIndxOffset;if(p&&p[0]){o=p[0].rowIndx;n=o-q;n=this.iKeyNav._incrRowIndx(n)}if(n!=null){this.setSelection(null);this._setSelection({rowIndxPage:n})}return n};k.rowPrevSelect=function(){var p=this.selection({type:"row",method:"getSelection"}),o,n,q=this.rowIndxOffset;if(p&&p[0]){o=p[0].rowIndx;n=o-q;n=this.iKeyNav._decrRowIndx(n)}if(n!=null){this.setSelection(null);this._setSelection({rowIndxPage:n})}return n};f._incrIndx=function(n,s){var q=this.that,r=q._getLastVisibleRowIndxPage(q.data),o=q.colModel,t=o.length;if(s==null){if(n==r){return null}n=this._incrRowIndx(n);return{rowIndxPage:n}}var p;do{s++;if(s>=t){if(n==r){return null}n=this._incrRowIndx(n);s=0}p=o[s]}while(p&&p.hidden);return{rowIndxPage:n,colIndx:s}};f._decrIndx=function(n,s){var r=this.that,o=r.colModel,t=o.length,p=r._getFirstVisibleRowIndxPage(r.data);if(s==null){if(n==p){return null}n=this._decrRowIndx(n);return{rowIndxPage:n}}var q;do{s--;if(s<0){if(n==p){return null}n=this._decrRowIndx(n);s=t-1}q=o[s]}while(q&&q.hidden);return{rowIndxPage:n,colIndx:s}};f._incrEditIndx=function(n,q){var w=this.that,s=w.colModel,o=s.length,r,u=w.rowIndxOffset,v=w._getLastVisibleRowIndxPage(w.data);do{q++;if(q>=o){if(n==v){return null}do{n=this._incrRowIndx(n);var t=n+u,x=w.isEditableRow({rowIndx:t});if(n==v&&x==false){return null}}while(x==false);q=0}r=s[q];var t=n+u,p=w.isEditableCell({rowIndx:t,colIndx:q,checkVisible:true})}while(r&&(r.hidden||p==false));return{rowIndxPage:n,colIndx:q}};f._decrEditIndx=function(n,q){var v=this.that,s=v.colModel,o=s.length,r,u=v.rowIndxOffset,x=v._getFirstVisibleRowIndxPage(v.data);do{q--;if(q<0){if(n==x){return null}do{n=this._decrRowIndx(n);var t=n+u,w=v.isEditableRow({rowIndx:t});if(n==x&&w==false){return null}}while(w==false);q=o-1}r=s[q];var t=n+u,p=v.isEditableCell({rowIndx:t,colIndx:q,checkVisible:true})}while(r&&(r.hidden||p==false));return{rowIndxPage:n,colIndx:q}};f._incrEditRowIndx=function(n,p){var t=this.that,q=t.rowIndxOffset,s=t._getLastVisibleRowIndxPage(t.data);if(n==s){return null}do{n=this._incrRowIndx(n);var r=n+q,u=t.isEditableRow({rowIndx:r}),o=t.isEditableCell({rowIndx:r,colIndx:p}),v=(u&&o);if(n==s&&!v){return null}}while(!v);return{rowIndxPage:n,colIndx:p}};f._decrEditRowIndx=function(n,p){var s=this.that,q=s.rowIndxOffset,u=s._getFirstVisibleRowIndxPage(s.data);if(n==u){return null}do{n=this._decrRowIndx(n);var r=n+q,t=s.isEditableRow({rowIndx:r}),o=s.isEditableCell({rowIndx:r,colIndx:p}),v=(t&&o);if(n==u&&!v){return null}}while(!v);return{rowIndxPage:n,colIndx:p}};k._keyPressDown=function(n){if(g(n.target).closest(".pq-grid")[0]!=this.element[0]){return}var o=g(n.target).closest(".pq-grid-header");if(o.length>0){if(this._trigger("headerKeyDown",n,{dataModel:this.options.dataModel})==false){return false}else{return true}}else{var p=this.iKeyNav._bodyKeyPressDown(n);if(p===false){return false}if(this._trigger("keyDown",n,{dataModel:this.options.dataModel})==false){return false}}};f._saveAndMove=function(u,p){var s=this.that,q=this.options,o=q.selectionModel;if(s.saveEditCell({evt:p})==false){p.preventDefault();return false}if(u==null){p.preventDefault();return false}var n=u.rowIndxPage,t=u.colIndx;if(o.type=="row"){s._setSelection(null);s._setSelection({rowIndxPage:n});s._bringCellToView({rowIndxPage:n,colIndx:t})}else{if(o.type=="cell"){s._setSelection(null);s._setSelection({rowIndxPage:n,colIndx:t})}else{s.scrollRow({rowIndxPage:n});s._bringCellToView({rowIndxPage:n,colIndx:t})}}var r=s.getCell({rowIndxPage:n,colIndx:t});if(r&&r.length>0){s._editCell(r)}p.preventDefault();return false};f._bodyKeyPressDownInEdit=function(B){var x=this.that;if(!x.$td_edit){return}var A=this.options,v=x.rowIndxOffset,y=g.ui.keyCode,t=x.colModel,n=A.editModel,p=g(x.$td_edit[0]),w=x.getCellIndices({$td:p}),o=w.rowIndxPage,u=o+v,r=w.colIndx,s=t[r],q=s.editModel,z=q?g.extend({},n,q):n;if(x._trigger("cellEditKeyDown",B,{rowData:x.data[o],$cell:x.$div_focus,rowIndx:u,rowIndxPage:o,colIndx:r,$td:p,dataIndx:s.dataIndx,column:s})==false){return false}if(B.keyCode==y.TAB){var w;if(B.shiftKey){w=this._decrEditIndx(o,r)}else{w=this._incrEditIndx(o,r)}return this._saveAndMove(w,B)}else{if(B.keyCode==z.saveKey){var w=this._incrEditIndx(o,r);return this._saveAndMove(w,B)}else{if(B.keyCode==y.ESCAPE){x.quitEditMode({evt:B});B.preventDefault();return false}else{if(B.keyCode==y.PAGE_UP||B.keyCode==y.PAGE_DOWN){B.preventDefault();return false}else{if(z.keyUpDown){if(B.keyCode==y.DOWN){var w=this._incrEditRowIndx(o,r);return this._saveAndMove(w,B)}else{if(B.keyCode==y.UP){var w=this._decrEditRowIndx(o,r);return this._saveAndMove(w,B)}}}}}}}return};f.filterKeys=function(x,t){var r=this.that,q=this.options.editModel.filterKeys;var p=t.column,v=p.dataType,o=p.editModel;if(o&&o.filterKeys!=undefined){q=o.filterKeys}if(!q){return}if(v=="float"||v=="integer"){var s=g(x.originalEvent.target),u=s[0].nodeName.toLowerCase(),z=(v=="integer")?/^[\-]?[0-9]*$/:/^[\-]?[0-9]*\.?[0-9]*$/;var y=["input","textarea","select"],n="text";if(g.inArray(u,y)!=-1){n="val"}var w=s[n]();window.setTimeout(function(){var A=s[n]();if(z.test(A)==false){s[n](w)}},0)}};f.select=function(o){var r=this.that,q=o.rowIndx,s=o.colIndx,n=r.options.selectionModel,p=o.evt;if(p.shiftKey&&n.mode!="single"){if(n.type=="row"){r.scrollRow({rowIndx:q});r.iRows.extendSelection({rowIndx:q,evt:p})}else{if(n.type=="cell"){r.scrollCell({rowIndx:q,colIndx:s});r.iCells.extendSelection({rowIndx:q,colIndx:s,evt:p})}}}else{r._setSelection({rowIndx:q,colIndx:s,evt:p,setFirst:true})}};f._bodyKeyPressDown=function(C){var x=this.that,u=document.activeElement,J,F,t=x.rowIndxOffset,z=this.options,q=x.colModel,E=z.selectionModel,y,D;if(u){var G=g(u);if(G.hasClass("pq-grid-cell")){J=x.getCellIndices({$td:G})}else{if(G.hasClass("pq-grid-row")){F=x.getRowIndx({$tr:G})}}}var I=g.ui.keyCode;if(x.$td_edit){x.$td_edit.find(".pq-cell-focus").focus();return}else{if(F!=null&&E.type=="row"){var y=F.rowIndx,n=y-t}else{if(E.type=="cell"){if(J!=null){var B=J,y=B.rowIndx,n=y-t,A=B.dataIndx,D=x.getColIndx({dataIndx:A});if(y==null||D==null){return}if(x._trigger("cellKeyDown",C,{rowData:x.data[n],rowIndx:y,rowIndxPage:n,colIndx:D,dataIndx:A,column:q[D]})==false){return false}if(C.cancelBubble){return}}else{return}}else{return}}}var p=n,H=D,w=x._getFirstVisibleRowIndxPage(x.data),r=x._getLastVisibleRowIndxPage(x.data);if(C.keyCode==I.LEFT){var B=this._decrIndx(n,D);if(B){y=B.rowIndxPage+t;this.select({rowIndx:y,colIndx:B.colIndx,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.RIGHT){var B=this._incrIndx(n,D);if(B){y=B.rowIndxPage+t;this.select({rowIndx:y,colIndx:B.colIndx,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.TAB){var B;if(C.shiftKey){B=this._decrIndx(n,D)}else{B=this._incrIndx(n,D)}if(B){x._setSelection({rowIndxPage:B.rowIndxPage,colIndx:B.colIndx,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.UP){n=this._decrRowIndx(n);if(n!=null){y=n+t;this.select({rowIndx:y,colIndx:D,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.DOWN){n=this._incrRowIndx(n);if(n!=null){y=n+t;this.select({rowIndx:y,colIndx:D,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.PAGE_DOWN||C.keyCode==I.SPACE){n=this._incrRowIndx(n,x.pageSize+1);if(n!=null){y=n+t;this.select({rowIndx:y,colIndx:D,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.PAGE_UP){n=this._decrRowIndx(n,x.pageSize+1);if(n!=null){y=n+t;this.select({rowIndx:y,colIndx:D,evt:C})}C.preventDefault();return}else{if(C.keyCode==I.HOME){y=w+t;x._setSelection({rowIndx:y,colIndx:D,evt:C});C.preventDefault();return}else{if(C.keyCode==I.END){y=r+t;x._setSelection({rowIndx:y,colIndx:D,evt:C});C.preventDefault();return}else{if(C.keyCode==I.ENTER){if(E.type=="row"){var K,s;if(F!=null){x.editFirstCellInRow({rowIndx:n+t})}}else{if(J!=null){var s=x.getCell({rowIndxPage:n,colIndx:D});if(s&&s.length>0){var y=n+t,v=x.isEditableRow({rowIndx:y}),o=x.isEditableCell({rowIndx:y,colIndx:D});if(v&&o){x._editCell(s)}}}}C.preventDefault();return}else{}}}}}}}}}}};k._calcNumHiddenFrozens=function(){var n=0,p=this.options.freezeCols;for(var o=0;o<p;o++){if(this.colModel[o].hidden){n++}}return n};k._calcNumHiddenUnFrozens=function(r){var o=0,q=this.options.freezeCols;var n=(r!=null)?r:this.colModel.length;for(var p=q;p<n;p++){if(this.colModel[p].hidden){o++}}return o};k._setScrollHLength=function(){if(!this.options.scrollModel.horizontal){this.$hscroll.css("visibility","hidden");this.$hvscroll.css("visibility","hidden");return}else{this.$hscroll.css("visibility","");this.$hvscroll.css("visibility","")}var p=this.$cont[0].offsetWidth;var n=this.colModel;var o=this._getScollBarVerticalWidth();if(o==0){this.$hscroll.css("right",0)}else{this.$hscroll.css("right","")}p-=o;this.$hscroll.pqScrollBar("option","length",p)};k._setScrollHNumEles=function(){var o=this.options,n=o.scrollModel,p=0;if(!o.flexWidth){if(n.lastColumn=="fullScroll"){p=this.colModel.length-o.freezeCols-this._calcNumHiddenUnFrozens()}else{p=this.calcColsOutsideCont(this.colModel)+1}}this.$hscroll.pqScrollBar("option","num_eles",p)};k.calcColsOutsideCont=function(u){var w=this.options.numberCell,s=(this.$tbl)?this.$tbl[this.$tbl.length-1]:null,o=s?s.scrollWidth:0,y=this.options.freezeCols,v=this.outerWidths,x=this.$cont[0].offsetWidth-this._getScollBarVerticalWidth();o=0;if(w.show){o+=this.numberCell_outerWidth}for(var t=0;t<u.length;t++){var q=u[t];if(!q.hidden){o+=v[t]}}var p=0,n=0;var r=o;if(r>x){n++}for(t=y;t<u.length;t++){q=u[t];if(!q.hidden){p+=v[t];r=o-p;if(r>x){n++}else{break}}}return n};k._getScollBarHorizontalHeight=function(){var o=17,n=this.$hscroll;if(n.css("visibility")=="hidden"||this.options.scrollModel.horizontal==false||n.css("display")=="none"){o=0}return o};k._getScollBarVerticalWidth=function(){var o=17,n=this.$vscroll;if(n.css("visibility")=="hidden"||this.options.flexHeight||n.css("display")=="none"){o=0}return o};k._setScrollVNumEles=function(r){var v=this,w=this.$vscroll,u=(this.iHierarchy?true:false),q=w.pqScrollBar("option"),p=parseInt(q.num_eles),t=parseInt(q.cur_pos),x=this.options;var y=this._getScollBarHorizontalHeight(),C=this.$cont[0].offsetHeight,n=C-y+1,z=x.groupModel,H=(z)?this.dataGM:this.data;var E=H?this.totalVisibleRows:0;var s,A,I=0;if(this.$tbl&&this.$tbl.length>0){s=this.$tbl[this.$tbl.length-1];I=s.offsetHeight;A=g(s)}if(I>0&&I>n){var F=A.children().children("tr");var G=0,B=0;for(var D=0;D<F.length;D++){var o=F[D];G+=o.offsetHeight;if(G>=n){if(u&&g(o).hasClass("pq-detail-child")){B--;B=(B>1)?(B-1):1}else{B=(B>1)?(B-1):0}break}else{if(u){if(g(o).hasClass("pq-detail-child")==false){B++}}else{B++}}}if(B==0){B=F.length-1}p=E-B+1}else{p=t+1}if(p>E){p=E}if(r){v.$vscroll.pqScrollBar("option","num_eles",p)}else{v.$vscroll.pqScrollBar("setNumEles",p)}return p};k._getFirstVisibleRowIndxPage=function(q){for(var o=0,n=q.length;o<n;o++){var p=q[o].pq_hidden;if(!p){return o}}};k._getLastVisibleRowIndxPage=function(p){for(var n=p.length-1;n>=0;n--){var o=p[n].pq_hidden;if(!o){return n}}return null};k._getLastVisibleColIndx=function(){var n=this.colModel,q=n.length;for(var o=q-1;o>=0;o--){var p=n[o].hidden;if(!p){return o}}return null};k.getTotalVisibleColumns=function(){var n=this.colModel,s=n.length,o=0;for(var p=0;p<s;p++){var q=n[p],r=q.hidden;if(!r){o++}}return o};k._getTotalVisibleRows=function(r,y,x,J){var C=0,u=(J)?J.length:0,F=y,B=0,p=0,n=null,q=false,v=false,t=(this.iHierarchy)?true:false,I=this.options.detailModel.offset,s=0,o=22,A=t?this.$cont[0].offsetHeight:undefined;if(J==null||u==0){return{init:n,_final:n,tvRows:C}}for(var E=0,G=((u>y)?y:u);E<G;E++){var w=J[E],D=w.pq_hidden;if(!D){n=E;C++;if(t){var z=w.pq_detail;if(z&&z.show){var H=(z.height||0);if(H>I){H=I}s+=H+o}else{s+=o}}}}this.lastFrozenRow=n;if(u<y){return{init:n,_final:n,tvRows:C}}x=x-C;for(var E=y,G=u;E<G;E++){var w=J[E],D=w.pq_hidden;if(!q){if(D){F++}else{if(p==r){q=true;B=F;p=0}else{F++;p++}}}else{if(!v){if(D){B++}else{if(p==x){v=true}else{B++;p++}}}}if(!D){C++;if(t&&q){var z=w.pq_detail;if(z&&z.show){var H=(z.height||0);if(H>I){H=I}s+=H+o}else{s+=o}if(s>A){v=true}}}}if(F>=u){F=u-1}if(B<F){B=F}return{init:F,_final:B,tvRows:C}};k._setScrollVLength=function(){var p=this.$cont.height();var o=this._getScollBarHorizontalHeight();this.$vscroll.css("bottom",o);var n=(p-o);this.$vscroll.pqScrollBar("option","length",n);return};k._setInnerGridHeight=function(){var o=this.options;if(o.flexHeight){return}var n=(this.element.height()-((o.showTop)?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight);this.$grid_inner.height(n+"px")};k._setRightGridHeight=function(){var q=this.options;var p=this.$header[0].offsetHeight;this.$header_o.height(p-2);if(q.flexHeight){return}this.$vscroll.css("visibility","");if(this.$tbl){this.$tbl.css("marginBottom",0)}var o=(this.element.height()-this.$header_o[0].offsetHeight-((q.showTop)?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight);var n=0;this.$cont.height((o-n)+"px")};k.setGridHeightFromTable=function(){var p=0;var o=this._getScollBarHorizontalHeight(),q=this.$tbl;if(q&&q.length){p=(q[0].offsetHeight-1);q.css("marginBottom",o)}else{p=22}var n=p+o;this.$cont.height("");this.element.height("");this.$grid_inner.height("");this.$vscroll.css("visibility","hidden")};k._setGridWidthFromTable=function(){var n;var o=this._getScollBarVerticalWidth();if(this.$tbl&&this.$tbl[0]&&this.$tbl[0].scrollWidth>0){n=this.$tbl[0].scrollWidth;this.element.width((n+o)+"px")}else{n=i.call(this,-1,this.colModel.length);this.element.width((n)+"px")}};k._setRightGridWidth=function(){};k._bufferObj_getInit=function(){return this.init};k._bufferObj_getFinal=function(){return this["final"]};k._bufferObj_minRowsPerGrid=function(){var n=this.$cont[0].offsetHeight;return Math.ceil(n/this.rowHeight)};k._calcCurPosFromRowIndxPage=function(n){var v=this.options,w=v.groupModel,q=w?this.dataGM:this.data,x=v.freezeRows;var u=0,p=x;for(var r=x,t=q.length;r<t;r++){var o=q[r];if(w&&(o.groupSummary||o.groupTitle)){}else{if(p==n){break}p++}var s=o.pq_hidden;if(!s){u++}}if(u>=t){return null}else{return u}};k._bufferObj_calcInitFinal=function(){var s=this.options,w=s.freezeRows,r=s.flexHeight,u=s.groupModel,n=(u)?true:false,o=n?this.dataGM:this.data,x=s.treeModel;if(o==null||o.length==0){var q=this._getTotalVisibleRows(p,w,t,o);this.totalVisibleRows=q.tvRows;this.init=q.init;this["final"]=q._final}else{var v=this.$vscroll.pqScrollBar("option"),p=parseInt(v.cur_pos);if(isNaN(p)||p<0){throw ("cur_pos NA");this.init=0}this.scrollCurPos=p;var t=this._bufferObj_minRowsPerGrid();this.pageSize=t;var q=this._getTotalVisibleRows(p,w,t,o);this.totalVisibleRows=q.tvRows;this.init=q.init;if(r){this["final"]=o.length-1}else{this["final"]=q._final}}};k._bufferObj_calcInitFinalH=function(){var x=parseInt(this.$hscroll.pqScrollBar("option","cur_pos")),C=this.options,y=parseInt(C.freezeCols),r=C.flexWidth,z=C.virtualX,v=y,w=0,s=this.colModel,u=this.outerWidths,o=s.length;for(var t=y;t<o;t++){if(s[t].hidden){v++}else{if(w==x){break}else{v++;w++}}}if(v>o-1){v=o-1}this.initH=v;if(r||!z){this.finalH=o-1}else{var p=i.call(this,-1,y),n=this.$cont[0].offsetWidth-this._getScollBarVerticalWidth();for(var t=v;t<o;t++){var q=s[t];if(!q.hidden){var A=u[t];if(!A){throw ("width N/A")}p+=A;if(p>n){break}}}var B=t;if(B>o-1){B=o-1}this.finalH=B}};var i=function(r,p,x){var n=0,y=this.options,t=y.columnBorders,w=y.numberCell,v=this.outerWidths,q=this.colModel;if(r==-1){if(w.show){if(x){n+=parseInt(w.width)+1}else{n+=this.numberCell_outerWidth}}r=0}if(x){for(var s=r;s<p;s++){var o=q[s],u=o.hidden;if(!u){n+=parseInt(o.width)+(t?1:0)}}}else{for(var s=r;s<p;s++){if(!q[s].hidden){n+=v[s]}}}return n};g.paramquery.pqgrid.calcWidthCols=i;k._calcHeightRows=function(r,p){var n=0;var q=r;do{if(q>=p){break}var o=this.getRow({rowIndxPage:q});if(o&&o[0]){n+=o[0].offsetHeight}q++}while(1==1);return n};k._calcRightEdgeCol=function(u){var s=0,t=0,n=this.colModel,r=this.hidearrHS,q=this.outerWidths,o=this.options.numberCell;if(o.show){s+=this.numberCell_outerWidth;t++}for(var p=0;p<=u;p++){if(!n[p].hidden&&r[p]==false){s+=q[p];t++}}return{width:s,cols:t}};k._refreshFreezeLine=function(){var p=this.options,n=p.numberCell,s=this.$cont_o,r=p.freezeCols;if(this.$freezeLine){this.$freezeLine.remove()}if(r){var q=i.call(this,-1,(r))-1;if(isNaN(q)||q==0){}else{if(q>0&&n.show&&q==n.width){}else{this.$freezeLine=g("<div class='pq-grid-vert-freezeline' ></div>").appendTo(s);var o=s[0].offsetHeight;this.$freezeLine.css({height:o,left:q})}}}};k._getDragHelper=function(o){var n=g(o.currentTarget);this.$cl=g("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);this.$clleft=g("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);var q=parseInt(n.attr("pq-grid-col-indx"));var p=this.$grid_inner.outerHeight();this.$cl.height(p);this.$clleft.height(p);var s=g("td[pq-grid-col-indx="+q+"]",this.$header)[0];var r=s.offsetLeft+((q>this.options.freezeCols)?parseInt(this.$header[1].offsetLeft):0);this.$clleft.css({left:r});r=r+s.offsetWidth;this.$cl.css({left:r})};k._setDragLimits=function(p){var q=this,u=this.options,s=u.numberCell;var t=q.$header_left;if(p>=u.freezeCols){t=q.$header_right}var r=t.find("div.pq-grid-col-resize-handle[pq-grid-col-indx="+p+"]");var o=t.find("td[pq-grid-col-indx='"+p+"']");var n=o.offset().left+u.minWidth;if(p==-1){n=o.offset().left+s.minWidth}var v=17;if(u.flexHeight||this.$vscroll.css("visibility")=="hidden"){v=0}var w=q.$cont.offset().left+q.$cont[0].offsetWidth-v+20;r.draggable("option","containment",[n,0,w,0])};k._getOrderIndx=function(o){var n=this.options.columnOrder;if(n!=null){return n[o]}else{return o}};k.nestedCols=function(x,w,y){var v=x.length;var t=[];if(w==null){w=1}var s=w,u=0,n=0,p=0;for(var r=0;r<v;r++){var o=x[r];if(y==true){o.hidden=y}if(o.colModel!=null&&o.colModel.length>0){var q=this.nestedCols(o.colModel,w+1,o.hidden);t=t.concat(q.colModel);if(q.colSpan>0){if(q.depth>s){s=q.depth}o.colSpan=q.colSpan;u+=q.colSpan}else{o.colSpan=0;o.hidden=true}o.childCount=q.childCount;p+=q.childCount}else{if(o.hidden){o.colSpan=0}else{o.colSpan=1;u++}o.childCount=0;p++;t.push(o)}}return{depth:s,colModel:t,colSpan:u,width:n,childCount:p}};k.getHeadersCells=function(){var x=this.options.colModel,E=this.colModel.length,F=this.depth;var o=[];for(var v=0;v<F;v++){o[v]=[];var C=0;var w=0,q=0;for(var u=0;u<E;u++){var y;if(v==0){y=x[C]}else{var r=o[v-1][u];var s=r.colModel;if(s==null||s.length==0){y=r}else{var B=(u-r.leftPos);var z=0,p=0;var n=0;for(var A=0;A<s.length;A++){p+=(s[A].childCount>0)?s[A].childCount:1;if(B<p){n=A;break}}y=s[n]}}var D=(y.childCount)?y.childCount:1;if(u==q){y.leftPos=u;o[v][u]=y;q+=D;if(x[C+1]){C++}}else{o[v][u]=o[v][u-1]}}}this.headerCells=o;return o};k.getDataType=function(){var n=this.colModel;if(n&&n[0]){var o=n[0].dataIndx;if(typeof o=="string"){return"JSON"}else{if(typeof o=="number"){return"ARRAY"}}}throw ("dataType unknown")};k.assignRowSpan=function(){var r=this.options.colModel,n=this.colModel.length,u=this.headerCells,p=this.depth;for(var o=0;o<n;o++){for(var w=0;w<p;w++){var t=u[w][o];if(o>0&&t==u[w][o-1]){continue}else{if(w>0&&t==u[w-1][o]){continue}}var s=1;for(var v=w+1;v<p;v++){var q=u[v][o];if(t==q){s++}}t.rowSpan=s}}return u};k._calcThisColModel=function(){var n=this.nestedCols(this.options.colModel);this.colModel=n.colModel;this.depth=n.depth;this.getHeadersCells();this.assignRowSpan();this._refreshWidths();this._computeOuterWidths()};k._refreshWidthsAutoFit=function(){var u=this.options,q=this.colModel,s=this.$cont,o=q.length,y=u.minWidth;var n=i.call(this,-1,o,true);var B=s[0].offsetWidth-this._getScollBarVerticalWidth();if(n!=B){var w=n-B,r=[];for(var D=0;D<o;D++){var p=q[D],C=p.hidden;if(!C){var x=p.minWidth,x=(x?parseInt(x):y),G=parseInt(p.width)-x;if(G>0||w<0){r.push({availWd:G,colIndx:D})}}}r.sort(function(I,H){if(I.availWd>H.availWd){return 1}else{if(I.availWd<H.availWd){return -1}else{return 0}}});for(var D=0,E=r.length;D<E;D++){var v=r[D],G=v.availWd,z=v.colIndx,A=Math.round(w/(E-D)),p=q[z],F=p.width;if(G>A){var t=F-A;w=w-A;p.width=t}else{var t=F-G;w=w-G;p.width=t}}}};k._refreshWidths=function(){var B=this.options,A=B.numberCell,D=B.freezeCols,q=B.flexWidth,M=B.columnBorders,s=this.colModel,G=B.scrollModel,I=G.lastColumn,t=G.autoFit,w=this.$cont,o=s.length,F=B.minWidth;if(A.show){if(A.width<A.minWidth){A.width=A.minWidth}}for(var K=0;K<o;K++){var r=s[K],J=r.hidden;if(J){continue}var N=r.width,E=r.minWidth,E=(E?parseInt(E):F);if(N!=undefined){var z=parseInt(N);if(z<E){z=E}r.width=z}else{r.width=E}}if(w&&q==false){if(t){this._refreshWidthsAutoFit()}if(I=="auto"){var H=w[0].offsetWidth-this._getScollBarVerticalWidth();var L=i.call(this,-1,D,true);var p=H-L,n=false,u=this._getLastVisibleColIndx(),y=s[u],v=parseInt(y.width),O=y.minWidth,O=(O?parseInt(O):F);for(var K=o-1;K>=D;K--){var r=s[K];if(r.hidden){continue}var x=r.width+(M?1:0);p=p-x;if(p<0){n=true;if(v+p>=O){y.width=v+p}else{var C=v+x+p;if(C>=O){y.width=C}else{}}break}}if(!n){if(p<0){throw ("assert failed")}y.width=v+p}}}};k._createHeader=function(){var M=this,E=this.options,F=parseInt(E.freezeCols),R=E.numberCell,x=E.colModel,y=x.length,Q=this.colModel,n=this.outerWidths,A=Q.length,t=this.depth,w=E.virtualX,L=M.initH,T=M.finalH,V=E.columnBorders,P=this.headerCells,q=[],I=this.hidearrHS,v=this.$header;if(E.showHeader===false){v.empty();this.$header_o.css("display","none");return}else{this.$header_o.css("display","")}var G=["<table class='pq-grid-header-table' cellpadding=0 cellspacing=0>"];if(t>=1){G.push("<tr>");if(R.show){G.push("<td style='width:"+(R.width+1)+"px;' ></td>")}for(var u=0;u<=T;u++){if(u<L&&u>=F&&w){u=L;if(u>T){throw ("initH>finalH")}}var O=Q[u];if(O.hidden){continue}var p=n[u];G.push("<td style='width:"+p+"px;'></td>")}G.push("</tr>")}var S="pq-grid-col "+((E.hwrap===false)?" pq-wrap-text ":"");for(var C=0;C<t;C++){G.push("<tr class='pq-grid-title-row'>");if(C==0&&R.show){G.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='",t,"'>","<div class='pq-grid-header-table-div'>",R.title?R.title:"&nbsp;","</div></td>"].join(""))}for(var u=0;u<=T;u++){if(u<L&&u>=F&&w){u=L;if(u>T){throw ("initH>finalH");break}}var O=P[C][u],z=O.colSpan,H=O.halign,U=O.align,J=O.title,J=J?J:"";if(C>0&&O==P[C-1][u]){continue}else{if(u>0&&O==P[C][u-1]){continue}}if(O.hidden){continue}var o=S;if(H!=null){o+=" pq-align-"+H}else{if(U!=null){o+=" pq-align-"+U}}if(u==F-1&&t==1){o+=" pq-last-freeze-col"}if(u<=F-1){o+=" pq-left-col"}else{if(u>=L){o+=" pq-right-col"}}var B="",N="";if(O.colModel==null||O.colModel.length==0){B="pq-grid-col-indx='"+u+"'"}var D="pq-row-indx="+C;var W="pq-col-indx="+u;G.push("<td "+B+" "+W+" "+D+" "+N+" class='"+o+"' rowspan="+O.rowSpan+" colspan="+z+">				<div class='pq-grid-header-table-div' >"+J+"<span class='pq-col-sort-icon'>&nbsp;</span></div></td>")}G.push("</tr>")}this.ovCreateHeader(G,S);G.push("</table>");var K=G.join("");v.empty();v.append(K);this.$tbl_header=v.children("table");var r=g(v[0]);var s=g(v[1]);var p=i.call(this,-1,F);r.css({width:p,zIndex:1});if(!w){var X=i.call(this,F,L);s.css({left:(-1*X)+"px"})}v.find("td.pq-grid-col").click(function(){if(M.iDragColumns&&M.iDragColumns.status!="stop"){return}var Y=g(this).attr("pq-grid-col-indx");if(Y==null){return}return M._onHeaderCellClick(Y)});this._refreshResizeColumn(L,T,Q)};k.ovCreateHeader=function(){};k._refreshResizeColumn=function(v,B,r){var w=this,y=this.options,x=y.numberCell,H=0,C=w.$header[0].offsetHeight,u=y.virtualX,G=w.hidearrHS,A=parseInt(y.freezeCols),F=y.direction;if(x.show&&x.resizable){var o=g("<div pq-grid-col-indx='-1' class='pq-grid-col-resize-handle'>&nbsp;</div>").appendTo(w.$header_left);var E=w.$header_left.find("td.pq-grid-number-col")[0];H=parseInt(E.offsetLeft)+parseInt((F=="rtl")?0:(E.offsetWidth-10));o.css({left:H,height:C})}for(var D=0;D<=B;D++){if(D<v&&D>=A){D=v;if(D>B){throw ("initH>finalH")}}var p=r[D];if(p.hidden){continue}else{if(p.resizable===false){continue}}var z=w.$header_left;if(D>=A){z=w.$header_right}var o=g("<div pq-grid-col-indx='"+D+"' class='pq-grid-col-resize-handle'>&nbsp;</div>").appendTo(z);var E=w.$header_right.find("td[pq-grid-col-indx="+D+"]")[0];H=parseInt(E.offsetLeft)+parseInt((F=="rtl")?0:(E.offsetWidth-10));o.css({left:H,height:C})}var t,s,q;var n=w.$header.find(".pq-grid-col-resize-handle").draggable({axis:"x",helper:function(J,L){var I=g(J.target);var K=parseInt(I.attr("pq-grid-col-indx"));w._setDragLimits(K);w._getDragHelper(J,L);return I},start:function(I,J){t=J.position.left;q=parseInt(w.$cl[0].style.left)},drag:function(I,K){s=K.position.left;var J=(s-t);w.$cl[0].style.left=q+J+"px"},stop:function(I,J){return w._refreshResizeColumnStop(I,J,r,t)}})};k._refreshResizeColumnStop=function(y,v,s,z){var t=this,w=this.options,u=w.numberCell;t.$clleft.remove();t.$cl.remove();var x=v.position.left;var A=(x-z);var n=g(v.helper),o=parseInt(n.attr("pq-grid-col-indx")),p;if(o==-1){p=null;var q=parseInt(u.width);var r=q+A;u.width=r}else{p=s[o];var q=parseInt(p.width);var r=q+A;p.width=r}t._refresh();t._trigger("columnResize",y,{colIndx:o,column:p,dataIndx:(p?p.dataIndx:null),oldWidth:q,newWidth:p?p.width:u.width})};k._refreshHeaderSortIcons=function(){var p=this.options.dataModel;if(p.sortIndx==undefined){return}var o=this.$header;var s=o.find(".pq-grid-col");s.removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active");o.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");var t=p.sortIndx;var r=this.getColIndx({dataIndx:t});var q="ui-state-active pq-col-sort-"+(p.sortDir=="up"?"asc":"desc");var n="ui-icon ui-icon-triangle-1-"+(p.sortDir=="up"?"n":"s");o.find(".pq-grid-col[pq-grid-col-indx="+r+"]").addClass(q);o.find(".pq-grid-col[pq-grid-col-indx="+r+"] .pq-col-sort-icon").addClass(n)};k.createTable=function(n){this.iGenerateView.generateView(n)};k._refreshOtherTables=function(){return;var D=this.colModel,y=D.length,B=this.options.freezeCols,w=this.options.columBorders;for(var v=0;v<this.tables.length;v++){var u=this.tables[v];var p=u.$tbl,x=p.find("tr:first");for(var r=0;r<y;r++){var s=D[r],z=s.dataIndx;if(s.hidden){var q=x.find("td[pq-dataIndx='"+z+"']");if(q.length>1){var o=p.find("td[pq-dataIndx='"+z+"']").remove();u.$tds.add(o)}}else{if(this.hidearrHS[r]){var q=x.find("td[pq-dataIndx='"+z+"']");if(q.css("visibility")!="hidden"){}}}var n="";var C=const_cls;if(s.align=="right"){C+=" pq-align-right"}else{if(s.align=="center"){C+=" pq-align-center"}}if(r==B-1&&w){C+=" pq-last-freeze-col"}if(s.cls){C=C+" "+s.cls}if(cellSelection){C=C+" pq-cell-select"}var A="<td class='"+C+"' style='"+n+"' pq-col-indx='"+r+"'>				"+this.iGenerateView._renderCell(objRender)+"</td>";buffer.push(A)}for(var t=0;t<hidearrHS1.length;t++){var r=hidearrHS1[t];var s=D[r];objRender.column=s;objRender.colIndx=r;var n="";n+="visibility:hidden;";var C=const_cls;if(s.align=="right"){C+=" pq-align-right"}else{if(s.align=="center"){C+=" pq-align-center"}}var A="<td class='"+C+"' style='"+n+"' pq-col-indx='"+r+"'>				"+this.iGenerateView._renderCell(objRender)+"</td>";buffer.push(A)}}};k._sortLocalData=function(r){if(r==null||r.length==0||this.sorters.length==0){return}var t=this.sorters[0],q=t.dataIndx,s=this.getColIndx({dataIndx:q}),o=this.colModel[s].dataType,p=t.dir;function n(){function y(C,B){var A=C[q];var z=B[q];A=A?parseInt(A):0;z=z?parseInt(z):0;return(A-z)}function u(C,B){var A=C[q];var z=B[q];return o(A,z)}function x(C,B){var A=(C[q]+"").replace(/,/g,"");var z=(B[q]+"").replace(/,/g,"");A=A?parseFloat(A):0;z=z?parseFloat(z):0;return(A-z)}var v=0;function w(C,B){v++;var A=C[q];var z=B[q];A=A?A:"";z=z?z:"";if(A>z){return 1}else{if(A<z){return -1}}return 0}if(o=="integer"){r=r.sort(y)}else{if(o=="float"){r=r.sort(x)}else{if(typeof o=="function"){r=r.sort(u)}else{r=r.sort(w)}}}if(p=="down"){r=r.reverse()}}g.measureTime(n,"innerSort")};g.widget("paramquery._pqGrid",k);g.measureTime=function(r,q){var o=(new Date()).getTime();r();var n=(new Date()).getTime();var p=n-o}})(jQuery);(function($){var calcWidthCols=$.paramquery.pqgrid.calcWidthCols;$.paramquery.template=function(html){var arr=html.split(/<#=(.*)#>/);return arr};var fn={};function cMouseSelection(that){this.that=that;var self=this,widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"cellmousedown",function(evt,ui){if(evt.target==that.element[0]){return self._onCellMouseDown(evt,ui)}});that.element.on(widgetEventPrefix+"rowmousedown",function(evt,ui){if(evt.target==that.element[0]){return self._onRowMouseDown(evt,ui)}});that.element.on(widgetEventPrefix+"cellmousemove",function(evt,ui){if(evt.target==that.element[0]){return self._onCellMouseMoveSheet(evt,ui)}});that.element.on(widgetEventPrefix+"rowmousemove",function(evt,ui){if(evt.target==that.element[0]){return self._onRowMouseMoveSheet(evt,ui)}});that.element.on(widgetEventPrefix+"refresh",function(evt,ui){if(evt.target==that.element[0]){return self._onRefresh(evt,ui)}});$(document).bind("mouseup",function(evt,ui){return self._onDocumentMouseUpSheet(evt,ui)})}var _pMouseSelection=cMouseSelection.prototype;_pMouseSelection._onRefresh=function(evt,ui){var that=this.that,type=that.options.selectionModel.type,lastSel;if(type=="row"&&(lastSel=that.iRows.getFocusSelection())){var $tr=that.getRow(lastSel);if($tr&&$tr.length){var htCont=that.$cont[0].offsetHeight-that._getScollBarHorizontalHeight(),tr=$tr[0];if(htCont>(tr.offsetTop+tr.offsetHeight)){$tr.attr("tabindex","0").focus()}}}else{if(type=="cell"&&(lastSel=that.iCells.getFocusSelection())){var $td=that.getCell(lastSel);if($td&&$td.length){var htCont=that.$cont[0].offsetHeight-that._getScollBarHorizontalHeight(),td=$td[0];if(htCont>(td.offsetTop+td.offsetHeight)){$td.attr("tabindex","0").focus()}}}}};_pMouseSelection._onCellMouseDown=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,colIndx=ui.colIndx,SM=that.options.selectionModel,type=SM.type,mode=SM.mode;if(type!="cell"){return}if(colIndx==null){return}if(evt.shiftKey){that.iCells.extendSelection({rowIndx:rowIndx,colIndx:colIndx,mode:mode,evt:evt});evt.preventDefault()}else{if(evt.ctrlKey&&mode!="single"){if(that.iCells.isSelected({rowIndx:rowIndx,colIndx:colIndx})){that.iCells.remove({rowIndx:rowIndx,colIndx:colIndx})}else{that.setSelection({rowIndx:rowIndx,colIndx:colIndx})}}else{this.mousedown={rowIndx:rowIndx,colIndx:colIndx};that.setSelection(null);that.iCells.add({rowIndx:rowIndx,colIndx:colIndx,setFirst:true})}}return true};_pMouseSelection._onRowMouseDown=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,SM=that.options.selectionModel,mode=SM.mode,type=SM.type;if(type!="row"){return}if(rowIndx==null){return}if(evt.shiftKey){that.iRows.extendSelection({rowIndx:rowIndx,evt:evt});evt.preventDefault()}else{if(evt.ctrlKey&&mode!="single"){if(that.iRows.isSelected({rowIndx:rowIndx})){that.iRows.remove({rowIndx:rowIndx})}else{that.setSelection({rowIndx:rowIndx})}}else{this.mousedown={r1:ui.rowIndx};that.setSelection(null);that.iRows.add({rowIndx:rowIndx,setFirst:true})}}return true};_pMouseSelection._onCellMouseMoveSheet=function(evt,ui){var that=this.that,SM=that.options.selectionModel,type=SM.type,mode=SM.mode;if(type=="cell"&&this.mousedown){var mousedown=this.mousedown,r1=mousedown.r1,c1=mousedown.c1,r2=ui.rowIndx,c2=ui.colIndx;if(r1==r2&&c1==c2){return}else{if(mousedown.r2==r2&&mousedown.c2==c2){return}else{this.mousedown.r2=r2;this.mousedown.c2=c2}}that.iCells.extendSelection({rowIndx:r2,colIndx:c2,evt:evt})}};_pMouseSelection._onRowMouseMoveSheet=function(evt,ui){var that=this.that,SM=that.options.selectionModel,type=SM.type,mode=SM.mode;if(type=="row"&&this.mousedown){var m=this.mousedown;var r1=this.mousedown.r1,r2=ui.rowIndx;if(r1==r2){return}else{if(this.mousedown.r2==r2){return}else{this.mousedown.r2=r2}}that.iRows.extendSelection({rowIndx:r2,evt:evt})}};_pMouseSelection._onDocumentMouseUpSheet=function(evt,ui){var that=this.that,DM=that.options.dataModel;this.mousedown=null;return true};function cHierarchy(that){var self=this;this.that=that;this.type="detail";this.refreshComplete=true;this.detachView=false;var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"cellclick",function(evt,ui){if(evt.target==that.element[0]){return self.cellClick(evt,ui)}});that.element.on(widgetEventPrefix+"cellkeydown",function(evt,ui){if(evt.target==that.element[0]&&evt.keyCode==$.ui.keyCode.ENTER){return self.cellClick(evt,ui)}});that.element.on(widgetEventPrefix+"refresh",function(evt,ui){if(evt.target==that.element[0]){return self.refresh(evt,ui)}});that.element.on(widgetEventPrefix+"beforetableview",function(evt,ui){if(evt.target==that.element[0]){return self.beforeTableView(evt,ui)}});that.element.on(widgetEventPrefix+"beforerefreshdata",function(evt,ui){if(evt.target==that.element[0]){return self.beforeRefreshData(evt,ui)}})}var _pHierarchy=cHierarchy.prototype;_pHierarchy.refresh=function(evt,ui){var that=this.that,initDetail=that.options.detailModel.init,data=that.data;if(!this.refreshComplete){return}this.refreshComplete=false;var $trs=that.$tbl.children("tbody").children("tr.pq-detail-child");for(var i=0;i<$trs.length;i++){var tr=$trs[i],$tr=$(tr),rowIndxPage=$tr.attr("pq-row-indx"),rowData=data[rowIndxPage],$grid=rowData.pq_detail["child"];if(!$grid){if(typeof initDetail=="function"){$grid=initDetail.call(that.element,{rowData:rowData});rowData.pq_detail["child"]=$grid}}var $header=$grid.find(".pq-header-outer");$tr.children("td.pq-detail-child").append($grid);if($header.height()==0){try{$grid.pqGrid("refresh")}catch(ex){}}}this.refreshComplete=true;this.detachView=false};_pHierarchy.beforeTableView=function(evt,ui){if(!this.detachView){this.detachInitView(evt,ui)}};_pHierarchy.beforeRefreshData=function(evt,ui){if(!this.detachView){this.detachInitView(evt,ui)}};_pHierarchy.detachInitView=function(evt,ui){var that=this.that,data=that.data;var $trs=that.$tbl.children("tbody").children("tr.pq-grid-row");var prevRI,$temp,htTemp;for(var i=0;i<$trs.length;i++){var tr=$trs[i],$tr=$(tr),rowIndxPage=$tr.attr("pq-row-indx"),rowData=data[rowIndxPage];if(rowIndxPage==null||rowIndxPage==prevRI){continue}else{prevRI=rowIndxPage}if(rowData.pq_detail){$temp=null;htTemp=0;if(rowData.pq_detail["child"]){var $next=$tr.next();if($next.hasClass("pq-detail-child")){var $child=$next.children("td.pq-detail-child").children();if($child.length){htTemp=$child[0].offsetHeight;$temp=$child.detach()}}}if($temp&&$temp.length){rowData.pq_detail["child"]=$temp;rowData.pq_detail["height"]=htTemp}}}this.detachView=true};_pHierarchy.cellClick=function(evt,ui){var that=this.that,column=ui.column,rowData=ui.rowData,rowIndx=ui.rowIndx,type=this.type;if(column&&column.type===type){var dataIndx="pq_detail";if(rowData[dataIndx]==null){that.rowExpand({rowIndx:rowIndx,scrollRow:true})}else{if(rowData[dataIndx]["show"]===false){that.rowExpand({rowIndx:rowIndx,scrollRow:true})}else{that.rowCollapse({rowIndx:rowIndx,scrollRow:true})}}}};fn.rowExpand=function(objP){var rowData=this.getRowData(objP),detM=this.options.detailModel,dataIndx="pq_detail";if(rowData==null){return}if(rowData[dataIndx]==null){rowData[dataIndx]={show:true}}else{if(rowData[dataIndx]["show"]===false){rowData[dataIndx]["show"]=true}}if(!detM.cache){var $temp=rowData[dataIndx]["child"];if($temp){$temp.remove();rowData[dataIndx]["child"]=null;rowData[dataIndx]["height"]=0}}this.refresh();if(objP.scrollRow){var rowIndx=objP.rowIndx;this.scrollRow({rowIndx:rowIndx})}};fn.rowInvalidate=function(objP){var rowData=this.getRowData(objP),dataIndx="pq_detail";var $temp=rowData[dataIndx]["child"];$temp.remove();rowData[dataIndx]["child"]=null};fn.rowCollapse=function(objP){var rowData=this.getRowData(objP),detM=this.options.detailModel,dataIndx="pq_detail";if(rowData==null||rowData[dataIndx]==null){return}else{if(rowData[dataIndx]["show"]===true){if(!detM.cache){var $temp=rowData[dataIndx]["child"];if($temp){$temp.remove();rowData[dataIndx]["child"]=null;rowData[dataIndx]["height"]=0}}rowData[dataIndx]["show"]=false;this.refresh();if(objP.scrollRow){var rowIndx=objP.rowIndx;this.scrollRow({rowIndx:rowIndx})}}}};function cCheckBoxColumn(that){var self=this;this.that=that;this.type="checkBoxSelection";var data=that.options.dataModel.data;var dataIndx=this._findSelectionIndx();var arr=[];for(var i=0;i<data.length;i++){if(data[i][dataIndx]){arr.push(i)}}that.selection({type:"row",method:"add",rowIndx:arr});var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"cellclick",function(evt,ui){return self.cellClick(evt,ui)});that.element.on(widgetEventPrefix+"rowselect",function(evt,ui){return self.rowSelect(evt,ui)});that.element.on(widgetEventPrefix+"rowunselect",function(evt,ui){return self.rowUnSelect(evt,ui)});that.element.on(widgetEventPrefix+"cellkeydown",function(evt,ui){return self.cellKeyDown(evt,ui)})}var _pCheckBC=cCheckBoxColumn.prototype;_pCheckBC._findSelectionIndx=function(){var CM=this.that.colModel,type=this.type;for(var i=0;i<CM.length;i++){var column=CM[i];if(column.type===type){return column.dataIndx}}};_pCheckBC.cellClick=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,rowData=ui.rowData,column=ui.column,type=this.type;if(column&&column.type===type){var dataIndx=column.dataIndx;if(!rowData[dataIndx]){that.selection({type:"row",method:"add",rowIndx:rowIndx})}else{that.selection({type:"row",method:"remove",rowIndx:rowIndx})}evt.stopPropagation();return false}};_pCheckBC.rowSelect=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,rowData=ui.rowData,dataIndx=this._findSelectionIndx();rowData[dataIndx]=true;that.refreshCell({rowIndx:rowIndx,dataIndx:dataIndx})};_pCheckBC.rowUnSelect=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,rowData=ui.rowData,dataIndx=this._findSelectionIndx();rowData[dataIndx]=false;that.refreshCell({rowIndx:rowIndx,dataIndx:dataIndx})};_pCheckBC.cellKeyDown=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,column=ui.column,rowData=rowData,type=this.type;if(column&&column.type===type){var dataIndx=column.dataIndx,rowIndx=ui.rowIndx;if(evt.keyCode==13||evt.keyCode==32){if(!rowData[dataIndx]){that.selection({type:"row",method:"add",rowIndx:rowIndx})}else{that.selection({type:"row",method:"remove",rowIndx:rowIndx})}evt.stopPropagation();evt.preventDefault();return false}}};function cToolBar(){this.DOM=false}cToolBar.prototype.toggleToolbar=function(){if(!this.DOM){this.show()}else{this.hide()}return this.DOM};cToolBar.prototype.show=function(){this.create();this.DOM=true};cToolBar.prototype.hide=function(){this.remove();this.DOM=false};var cCRUD=function(that){this.that=that;this.$crudPopup=null;this.$toolbar=null};cCRUD.prototype=new cToolBar;var _pCRUD=cCRUD.prototype;_pCRUD.remove=function(){this.$crudPopup.remove();this.$toolbar.remove()};_pCRUD.create=function(){this._createDOM()};_pCRUD._createDOM=function(){var that=this.that,self=this,thisOptions=that.options,thisColModel=that.colModel;var buffer=["<div style='display:none;' class=''>","<form class='pq-grid-form' onsubmit='alert(null)'><input type='submit' />"];var strCRUDFORM=buffer.join("")+"</form></div>";var $crudPopup=$(strCRUDFORM).appendTo(document.body);self.$crudPopup=$crudPopup;self.$crudForm=this.$crudPopup.find("form");$crudPopup.dialog({width:"auto",modal:true,open:function(){$(".ui-dialog").position({of:this.element});$(".ui-dialog").find('button:contains("Cancel")').button({icons:{primary:"ui-icon-close"}});$(".ui-dialog").find('button:contains("Add")').button({icons:{primary:"ui-icon-disk"}});$(".ui-dialog").find('button:contains("Update")').button({icons:{primary:"ui-icon-disk"}});that._trigger("crudFormOpen",null,{$form:self.$crudForm,colModel:thisColModel,dataModel:thisOptions.dataModel})},autoOpen:false});$crudPopup.parent(".ui-dialog").addClass("pq-grid-dialog");$crudPopup.on("dialogopen",function(evt,ui){self.onDialogOpen()});var $toolbar=$("<div class='pq-grid-toolbar pq-grid-toolbar-crud'></div>").appendTo($(".pq-grid-top",this.element));this.$toolbar=$toolbar};var cSearch=function(that){this.that=that;this.dust=[]};cSearch.prototype=new cToolBar;var _pSearch=cSearch.prototype;_pSearch._init=function(){this.txt="";this.rowIndices=[];this.curIndx=null;this.dataIndx=null;this.sortIndx=null;this.sortDir=null;this.results=null;this.$toolbar=null};_pSearch.remove=function(){var that=this.that;this.$toolbar.remove();this.rowIndices=[];$(that.element).off(".pqsearch")};_pSearch.create=function(){var that=this.that,self=this;this._init();this._createDOM();var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"refresh.pqsearch",function(){var DM=that.options.dataModel,location=DM.location;if(location=="local"){self.highlight()}});that.element.on(widgetEventPrefix+"sort.pqsearch",function(){var DM=that.options.dataModel,location=DM.location;if(location=="local"){}})};_pSearch.prevResult=function(){var dataIndx=this.dataIndx,rowIndices=this.rowIndices;if(rowIndices.length==0){this.curIndx=null}else{if(this.curIndx==null||this.curIndx==0){this.curIndx=rowIndices.length-1}else{this.curIndx--}}this.updateSelection()};_pSearch.nextResult=function(){var rowIndices=this.rowIndices;if(rowIndices.length==0){this.curIndx=null}else{if(this.curIndx==null){this.curIndx=0}else{if(this.curIndx<rowIndices.length-1){this.curIndx++}else{this.curIndx=0}}}this.updateSelection()};_pSearch.updateSelection=function(){var that=this.that,dataIndx=this.dataIndx,curIndx=this.curIndx,rowIndices=this.rowIndices;if(dataIndx==null){return}if(rowIndices.length>0){this.results.html("Selected "+(curIndx+1)+" of "+rowIndices.length+" match(es).")}else{this.results.html("Nothing found.")}that.setSelection(null);that.refreshColumn({dataIndx:dataIndx});that.setSelection({rowIndx:rowIndices[curIndx],dataIndx:dataIndx});this.highlight()};_pSearch.search=function(){var that=this.that,txtUpper=this.$input.val().toUpperCase(),dataIndx=this.$select.val(),CM=that.colModel,colIndx=that.getColIndx({dataIndx:dataIndx}),dataType=CM[colIndx].dataType,thisOptions=that.options,DM=thisOptions.dataModel,sortIndx=DM.sortIndx,sortDir=DM.sortDir;if(txtUpper==this.txt&&dataIndx==this.dataIndx&&sortIndx==this.sortIndx&&sortDir==this.sortDir){return}this.rowIndices=[];this.curIndx=null;this.sortIndx=sortIndx;this.sortDir=sortDir;if(this.dataIndx!=null&&dataIndx!=this.dataIndx){thisOptions.customData=null;that.refreshColumn({dataIndx:this.dataIndx})}this.dataIndx=dataIndx;if(txtUpper!=null&&txtUpper.length>0){var data=DM.data;for(var i=0,len=data.length;i<len;i++){var rowData=data[i];if(this._isMatch(rowData,dataType,dataIndx,txtUpper)){this.rowIndices.push(i)}}}this.txt=txtUpper};_pSearch.highlightTextNodes=function(node){var self=this,txt=this.txt,txtUpper=this.txt.toUpperCase();function getTextNodes(node){if(node.nodeType==3){var val=node.nodeValue,valUpper=val.toUpperCase(),indx=valUpper.indexOf(txtUpper);if(indx>=0){var txt1=val.substring(0,indx);var txt2=val.substring(indx,indx+txt.length);var txt3=val.substring(indx+txt.length);var html=txt1+"<span class='ui-state-highlight'>"+txt2+"</span>"+txt3;$(node).replaceWith(html)}}else{for(var i=0,len=node.childNodes.length;i<len;++i){getTextNodes(node.childNodes[i])}}}getTextNodes(node)};_pSearch.render=function(){var that=this.that,rowIndices=this.rowIndices,offset=that.rowIndxOffset,DM=that.options.dataModel,PM=that.options.pageModel,location=DM.location,len=(location==="local")?rowIndices.length:DM.rPP,paging=(PM.type==="local"||PM.type==="remote")?true:false,colIndx=that.getColIndx({dataIndx:this.dataIndx});if($.trim(this.txt)==""){return}for(var i=0;i<len;i++){var rowIP;if(location==="local"){rowIP=rowIndices[i]-offset;if(paging&&(rowIP<0||rowIP>=DM.rPP)){continue}}else{rowIP=i}var $td=that.getCell({rowIndxPage:rowIP,colIndx:colIndx});if($td&&$td.length>0){for(var j=0;j<$td.length;j++){this.highlightTextNodes($td[j])}}}};_pSearch.highlight=function(){var that=this.that,thisOptions=that.options,TBM=thisOptions.toolBarModel,toolbars=TBM.toolbars;if(toolbars&&toolbars.search&&toolbars.search.highlight){this.render()}};var cHeaderSearch=function(that){this.that=that;var self=this;this.dataHS={};var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"headerkeydown",function(evt,ui){var $src=$(evt.originalEvent.target);if($src.hasClass("pq-search-hd-field")){return self.onKeyDown(evt,ui,$src)}else{return true}});that.element.on(widgetEventPrefix+"createheader",function(evt,ui){return self._onCreateHeader()})};var _pHeaderSearch=cHeaderSearch.prototype=new cSearch;_pHeaderSearch.onChange=function(evt,ui,$this){throw ("not being used");var that=this.that,CM=that.colModel,dataIndx=$this.attr("pq-dataIndx"),column=that.getColumn({dataIndx:dataIndx}),filter=column.filter,fvalue=filter.value,thisOptions=that.options,DM=thisOptions.dataModel,location=DM.location,val=$.trim($this.val());if(dataIndx!=null){if(fvalue==val||(val==""&&fvalue==null)){return}filter.value=val;filter.on=true;if(that._trigger("beforeFilter",null,{filterData:that.getFilterData(),colModel:CM,dataModel:DM})==false){return}if(location=="local"){that.refreshDataAndView({header:false})}else{if(location=="remote"){that.refreshDataAndView({header:false})}}}};_pHeaderSearch.onKeyDown=function(evt,ui,$this){var that=this.that,keyCode=evt.keyCode,keyCodes=$.ui.keyCode,dataIndx=$this.attr("pq-dataIndx"),freezeCols=that.options.freezeCols;if(keyCode===keyCodes.TAB){var colIndx=that.getColIndx({dataIndx:dataIndx}),CM=that.colModel,shiftKey=evt.shiftKey,$tbl_left,$tbl_right;var col=colIndx;do{if(shiftKey){col--}else{col++}if(col<0||col>=CM.length){break}var column=CM[col],$inp,dIndx=column.dataIndx,selector="input[pq-dataIndx='"+dIndx+"'],select[pq-dataIndx='"+dIndx+"']";if(column.hidden){continue}if(!column.filter){continue}that.scrollColumn({colIndx:col});$tbl_left=$(that.$tbl_header[0]);$tbl_right=$(that.$tbl_header[(that.$tbl_header.length==2)?1:0]);if(col>=freezeCols){$inp=$tbl_right.find(selector)}else{$inp=$tbl_left.find(selector)}if($inp){$inp.focus();evt.preventDefault();return false}else{break}}while(1===1)}else{return true}};_pHeaderSearch._onCreateHeader=function(){var that=this.that,CM=that.colModel,freezeCols=that.options.freezeCols,$tbl_left=$(that.$tbl_header[0]),$tbl_right=$(that.$tbl_header[1]),selector="input,select";$tbl_left.find(selector).css("visibility","hidden");for(var i=0;i<freezeCols;i++){var column=CM[i];var dIndx=column.dataIndx;var selector="*[pq-dataIndx='"+dIndx+"']";$tbl_left.find(selector).css("visibility","visible");$tbl_right.find(selector).css("visibility","hidden")}for(var i=0,len=CM.length;i<len;i++){var column=CM[i],filter=column.filter;if(filter){var value=filter.value;var listeners=filter.listeners;if(listeners){var dataIndx=column.dataIndx,selector=".pq-search-hd-field[pq-dataIndx='"+dataIndx+"']",ele=that.$header_o.find(selector);for(var j=0;j<listeners.length;j++){var listener=listeners[j];for(var event in listener){var handler=listener[event];(function(handler,dataIndx){ele.bind(event,function(evt){var column=that.getColumn({dataIndx:dataIndx});return handler.call(this,evt,{column:column})})})(handler,dataIndx)}}}}}};_pHeaderSearch.createDOM=function(buffer,td_const_cls){var that=this.that,self=this,initH=that.initH,finalH=that.finalH,hidearrHS=that.hidearrHS,thisOptions=that.options,freezeCols=thisOptions.freezeCols,virtualX=thisOptions.virtualX,CM=that.colModel,columnBorders=thisOptions.columnBorders,dataHS=this.dataHS,numberCell=thisOptions.numberCell;buffer.push("<tr class='pq-grid-header-search'>");if(numberCell.show){buffer.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='1'>","<div class='pq-grid-header-table-div'>&nbsp;</div></td>"].join(""))}for(var i=0;i<=finalH;i++){if(i<initH&&i>=freezeCols&&virtualX){i=initH;if(i>finalH){throw ("initH>finalH")}}var column=CM[i];if(column.hidden){continue}var td_cls=td_const_cls,align=column.halign;if(!align){align=column.align}if(align=="right"){td_cls+=" pq-align-right"}else{if(align=="center"){td_cls+=" pq-align-center"}}var filter=column.filter;if(filter){var dataIndx=column.dataIndx,type=filter.type,value=filter.value,wd=parseInt(column.width)+((columnBorders)?1:0),wd=wd-15,cls=filter.cls,cls="pq-search-hd-field "+(cls?cls:""),style=filter.style,style=style?style:"",attr=filter.attr,attr=attr?attr:"",strS="";if(type==="textbox"){value=value?value:"";cls=cls+" ui-corner-all pq-search-txt";strS=this._input(dataIndx,value,wd,cls,style,attr)}else{if(type==="select"){var so=filter.options;if(typeof so==="function"){so=so({colModel:CM})}value=value?value:"";cls=cls+" ui-corner-all";strS=this._dropDown(so,dataIndx,value,wd,cls,style,attr)}else{if(type=="checkbox"){var checked=(value==null||value==false)?"":"checked=checked";strS=["<input ",checked," pq-dataIndx='",dataIndx,"' type=checkbox class='"+cls+"' style='"+style+"' "+attr+"/>"].join("")}else{if(typeof type=="string"){strS=type}else{if(typeof type=="function"){strS=type({width:wd,value:value,colModel:CM,cls:cls})}}}}}buffer.push(["<td class='",td_cls,"'><div class='pq-grid-header-table-div' style='padding:0px 2px;' >","",strS,"</div></td>"].join(""))}else{buffer.push(["<td class='",td_cls,"'><div class='pq-grid-header-table-div' >","&nbsp;","</div></td>"].join(""))}}buffer.push("</tr>")};_pHeaderSearch._input=function(dataIndx,value,wd,cls,style,attr){return['<input value="',value,"\" pq-dataIndx='",dataIndx,"' type=text style='width:",wd,"px;"+style+"' class='"+cls+"' "+attr+" />"].join("")};_pHeaderSearch._dropDown=function(so,dataIndx,value,wd,cls,style,attr){var buffer=["<select pq-dataIndx='",dataIndx,"' class='"+cls+"' style='width:",wd,"px;"+style+"' "+attr+" >"],selected="";for(var i=0,len=so.length;i<len;i++){var option=so[i];if(option==value){selected="selected"}else{selected=""}buffer.push("<option value='"+option+"' "+selected+" >"+option+"</option>")}buffer.push("</select>");return buffer.join("")};var _pGenerateView={};_pGenerateView._generateTitleRow=function(GM,rowObj,buffer,lastFrozenRow){var that=this.that,thisOptions=that.options,numberCell=thisOptions.numberCell,groupTitle=rowObj.groupTitle,GMTitle=GM.title,groupLevel=rowObj.level,GMRowIndx=rowObj.GMRowIndx,GMIcon=GM.icon,GMIcon=GMIcon?GMIcon[groupLevel]:null,GMIcon=(GMIcon&&GMIcon.length&&GMIcon.length==2&&typeof GMIcon.push==="function")?GMIcon:["ui-icon-minus","ui-icon-plus"];if(GMTitle&&GMTitle[groupLevel]){groupTitle=GMTitle[groupLevel].replace("{0}",groupTitle);groupTitle=groupTitle.replace("{1}",rowObj.items)}else{groupTitle=groupTitle+" - "+rowObj.items+" item(s)"}buffer.push(["<tr class='pq-group-row pq-grid-row",(lastFrozenRow?" pq-last-freeze-row":""),"' title=\"",rowObj.groupTitle,"\" level='",groupLevel,"' GMRowIndx='",GMRowIndx,"'>"].join(""));if(numberCell.show){buffer.push("<td class='pq-grid-number-cell ui-state-default'><div class='pq-td-div'></div></td>")}var icon=GMIcon[0];if(rowObj.collapsed){icon=GMIcon[1]}buffer.push("<td class='pq-grid-cell' colSpan='100' >","<div class='pq-td-div' style='margin-left:",(groupLevel*16),"px;'>","<span class='ui-icon ",icon,"'></span>",groupTitle,"</div></td>");buffer.push("</tr>")};_pGenerateView._generateSummaryRow=function(rowData,thisColModel,buffer,lastFrozenRow){var row_cls="pq-summary-row pq-grid-row"+(lastFrozenRow?" pq-last-freeze-row":""),that=this.that,thisOptions=that.options,virtualX=thisOptions.virtualX,initH=that.initH,finalH=that.finalH,freezeCols=thisOptions.freezeCols,numberCell=thisOptions.numberCell,columnBorders=thisOptions.columnBorders,wrap=thisOptions.wrap,offset=this.offset;var const_cls="pq-grid-cell ";var row_str="<tr class='"+row_cls+"'>";buffer.push(row_str);if(numberCell.show){buffer.push(["<td class='pq-grid-number-cell ui-state-default'>","<div class='pq-td-div'>&nbsp;</div></td>"].join(""))}for(var col=0;col<=finalH;col++){if(col<initH&&col>=freezeCols&&virtualX){col=initH;if(col>finalH){throw ("initH>finalH")}}var column=thisColModel[col],dataIndx=column.dataIndx;if(column.hidden){continue}var strStyle="";var cls=const_cls;if(column.align=="right"){cls+=" pq-align-right"}else{if(column.align=="center"){cls+=" pq-align-center"}}if(col==freezeCols-1&&columnBorders){cls+=" pq-last-freeze-col"}if(column.cls){cls=cls+" "+column.cls}var valCell=(rowData[dataIndx]==null)?"&nbsp;":rowData[dataIndx];var str=["<td class='",cls,"' style='",strStyle,"' >","<div class='pq-td-div'>",valCell,"</div></td>"].join("");buffer.push(str)}buffer.push("</tr>");return buffer};_pGenerateView._generateDetailRow=function(rowData,rowIndx,thisColModel,buffer,objP,lastFrozenRow){var row_cls="pq-grid-row pq-detail-child";if(lastFrozenRow){row_cls+=" pq-last-freeze-row"}var that=this.that,thisOptions=that.options,numberCell=thisOptions.numberCell,CMLength=thisColModel.length,offset=this.offset;var const_cls="pq-grid-cell ";if(!thisOptions.wrap||objP){const_cls+="pq-wrap-text "}if(thisOptions.stripeRows&&(rowIndx/2==parseInt(rowIndx/2))){row_cls+=" pq-grid-oddRow"}if(rowData.pq_rowselect){row_cls+=" pq-row-select ui-state-highlight"}var pq_rowcls=rowData.pq_rowcls;if(pq_rowcls!=null){row_cls+=" "+pq_rowcls}buffer.push("<tr pq-row-indx='"+rowIndx+"' class='"+row_cls+"' >");if(numberCell.show){buffer.push(["<td class='pq-grid-number-cell ui-state-default'>","<div class='pq-td-div'>&nbsp;</div></td>"].join(""))}buffer.push("<td class='"+const_cls+" pq-detail-child' colSpan='20'></td>");buffer.push("</tr>");return buffer};var cTreeView=function(that){this.that=that};var _pTVM=cTreeView.prototype;_pTVM._onClickTreeExpandIcon=function(evt){var that=this.that,TVM=that.options.treeModel,rowIndxPage=parseInt($(evt.currentTarget).parents(".pq-grid-row").attr("pq-row-indx"),10),thisData=that.data,rowData=that.data[rowIndxPage],level=rowData[TVM.levelIndx],expanded=that._getRowPQData(rowIndxPage,"expanded");if(expanded){that._setRowPQData(rowIndxPage,{expanded:false});for(var i=rowIndxPage+1,len=thisData.length;i<len;i++){var rowData2=thisData[i];var level2=rowData2[TVM.levelIndx];if(level2==level){break}else{that._setRowPQData(i,{hidden:true})}}}else{that._setRowPQData(rowIndxPage,{expanded:true});this._nestedShowNodes(level,rowIndxPage,TVM.levelIndx,TVM.leafIndx)}that._refresh();evt.preventDefault();return false};_pTVM._nestedShowNodes=function(level,rowIndxPage,levelIndx,leafIndx){var that=this.that,thisData=that.data;for(var i=rowIndxPage+1,len=thisData.length;i<len;i++){var rowData2=thisData[i];var level2=rowData2[levelIndx],isLeaf=rowData2[leafIndx];if(level2==level+1){that._setRowPQData(i,{hidden:false});if(!isLeaf){var expanded=that._getRowPQData(i,"expanded");if(expanded){this._nestedShowNodes(level2,i,levelIndx,leafIndx)}}}else{if(level2==level){break}}}};_pTVM._refreshDataFromDataModel=function(){var that=this.that,TVM=that.options.treeModel,levelIndx=TVM.levelIndx,leafIndx=TVM.leafIndx,thisData=that.data,expanded=TVM.expanded,parents=[];for(var i=0,len=thisData.length;i<len;i++){var rowData=thisData[i],isLeaf=rowData[leafIndx],level=rowData[levelIndx];if(expanded){if(!isLeaf){that._setRowPQData(i,{expanded:true})}}else{if(!isLeaf){that._setRowPQData(i,{expanded:false})}if(level!=0){that._setRowPQData(i,{hidden:true})}}if(!isLeaf){parents[level]=rowData}if(level>0){that._setRowPQData(i,{parent:parents[level-1]})}}};var cGroupView=function(that){this.that=that};var _pGroupView=cGroupView.prototype;_pGroupView._refreshDataFromDataModelNotUsedOld=function(){this._groupArrays();var dataGM=this.dataGM;for(var i=0,len=dataGM.length;i<len;i++){var rowIndx=dataGM[i].rowIndx;if(rowIndx==begIndx){if(dataGM[i-1].rowIndx==null){begIndx=i-1}else{begIndx=i}}else{if(rowIndx==endIndx){if(dataGM[i+1].rowIndx==null){endIndx=i+1}else{endIndx=i}}}}this.data=this.dataGM.slice(begIndx,endIndx)};_pGroupView.showHideRows=function(initIndx,level,hide){var arr=[],that=this.that,data=that.dataGM;for(var i=initIndx,len=data.length;i<len;i++){var rowObj=data[i],rowData=rowObj;if(rowData.groupSummary){if(rowObj.level<level){break}else{rowObj.pq_hidden=hide}}else{if(rowData.groupTitle){if(rowObj.collapsed){arr.push({indx:i,level:rowObj.level})}if(rowObj.level<=level){break}else{rowObj.pq_hidden=hide}}else{rowObj.pq_hidden=hide}}}return arr};_pGroupView.onClickGroupRow=function(evt){var $tr=$(evt.currentTarget),that=this.that;var level=parseInt($tr.attr("level")),GMRowIndx=parseInt($tr.attr("GMRowIndx")),data=that.dataGM,collapsed=true,rowObj=data[GMRowIndx];if(!rowObj.collapsed){rowObj.collapsed=true;collapsed=true}else{rowObj.collapsed=false;collapsed=false}if(collapsed){this.showHideRows(GMRowIndx+1,level,true)}else{var arr=this.showHideRows(GMRowIndx+1,level,false);for(var j=0;j<arr.length;j++){var indx=arr[j].indx;var level=arr[j].level;this.showHideRows(indx+1,level,true)}}that._refresh()};_pGroupView.initcollapsed=function(){var that=this.that,data=that.dataGM;if(!data){return}for(var i=0,len=data.length;i<len;i++){var rowData=data[i],groupTitle=rowData.groupTitle;if(groupTitle!==undefined){var level=rowData.level,collapsed=rowData.collapsed;if(collapsed){this.showHideRows(i+1,level,true)}}}};_pGroupView.max=function(arr,dataType){var ret;if(dataType=="integer"||dataType=="float"){ret=Math.max.apply(Math,arr);if(dataType==="float"){ret=ret.toFixed(2)}}else{if(dataType=="date"){arr=arr.sort(function(a,b){a=Date.parse(a);b=Date.parse(b);return(a-b)});ret=arr[arr.length-1]}else{arr=arr.sort();ret=arr[arr.length-1]}}return ret};_pGroupView.min=function(arr,dataType){var ret;if(dataType=="integer"||dataType=="float"){ret=Math.min.apply(Math,arr);if(dataType==="float"){ret=ret.toFixed(2)}}else{if(dataType=="date"){arr=arr.sort(function(a,b){a=Date.parse(a);b=Date.parse(b);return(a-b)});ret=arr[0]}else{arr=arr.sort();ret=arr[0]}}return ret};_pGroupView.count=function(arr){return arr.length};_pGroupView.sum=function(arr,dataType){var s=0,fn;if(dataType==="float"){fn=parseFloat}else{if(dataType==="integer"){fn=parseInt}else{fn=function(val){return val}}}for(var i=0,len=arr.length;i<len;i++){s+=fn(arr[i])}if(dataType==="float"){s=s.toFixed(2)}return s};_pGroupView._groupData=function(data){var that=this.that,thisOptions=that.options,GM=thisOptions.groupModel,PM=thisOptions.pageModel,CM=that.colModel,rowOffset=(PM.type)?((PM.curPage-1)*PM.rPP):0,CMLength=CM.length,GMdataIndx=GM.dataIndx,GMLength=GMdataIndx.length,GMcollapsed=GM.collapsed,groupSummaryShow=[];for(var u=0;u<GMLength;u++){groupSummaryShow[u]=false;for(var v=0;v<CMLength;v++){var column=CM[v],summary=column.summary;if(!summary){continue}var summaryType=summary.type;if(!summaryType||typeof summaryType.push!="function"){continue}if(summaryType[u]){groupSummaryShow[u]=true;break}}}if(GM&&data&&data.length>0){var dataGM=[],titleIndx=[],groupVal=[],prevGroupVal=[],cols=[];for(var u=0;u<GMLength;u++){prevGroupVal[u]="";groupVal[u]="";cols[u]={}}for(var i=0,len=data.length;i<=len;i++){var rowData=data[i];var changeGroup=false,changeGroupIndx=null;for(var u=0;u<GMLength;u++){groupVal[u]=(i<len)?$.trim(rowData[GMdataIndx[u]]):"";if(prevGroupVal[u]!=groupVal[u]){changeGroup=true}if(changeGroup&&changeGroupIndx==null){changeGroupIndx=u}}if(changeGroup){for(var l=0;l<GMLength;l++){prevGroupVal[l]=groupVal[l]}if(i>0){for(var u=GMLength-1;u>=changeGroupIndx;u--){if(groupSummaryShow[u]){var groupRowData=[];for(var f=0;f<CMLength;f++){var column=CM[f],summary=column.summary,summaryType=(summary)?(summary.type?summary.type[u]:null):null;if(summaryType){var dataIndx=column.dataIndx,summaryCellData="",summaryTitle=summary.title?summary.title[u]:null,sText="{0}";if(typeof summaryType=="function"){summaryCellData=summaryType(cols[u][dataIndx],column.dataType)}else{sText=summaryType+": {0}";summaryCellData=this[summaryType](cols[u][dataIndx],column.dataType)}if(summaryTitle){sText=summaryTitle}groupRowData[dataIndx]=sText.replace("{0}",summaryCellData)}}dataGM.push({groupSummary:true,level:u,data:groupRowData})}}for(var m=changeGroupIndx;m<GMLength;m++){dataGM[titleIndx[m]].items=cols[m][CM[0].dataIndx].length}}if(i==len){break}for(var z=GMLength-1;z>=changeGroupIndx;z--){for(var e=0;e<CMLength;e++){var column=CM[e];cols[z][column.dataIndx]=[]}}for(var m=changeGroupIndx;m<GMLength;m++){dataGM.push({groupTitle:groupVal[m],level:m,GMRowIndx:dataGM.length,collapsed:(GMcollapsed&&(GMcollapsed[m]!=null))?GMcollapsed[m]:false});titleIndx[m]=dataGM.length-1}}rowData.rowIndx=i+rowOffset;rowData.pq_hidden=false;dataGM.push(rowData);for(var k=0;k<CMLength;k++){var column=CM[k],dataIndx=column.dataIndx;for(var u=0;u<GMLength;u++){cols[u][dataIndx].push(rowData[dataIndx])}}}that.dataGM=dataGM}};var cDragColumns=function(that){this.that=that;this.$drag_helper=null;var dragColumns=that.options.dragColumns,topIcon=dragColumns.topIcon,bottomIcon=dragColumns.bottomIcon,self=this;this.status="stop";this.$arrowTop=$("<div class='pq-arrow-down ui-icon "+topIcon+"'></div>").appendTo(that.element);this.$arrowBottom=$("<div class='pq-arrow-up ui-icon "+bottomIcon+"' ></div>").appendTo(that.element);this.hideArrows();if(dragColumns&&dragColumns.enabled){that.$header.on("touchstart mousedown","td.pq-grid-col",function(evt,ui){if($.support.touch){if(evt.type=="touchstart"){var touch=evt.originalEvent.touches[0];if(touch.pq_composed){return}evt.preventDefault();self.setDraggables(evt,ui);var evt2=document.createEvent("UIEvent");evt2.initUIEvent("touchstart",true,true);evt2.view=window;evt2.altKey=false;evt2.ctrlKey=false;evt2.shiftKey=false;evt2.metaKey=false;evt2.touches=[{pageX:evt.pageX,pageY:evt.pageY,pq_composed:true}];evt2.changedTouches=[{pageX:evt.pageX,pageY:evt.pageY,pq_composed:true}];evt.target.dispatchEvent(evt2)}}else{if(!evt.pq_composed){self.setDraggables(evt,ui);evt.pq_composed=true;var e=$.Event("mousedown",evt);$(evt.target).trigger(e)}}})}};var _pDragColumns=cDragColumns.prototype;_pDragColumns.showFeedback=function($td,leftDrop){var that=this.that;var td=$td[0];var offParent=td.offsetParent.offsetParent;var left=td.offsetLeft+offParent.offsetLeft+((!leftDrop)?td.offsetWidth:0)-8;var top=that.$grid_inner[0].offsetTop+td.offsetTop-16;var top2=that.$grid_inner[0].offsetTop+that.$header[0].offsetHeight;this.$arrowTop.css({left:left,top:top,display:""});this.$arrowBottom.css({left:left,top:top2,display:""})};_pDragColumns.showArrows=function(){this.$arrowTop.show();this.$arrowBottom.show()};_pDragColumns.hideArrows=function(){this.$arrowTop.hide();this.$arrowBottom.hide()};_pDragColumns.updateDragHelper=function(accept){var that=this.that,dragColumns=that.options.dragColumns,acceptIcon=dragColumns.acceptIcon,rejectIcon=dragColumns.rejectIcon,$drag_helper=this.$drag_helper;if(!$drag_helper){return}if(accept){$drag_helper.children("span.pq-drag-icon").addClass(acceptIcon).removeClass(rejectIcon);$drag_helper.removeClass("ui-state-error")}else{$drag_helper.children("span.pq-drag-icon").removeClass(acceptIcon).addClass(rejectIcon);$drag_helper.addClass("ui-state-error")}};_pDragColumns.setDraggables=function(evt,ui){var $td=$(evt.currentTarget),that=this.that,dragColumns=that.options.dragColumns,rejectIcon=dragColumns.rejectIcon,self=this;if($td.hasClass("ui-draggable")){return}if(!that.getHeaderColumnFromTD($td)){return}$td.draggable({distance:10,cursorAt:{top:-18,left:-10},helper:function(){var $this=$(this);self.status="helper";self._setupDroppables($this);that.$header.find(".pq-grid-col-resize-handle").hide();var colIndx=$this.attr("pq-col-indx");var rowIndx=$this.attr("pq-row-indx");$this.droppable("destroy");var column=that.headerCells[rowIndx][colIndx];var $drag_helper=$("<div class='pq-col-drag-helper ui-widget-content ui-corner-all' ><span class='pq-drag-icon ui-icon "+rejectIcon+"'></span>"+column.title+"</div>");self.$drag_helper=$drag_helper;return $drag_helper[0]},zIndex:"1000",appendTo:that.element,revert:"invalid",drag:function(evt,ui){self.status="drag";var $td=$("td.pq-drop-hover",that.$header);if($td.length>0){self.showArrows();self.updateDragHelper(true);var wd=$td.width();var lft=evt.clientX-$td.offset().left;if(lft<wd/2){self.leftDrop=true;self.showFeedback($td,true)}else{self.leftDrop=false;self.showFeedback($td,false)}}else{self.hideArrows();if(that.$toolbar.hasClass("pq-drop-hover")){self.updateDragHelper(true)}else{self.updateDragHelper()}}},stop:function(evt,ui){self.status="stop";that.$header.find(".pq-grid-col-resize-handle").show();self.hideArrows()}})};_pDragColumns._columnIndexOf=function(colModel,column){for(var i=0,len=colModel.length;i<len;i++){if(colModel[i]==column){return i}}return -1};_pDragColumns.refreshSorting=function(){var that=this.that;window.setTimeout(function(){var arr=that.$toolbar.sortable("toArray",{attribute:"sorter"});that.sorters=[];for(var i=0,len=arr.length;i<len;i++){that.sorters.push(eval("("+arr[i]+")"))}that.sortLocalData(that.sorters,that.data);that.refresh()},0)};_pDragColumns._setupDroppables=function($td){var that=this.that,self=this;var objDrop={hoverClass:"pq-drop-hover ui-state-highlight",tolerance:"pointer",drop:function(evt,ui){if(that.dropPending){return}var colIndxDrag=parseInt(ui.draggable.attr("pq-col-indx"),10);var rowIndxDrag=parseInt(ui.draggable.attr("pq-row-indx"),10);var colIndxDrop=parseInt($(this).attr("pq-col-indx"),10);var rowIndxDrop=$(this).attr("pq-row-indx");var optCM=that.options.colModel;var headerCells=that.headerCells;var columnDrag=headerCells[rowIndxDrag][colIndxDrag];var colModelDrag,colModelDrop;if(rowIndxDrag==0){colModelDrag=optCM}else{colModelDrag=headerCells[rowIndxDrag-1][colIndxDrag].colModel}if(rowIndxDrop==0){colModelDrop=optCM}else{colModelDrop=headerCells[rowIndxDrop-1][colIndxDrop].colModel}var columnDrop=headerCells[rowIndxDrop][colIndxDrop];var indxDrag=self._columnIndexOf(colModelDrag,columnDrag);var column=colModelDrag.splice(indxDrag,1)[0];var indxDrop=self._columnIndexOf(colModelDrop,columnDrop);var decr=(self.leftDrop)?1:0;colModelDrop.splice(indxDrop+1-decr,0,column);that.dropPending=true;window.setTimeout(function(){that._calcThisColModel();that._refresh();that.dropPending=false},0)}};var $tds=that.$header_left.find("td.pq-left-col");var $tds2=that.$header_right.find("td.pq-right-col");$tds=$tds.add($tds2);$tds.each(function(i,td){var $td=$(td);if($td.hasClass("ui-droppable")){return}$td.droppable(objDrop)});return;var column=that.getHeaderColumnFromTD($td);var dataIndx=column.dataIndx;if(that.getIndxInSorters(dataIndx)!=-1){if(that.$toolbar.hasClass("ui-droppable")){that.$toolbar.droppable("destroy")}return}that.$toolbar.droppable({hoverClass:"pq-drop-hover ui-state-highlight",tolerance:"pointer",drop:function(evt,ui){var colIndxDrag=parseInt(ui.draggable.attr("pq-col-indx"),10);var rowIndxDrag=parseInt(ui.draggable.attr("pq-row-indx"),10);var optCM=that.options.colModel;var headerCells=that.headerCells;var columnDrag=headerCells[rowIndxDrag][colIndxDrag];var colModelDrag;if(rowIndxDrag==0){colModelDrag=optCM}else{colModelDrag=headerCells[rowIndxDrag-1][colIndxDrag].colModel}var indxDrag=self._columnIndexOf(colModelDrag,columnDrag);var column=colModelDrag[indxDrag];var dataIndx=column.dataIndx;var dataType=column.dataType;that.sorters.push({dataIndx:dataIndx,dataType:dataType,dir:"up"});$("<span class='pq-sortable' sorter=\"{dataIndx:"+dataIndx+",dataType:'"+dataType+"',dir:'up'}\">"+column.title+"</span>").appendTo(that.$toolbar).button({icons:{primary:"ui-icon-triangle-1-n",secondary:"ui-icon-close"}}).mouseover(function(evt){var $target=$(evt.target);if($target.is("span.ui-icon-close")){$target.css("outline","1px solid black")}}).mouseout(function(evt){var $target=$(evt.target);if($target.is("span.ui-icon-close")){$target.css("outline","")}}).click(function(evt){var $button=$(this);if($(evt.target).is("span.ui-icon-close")){window.setTimeout(function(){$button.button("destroy");$button.remove();self.refreshSorting()},0)}else{var sorter=eval("("+$button.attr("sorter")+")");if(sorter.dir=="up"){sorter.dir="down";$button.button({icons:{primary:"ui-icon-triangle-1-s",secondary:"ui-icon-close"}})}else{sorter.dir="up";$button.button({icons:{primary:"ui-icon-triangle-1-n",secondary:"ui-icon-close"}})}var sorterStr="{dataIndx:"+sorter.dataIndx+",dataType:'"+sorter.dataType+"',dir:'"+sorter.dir+"'}";$button.attr("sorter",sorterStr);self.refreshSorting()}});self.refreshSorting();window.setTimeout(function(){that.$toolbar.droppable("destroy")},0)}})};var cHistory=function(that){this.that=that;this.records=[];this.counter=0};var _pHistory=cHistory.prototype;_pHistory.push=function(arr){if(this.records.length>this.counter){this.records.splice(this.counter,(this.records.length-this.counter))}this.records[this.counter]=arr;this.counter++};_pHistory.undo=function(){var that=this.that;if(this.counter>0){this.counter--}else{return false}var op=this.records[this.counter];if(op.type=="update"){var rowData=op.rowData,dataIndx=op.dataIndx,oldVal=rowData[dataIndx],newVal=op.oldVal,rowIndx=that.getRowIndx({rowData:rowData}).rowIndx;rowData[dataIndx]=newVal;that.iUCData.update({rowData:rowData,dataIndx:dataIndx,oldVal:oldVal,newVal:newVal});that.goToPage({rowIndx:rowIndx});that.refreshCell({rowIndx:rowIndx,dataIndx:dataIndx})}else{if(op.type=="add"){var rowData=op.rowData,rowIndx=that.getRowIndx({rowData:rowData}).rowIndx;op.rowIndx=rowIndx;that.deleteRow({rowIndx:rowIndx,skipHistory:true})}else{if(op.type=="delete"){var rowData=op.rowData,rowIndx=op.rowIndx;that.addRow({rowData:rowData,rowIndx:rowIndx,skipHistory:true})}}}return true};_pHistory.redo=function(){var that=this.that;if(this.counter==this.records.length){return false}var op=this.records[this.counter];if(op.type=="update"){var rowData=op.rowData,dataIndx=op.dataIndx,oldVal=rowData[dataIndx],newVal=op.newVal,rowIndx=that.getRowIndx({rowData:rowData}).rowIndx;that.goToPage({rowIndx:rowIndx});that.iUCData.update({rowData:rowData,dataIndx:dataIndx,oldVal:oldVal,newVal:newVal});rowData[dataIndx]=newVal;that.refreshCell({rowIndx:rowIndx,dataIndx:dataIndx})}else{if(op.type=="add"){var rowData=op.rowData,rowIndx=op.rowIndx;that.addRow({rowData:rowData,rowIndx:rowIndx,skipHistory:true})}else{if(op.type=="delete"){var rowData=op.rowData,rowIndx=that.getRowIndx({rowData:rowData}).rowIndx;that.deleteRow({rowIndx:rowIndx,skipHistory:true})}}}if(this.counter<this.records.length){this.counter++}return true};fn.options={detailModel:{cache:true,offset:100,expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},dragColumns:{enabled:true,acceptIcon:"ui-icon-check",rejectIcon:"ui-icon-closethick",topIcon:"ui-icon-circle-arrow-s",bottomIcon:"ui-icon-circle-arrow-n"},track:false,virtualX:true,filterModel:{on:true,mode:"AND",header:false}};fn._create=function(){$.extend($.paramquery.cGenerateView.prototype,_pGenerateView);var that=this,thisOptions=this.options;this.iHistory=new cHistory(this);this.iGroupView=new cGroupView(this);this.cTreeView=new cTreeView(this);this.iSearch=new cSearch(this);this.iHeaderSearch=new cHeaderSearch(this);this.iCRUD=new cCRUD(this);this.iUCData=new $.paramquery.cUCData(this);this.pqSheet={};var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();this.element.on(widgetEventPrefix+"keydown",function(evt,ui){if(!that.$td_edit){that._onKeyDownSheet(evt,ui)}});new cMouseSelection(this);this._super.apply(this);this.$cont.on("click","tr.pq-group-row",function(evt){return that.iGroupView.onClickGroupRow(evt)});this.pqSheet={};this.iDragColumns=new cDragColumns(this);this._createToolbar();this._createIconList();this._initTypeColumns();this.refresh()};fn._createToolbar=function(){var that=this,options=this.options,toolbar=options.toolbar;if(toolbar){var tb=toolbar,cls=tb.cls,cls=cls?cls:"",style=tb.style,style=style?style:"",attr=tb.attr,attr=attr?attr:"",items=tb.items;var $toolbar=$("<div class='"+cls+"' style='"+style+"' "+attr+" ></div>").appendTo($(".pq-grid-top",this.element));$toolbar.pqToolbar({items:items,gridInstance:this});if(!options.showToolbar){$toolbar.css("display","none")}this.$toolbar=$toolbar}};fn.isLeftOrRight=function(colIndx){var thisOptions=this.options,freezeCols=this.freezeCols;if(colIndx>freezeCols){return"right"}else{return"left"}};fn.ovCreateHeader=function(buffer,const_cls){if(this.options.filterModel.header){this.iHeaderSearch.createDOM(buffer,const_cls)}};fn._createHeader=function(){this._super.apply(this);if(this.options.showHeader){this._trigger("createHeader")}};fn.exportExcel=function(obj){obj.format="xml";return $.paramquery.pqgrid.exportToExcel.call(this,obj)};fn.exportCsv=function(obj){obj.format="csv";return $.paramquery.pqgrid.exportToExcel.call(this,obj)};fn.filter=function(objP){var replace=(objP.oper=="replace")?true:false,arrS=objP.data,CM=this.colModel,foundCount=0,CMLength=CM.length,arrSLength=arrS.length;for(var i=0;i<CMLength;i++){var column=CM[i],found=false;for(var j=0;j<arrSLength;j++){if(foundCount==arrSLength){break}var obj=arrS[j];if(obj.dataIndx==column.dataIndx){found=true;foundCount++;var filter=column.filter;if(filter){filter.on=true;filter.value=obj.value;if(obj.condition){filter.condition=obj.condition}}else{column.filter={condition:obj.condition,value:obj.value,on:true}}break}}if(replace&&!found&&column.filter){column.filter.on=false}}this.refreshDataAndView({header:false})};fn._refreshHeader=function(){throw ("not used");var thisOptions=this.options,numberCell=thisOptions.numberCell,columnBorders=thisOptions.columnBorders,CM=this.colModel,$tbl_header=this.$tbl_header;var $tr1=$($($tbl_header[0]).children("tbody").children("tr")[0]);var $tds1=$tr1.find("td");if($tbl_header.length>1){var $tr2=$($($tbl_header[1]).children("tbody").children("tr")[0]);var $tds2=$tr2.find("td")}var k=0;if(numberCell.show){$tds1[0].style.width=(numberCell.width+1)+"px";if($tds2&&$tds2[0]){$tds2[0].style.width=(numberCell.width+1)+"px"}k=1}for(var i=0;i<CM.length;i++){var column=CM[i];if(column.hidden){continue}var wd=parseInt(column.width)+((columnBorders)?1:0);$tds1[k].style.width=wd+"px";if($tds2&&$tds2[k]){$tds2[k].style.width=wd+"px"}k++}};fn._initTypeColumns=function(){var CM=this.colModel;for(var i=0;i<CM.length;i++){var column=CM[i];if(column.type==="checkBoxSelection"){new cCheckBoxColumn(this)}else{if(column.type==="detail"){column.dataIndx="pq_detail";this.iHierarchy=new cHierarchy(this)}}}};fn.refreshHeader=function(){this._createHeader()};fn.refreshDataFromDataModel=function(){this._super.apply(this);var thisOptions=this.options,DM=thisOptions.dataModel,GM=thisOptions.groupModel,GMTrue=(GM)?true:false,TVM=thisOptions.treeModel,TVTrue=(TVM)?true:false;if(GMTrue){this.iGroupView._groupData(this.data);this.iGroupView.initcollapsed()}else{if(TVTrue){this.cTreeView._refreshDataFromDataModel()}}};fn._refreshSorters=function(pDataIndx){var thisOptions=this.options,DM=thisOptions.dataModel,DMsortIndx=DM.sortIndx,multiSort=$.isArray(DMsortIndx),GM=thisOptions.groupModel,GMdataIndx=GM?GM.dataIndx:null,GMDir=GM?GM.dir:null,foundInGMIndx=-1,sorters=[];if(GM){for(var i=0;i<GMdataIndx.length;i++){var gDataIndx=GMdataIndx[i];if(gDataIndx==pDataIndx){foundInGMIndx=i}sorters.push({dataIndx:gDataIndx,dir:(GMDir&&GMDir[i])?GMDir[i]:"up"})}}if(foundInGMIndx!==-1){var dir=sorters[foundInGMIndx].dir;var newDir=(dir==="up")?"down":"up";sorters[foundInGMIndx].dir=newDir;GMDir[foundInGMIndx]=newDir}else{if(pDataIndx!=null){if(multiSort){var indx=$.inArray(pDataIndx,DM.sortIndx);if(indx!=-1){if(DM.sortDir[indx]=="up"){DM.sortDir[indx]="down"}else{if(DMsortIndx.length==1){DM.sortDir[indx]="up"}else{DM.sortIndx.splice(indx,1);DM.sortDir.splice(indx,1)}}}else{var len=DM.sortIndx.length;DM.sortIndx[len]=pDataIndx;DM.sortDir[len]="up"}}else{if(DM.sortIndx==pDataIndx){DM.sortDir=(DM.sortDir=="up")?"down":"up"}else{DM.sortIndx=pDataIndx;DM.sortDir="up"}}}}if(DM.sortIndx!=null){if(multiSort){for(var i=0;i<DMsortIndx.length;i++){var dataIndx=DMsortIndx[i];if(this.inSorters(sorters,dataIndx)==-1){sorters.push({dataIndx:dataIndx,dir:DM.sortDir[i]})}}}else{if(this.inSorters(sorters,DM.sortIndx)==-1){sorters.push({dataIndx:DM.sortIndx,dir:DM.sortDir})}}}this.sorters=sorters};fn.inSorters=function(sorters,dataIndx){var found=-1;for(var i=0;i<sorters.length;i++){var sorter=sorters[i];if(sorter.dataIndx==dataIndx){found=i;break}}return found};fn._sortLocalData=function(data){var thisOptions=this.options,DM=thisOptions.dataModel,CM=this.colModel,sorters=this.sorters;for(var i=0;i<sorters.length;i++){var sorter=sorters[i],dataIndx=sorter.dataIndx,colIndx=this.getColIndx({dataIndx:dataIndx}),dataType=CM[colIndx].dataType;sorter.dataType=dataType}this.__sortLocalData(sorters,DM.data)};fn.__sortLocalData=function(sorters,data){if(data==null||data.length==0||sorters.length==0){return}function innerSort(){function sort_composite(obj1,obj2){var ret=0;for(var i=0,len=sorters.length;i<len;i++){var sorter=sorters[i],dataIndx=sorter.dataIndx,dir=(sorter.dir=="up")?1:-1,dataType=sorter.dataType;if(dataType=="integer"){ret=sort_integer(obj1,obj2,dataIndx,dir)}else{if(dataType=="float"){ret=sort_float(obj1,obj2,dataIndx,dir)}else{if(typeof dataType=="function"){ret=sort_custom(obj1,obj2,dataIndx,dir,dataType)}else{if(dataType=="date"){ret=sort_date(obj1,obj2,dataIndx,dir)}else{ret=sort_string(obj1,obj2,dataIndx,dir)}}}}if(ret!=0){break}}return ret}function sort_integer(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?parseInt(val1,10):0;val2=val2?parseInt(val2,10):0;return((val1-val2)*dir)}function sort_date(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?Date.parse(val1):0;val2=val2?Date.parse(val2):0;return((val1-val2)*dir)}function sort_custom(obj1,obj2,dataIndx,dir,dataType){var val1=obj1[dataIndx];var val2=obj2[dataIndx];return(dataType(val1,val2)*dir)}function sort_float(obj1,obj2,dataIndx,dir){var val1=(obj1[dataIndx]+"").replace(/,/g,"");var val2=(obj2[dataIndx]+"").replace(/,/g,"");val1=val1?parseFloat(val1):0;val2=val2?parseFloat(val2):0;return((val1-val2)*dir)}function sort_string(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?val1:"";val2=val2?val2:"";var ret=0;if(val1>val2){ret=1}else{if(val1<val2){ret=-1}}return(ret*dir)}function sort_stringi(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?val1.toUpperCase():"";val2=val2?val2.toUpperCase():"";var ret=0;if(val1>val2){ret=1}else{if(val1<val2){ret=-1}}return(ret*dir)}data=data.sort(sort_composite)}$.measureTime(innerSort,"innerSort")};fn._refreshHeaderSortIcons=function(){var thisOptions=this.options,DM=thisOptions.dataModel,sorters=this.sorters,thisColModel=this.colModel;var $header=this.$header;var $pQuery_cols=$header.find(".pq-grid-col");$pQuery_cols.removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active");$header.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");for(var i=0;i<sorters.length;i++){var sorter=sorters[i];var dataIndx=sorter.dataIndx;var colIndx=this.getColIndx({dataIndx:dataIndx});var dir=sorter.dir;var addClass="ui-state-active pq-col-sort-"+(dir=="up"?"asc":"desc");var cls2="ui-icon ui-icon-triangle-1-"+(dir=="up"?"n":"s");$header.find(".pq-grid-col[pq-grid-col-indx="+colIndx+"]").addClass(addClass);$header.find(".pq-grid-col[pq-grid-col-indx="+colIndx+"] .pq-col-sort-icon").addClass(cls2)}};fn.getHeaderColumnFromTD=function($td){var colIndx=$td.attr("pq-grid-col-indx");if(colIndx==null){return}var column=this.colModel[colIndx];return column};fn.getIndxInSorters=function(dataIndx){var sorters=this.sorters;for(var i=0,len=sorters.length;i<len;i++){if(sorters[i].dataIndx==dataIndx){return i}}return -1};fn._simulateEvent=function(event,simulatedType){if(event.originalEvent.touches.length>1){return}console.log("simulatedType "+simulatedType);event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)};fn._getTblSingle=function(rowIndxPage,colIndx){var $tbl=this.$tbl,colIndx=(colIndx!=null)?colIndx:0,thisOptions=this.options,freezeCols=thisOptions.freezeCols,freezeRows=thisOptions.freezeRows;if($tbl!=undefined){if($tbl.length==4){if(rowIndxPage>=freezeRows&&colIndx>=freezeCols){$tbl=$($tbl[3])}else{if(rowIndxPage>=freezeRows&&colIndx<freezeCols){$tbl=$($tbl[2])}else{if(rowIndxPage<freezeRows&&colIndx>=freezeCols){$tbl=$($tbl[1])}else{$tbl=$($tbl[0])}}}}else{if($tbl.length==2){if(rowIndxPage>=freezeRows&&colIndx>=freezeCols){$tbl=$($tbl[1])}else{$tbl=$($tbl[0])}}else{$tbl=$($tbl[0])}}}return $tbl};fn._onKeyDownSheet=function(evt,ui){var keyCodes={z:"90",y:"89",c:"67",v:"86"};if(evt.ctrlKey&&evt.keyCode==keyCodes.z){if(this.iHistory.undo()){}return false}else{if(evt.ctrlKey&&evt.keyCode==keyCodes.y){if(this.iHistory.redo()){}return false}else{if(evt.ctrlKey&&evt.keyCode==keyCodes.c){if(this.History.redo()){this.refresh()}return false}}}};fn._OnMouseDownDragSeries=function(evt,ui){this.pqSheet.mouseDownDragSeries=true;return true};fn._onCellUnSelectSheet=function(evt,ui){};fn._onCellSelectSheet=function(evt,ui){if(this.sCells.getSelection().length==1){this.bb(ui.rowIndx,ui.colIndx)}};fn.getLargestRowCol=function(arr){var rowIndx,colIndx;for(var i=0;i<arr.length;i++){var sel=arr[i];var rowIndx2=sel.rowIndx;if(rowIndx==null){rowIndx=sel.rowIndx}else{if(rowIndx2>rowIndx){rowIndx=rowIndx2}}rowIndx=sel.rowIndx}};fn.bb=function(rowIndx,colIndx){var $td=this.getCell({rowIndx:rowIndx,colIndx:colIndx});if($td){$td.css({outline:"2px solid steelblue"});var left=$td[0].offsetLeft+$td[0].offsetWidth;var top=$td[0].offsetTop+$td[0].offsetHeight;this.$dragSeries.css({left:left-4,top:top-5,display:""});this.$dragSeries.data({rowIndx:rowIndx,colIndx:colIndx,left:left,top:top})}else{this.$dragSeries.css({display:"none"})}};fn._onLoad=function(){this.options.dataModel.postData=""};fn._onRefreshSheet=function(){var data=this.$dragSeries.data();if(data){var rowIndx=data.rowIndx,colIndx=data.colIndx,left=data.left,top=data.top;this.bb(rowIndx,colIndx)}};fn.bringCellToView=function(obj){this._bringCellToView(obj)};fn._setUrl=function(queryStr){this.options.dataModel.getUrl=function(){return{url:this.url+((queryStr!=null)?queryStr:"")}}};fn.getFilterData=function(){var CM=this.colModel,CMLength=CM.length,conditions=$.paramquery.filter.getConditions,TRconditions=$.paramquery.filter.getTRConditions,arrS=[];for(var i=0;i<CMLength;i++){var column=CM[i],dataIndx=column.dataIndx,filter=column.filter;if(filter&&filter.on){var value=filter.value,condition=filter.condition;if($.inArray(condition,conditions)!=-1){if((value==null||value==="")){if($.inArray(condition,TRconditions)!=-1){continue}}else{value=(value+"").toUpperCase()}arrS.push({dataIndx:dataIndx,value:value,condition:condition})}}}return arrS};fn.filterLocalData=function(){var arrS=this.getFilterData(),options=this.options,DM=options.dataModel,data1=DM.data,data2=this.dataUF,arr1=[],arr2=[],FM=options.filterModel,FMmode=FM?FM.mode:null;var isMatch=function(rowData,arrS,FMmode){if(arrS.length==0){return true}for(var i=0;i<arrS.length;i++){var s=arrS[i],dataIndx=s.dataIndx,text=s.value,condition=s.condition,cd=rowData[dataIndx],found=false;if(condition=="contain"){cd=(cd+"").toUpperCase();if(cd.indexOf(text)!=-1){found=true}}else{if(condition=="notcontain"){cd=(cd+"").toUpperCase();if(cd.indexOf(text)==-1){found=true}}else{if(condition=="empty"){cd=$.trim(cd+"");if(cd.length==0){found=true}}else{if(condition=="notempty"){cd=$.trim(cd+"");if(cd.length>0){found=true}}else{if(condition=="begin"){cd=(cd+"").toUpperCase();if(cd.indexOf(text)==0){found=true}}else{if(condition=="end"){cd=(cd+"").toUpperCase();var lastIndx=cd.lastIndexOf(text);if(lastIndx!=-1&&(lastIndx+text.length==cd.length)){found=true}}else{if(condition=="regexp"){if(text.test(cd)){found=true}}else{if(condition=="equal"){cd=(cd+"").toUpperCase();if(cd==text){found=true}}else{if(condition=="notequal"){cd=(cd+"").toUpperCase();if(cd!=text){found=true}}else{if(condition=="great"&&cd>text){found=true}else{if(condition=="less"&&cd<text){found=true}}}}}}}}}}}if(FMmode=="OR"&&found){return true}if(FMmode=="AND"&&!found){return false}}if(FMmode=="AND"){return true}else{if(FMmode=="OR"){return false}}};if(!data2){data2=this.dataUF=[]}if(data1){if(FM.on&&FMmode){for(var i=0,len=data1.length;i<len;i++){var rowData=data1[i];if(isMatch(rowData,arrS,FMmode)){arr1.push(rowData)}else{arr2.push(rowData)}}for(var i=0,len=data2.length;i<len;i++){var rowData=data2[i];if(isMatch(rowData,arrS,FMmode)){arr1.push(rowData)}else{arr2.push(rowData)}}}else{for(var i=0,len=data1.length;i<len;i++){var rowData=data1[i];arr1.push(rowData)}for(var i=0,len=data2.length;i<len;i++){var rowData=data2[i];arr1.push(rowData)}}DM.data=arr1;this.dataUF=arr2}else{DM.data=[]}};fn._onDataAvailable=function(){var thisOptions=this.options,FM=thisOptions.filterModel;if(FM&&FM.on&&thisOptions.dataModel.location=="local"){this.filterLocalData()}};fn._setScrollVLength=function(data){var GM=this.options.groupModel;data=(GM)?this.dataGM:data;this._super.call(this,data)};$.widget("paramquery.pqGrid",$.paramquery._pqGrid,fn);$.paramquery.pqGrid.regional={};$.paramquery.pqGrid.regional.en=fn._regional})(jQuery);(function(a){a.paramquery=(a.paramquery==null)?{}:a.paramquery;a.paramquery.pqgrid=(a.paramquery.pqgrid==null)?{}:a.paramquery.pqgrid;a.paramquery.pqgrid.exportToExcel=function(f){var g=this,c=(f.urlPost===undefined)?f.url:f.urlPost,d=f.url,b=(f.sheetName==null)?"pqGrid":f.sheetName,j=f.format,h=function(){var q=g.colModel,l=q.length,w=g.options,x=w.dataModel,t=x.data,m=t.length,p=[];var u=[];for(var s=0;s<l;s++){var o=q[s];if(!o.hidden){u.push('<Column ss:AutoFitWidth="1"  ss:Width="'+o.width+'" />')}}u.push("<Row>");for(var s=0;s<l;s++){var o=q[s];if(!o.hidden){u.push('<Cell><Data ss:Type="String">'+o.title+"</Data></Cell>")}}u.push("</Row>");u=u.join("\n");for(var s=0;s<m;s++){var n=t[s];p.push("<Row>");for(var r=0;r<l;r++){var o=q[r];if(!o.hidden){var v=o.dataIndx;p.push('<Cell><Data ss:Type="String"><![CDATA['+n[v]+"]]></Data></Cell>")}}p.push("</Row>")}p=p.join("\n");var k=['<?xml version="1.0"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"',' xmlns:o="urn:schemas-microsoft-com:office:office"',' xmlns:x="urn:schemas-microsoft-com:office:excel"',' xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"',' xmlns:html="http://www.w3.org/TR/REC-html40">','<Worksheet ss:Name="',b,'">',"<Table>",u,p,"</Table>","</Worksheet>","</Workbook>"];return k.join("\n")},i=function(){var q=g.colModel,l=q.length,y=g.options,z=y.dataModel,t=z.data,m=t.length,k=[],u=[],p=[];for(var s=0;s<l;s++){var o=q[s];if(!o.hidden){var x=o.title.replace(/\"/g,'""');u.push('"'+x+'"')}}k.push(u.join(","));for(var s=0;s<m;s++){var n=t[s];for(var r=0;r<l;r++){var o=q[r];if(!o.hidden){var w=o.dataIndx;var v=n[w]+"";v=v.replace(/\"/g,'""');p.push('"'+v+'"')}}k.push(p.join(","));p=[]}return k.join("\n")};var e=(j=="xml")?h():i();a.ajax({url:c,type:"POST",cache:false,data:{extension:j,excel:e},success:function(k){var l=d+"?filename="+k;a(document.body).append("<iframe height='0' width='0' frameborder='0'  src="+l+"></iframe>")}})}})(jQuery);(function(b){var d=b.paramquery.cUCData=function(e){this.that=e;this.udata=[];this.ddata=[];this.adata=[]};var c=d.prototype;c.add=function(l){var h=this.that,g=this.adata,j=l.rowData,k=h.getRecId({rowData:j});for(var f=0,e=g.length;f<e;f++){var m=g[f];if(k!=null&&m.recId==k){throw ("primary key violation")}if(m.rowData==j){throw ("same data can't be added twice.")}}var l={recId:k,rowData:j};g.push(l)};c.update=function(r){var o=this.that,h=o.getRowData(r),m=o.getRecId({rowData:h}),p=r.dataIndx,q=r.oldVal,f=r.newVal,g=this.udata,e=false;if(m==null){return}for(var l=0,n=g.length;l<n;l++){var j=g[l];if(j.rowData==h&&j.dataIndx==p){e=true;if(j.oldVal==f){g.splice(l,1);var k={rowData:h,dataIndx:p,cls:"pq-cell-dirty"};o.removeClass(k)}else{j.newVal=f}break}}if(!e){var k={rowData:h,recId:m,dataIndx:p,newVal:f,oldVal:q};g.push(k);var k={rowData:h,dataIndx:p,cls:"pq-cell-dirty"};o.addClass(k)}};c["delete"]=function(l){var o=this.that,j=l.rowIndx,e=l.rowIndxPage,h=o.rowIndxOffset,j=(j==null)?(e+h):j,e=(e==null)?(j-h):e,f=o.options.pageModel.type,m=(f=="remote")?e:j,q=this.adata,p=this.ddata,g=o.getRowData(l);for(var k=0,n=q.length;k<n;k++){if(q[k].rowData==g){q.splice(k,1);return}}p.push({indx:m,rowData:g})};c.undeleteNotUsed=function(g){var f=this.ddata;var e=b.inArray(g,f);f.splice(e,1)};c.isDirty=function(){var h=this.that,f=this.udata,g=this.adata,e=this.ddata;if(f.length||g.length||e.length){return true}else{return false}};c.getChangesValue=function(){var o=this.that,e=this.udata,u=this.adata,p=this.ddata,h={updateList:[],addList:[],deleteList:[]},l=[],s=[],n=[],r=[];for(var j=0;j<e.length;j++){var g=e[j],k=g.recId,f=g.rowData;if(b.inArray(f,l)==-1){var t={};for(var q in f){if(q.indexOf("pq_")!=0){t[q]=f[q]}}l.push(f);s.push(t)}}for(var j=0;j<u.length;j++){var g=u[j],f=g.rowData,t={};for(var q in f){if(q.indexOf("pq_")!=0){t[q]=f[q]}}n.push(t)}for(var j=0,m=p.length;j<m;j++){var g=p[j],f=g.rowData,t={};for(var q in f){if(q.indexOf("pq_")!=0){t[q]=f[q]}}r.push(t)}h.updateList=s;h.addList=n;h.deleteList=r;return h};c.getChanges=function(){var n=this.that,e=this.udata,r=this.adata,o=this.ddata,h={updateList:[],addList:[],deleteList:[]},q=[],m=[],p=[];for(var j=0;j<e.length;j++){var g=e[j],k=g.recId,f=g.rowData;if(b.inArray(f,q)==-1){q.push(f)}}for(var j=0;j<r.length;j++){var g=r[j],f=g.rowData;m.push(f)}for(var j=0,l=o.length;j<l;j++){var g=o[j],f=g.rowData;if(!b.inArray(f,p)){p.push(f)}}h.updateList=q;h.addList=m;h.deleteList=p;return h};c.getChangesRaw=function(){var h=this.that,f=this.udata,g=this.adata,e=this.ddata,i={updateList:[],addList:[],deleteList:[]};i.updateList=f;i.addList=g;i.deleteList=e;return i};c.getChangesOld=function(){var l=this.that,g=this.udata,t=this.adata,o=this.ddata,x={updateList:[],addList:[],deleteList:[]},v=[],s=[],h=[];for(var q=0;q<g.length;q++){var k=g[q],m=k.rowData,n=k.dataIndx,u=k.newVal,f=false,w=l.getRecId({rowData:m});if(w!=null){for(var p=0;p<v.length;p++){if(v[p].recId==w){f=true;v[p]["fieldList"].push({dataIndx:n,value:u});break}}if(!f){v.push({recId:w,fieldList:[{dataIndx:n,value:u}]})}}}for(var q=0;q<t.length;q++){var k=t[q],m=k.rowData;var e=[];for(var n in m){e.push({dataIndx:n,value:m[n]})}s.push({fieldList:e})}for(var q=0,r=o.length;q<r;q++){var k=o[q],m=k.rowData,w=l.getRecId({rowData:m});h.push({recId:w,rowData:m})}x.updateList=v;x.addList=s;x.deleteList=h;return x};c.commit=function(u){var o=this.that,s=o.options.dataModel,g=o.colModel,D=s.recIndx,h=this.udata,E=this.adata,w=this.ddata;if(u==null){for(var B=0,C=h.length;B<C;B++){var n=h[B],t=n.dataIndx,q=n.rowData;o.removeClass({rowData:q,dataIndx:t,cls:"pq-cell-dirty"})}this.udata=[];this.ddata=[];this.adata=[]}else{var v=u.type,r=u.rows,F=[];if(v=="add"){for(var z=0;z<r.length;z++){var m=r[z];for(var B=0,C=E.length;B<C;B++){var q=E[B].rowData,e=true;for(var y=0;y<g.length;y++){var f=g[y],A=f.hidden,t=f.dataIndx;if(A||(t==D)){continue}if(q[t]!=m[t]){e=false;break}}if(e){q[D]=m[D];F.push(q)}}}var p=[];for(var B=0;B<E.length;B++){var q=E[B].rowData;if(b.inArray(q,F)==-1){p.push(E[B])}}this.adata=p}else{if(v=="update"){for(var B=0,C=h.length;B<C;B++){var q=h[B].rowData;if(b.inArray(q,F)!=-1){continue}for(var z=0;z<r.length;z++){var m=r[z];if(q[D]==m[D]){F.push(q);for(var y=0;y<g.length;y++){var f=g[y],A=f.hidden,t=f.dataIndx;if(m[t]!==undefined){o.removeClass({rowData:q,dataIndx:t,cls:"pq-cell-dirty"});q[t]=m[t]}}}}}var x=[];for(var B=0;B<h.length;B++){var q=h[B].rowData;if(b.inArray(q,F)==-1){x.push(h[B])}}this.udata=x}else{if(v=="delete"){for(var B=0,C=w.length;B<C;B++){var q=w[B].rowData;for(var z=0;z<r.length;z++){var m=r[z];if(q[D]==m[D]){F.push(q)}}}var l=[];for(var B=0;B<w.length;B++){var q=w[B].rowData;if(b.inArray(q,F)==-1){l.push(w[B])}}this.ddata=l}}}}o.refreshView()};c.rollback=function(o){var k=this.that,n=k.options.dataModel,q=k.options.pageModel,f=q.type,s=(o&&(o.refreshView!=null))?o.refreshView:true,r=(o&&(o.type!=null))?o.type:null,B=n.data,x=n.recIndx,e=this.udata,t=this.ddata,y=this.adata;if(r==null||r=="update"){for(var v=0,w=e.length;v<w;v++){var h=e[v],z=h.recId,l=h.rowData,m=h.dataIndx;if(z==null){continue}l[m]=h.oldVal;k.removeClass({rowData:l,dataIndx:m,cls:"pq-cell-dirty"})}this.udata=[]}if(r==null||r=="delete"){for(var v=t.length-1;v>=0;v--){var h=t[v],A=h.indx,l=h.rowData;B.splice(A,0,l);if(f=="remote"){q.totalRecords++}}this.ddata=[]}if(r==null||r=="add"){for(var v=0,w=y.length;v<w;v++){var h=y[v],l=h.rowData;for(var u=0,g=B.length;u<g;u++){if(B[u]==l){var p=B.splice(u,1);if(p&&p.length&&f=="remote"){q.totalRecords--}break}}}this.adata=[]}if(s){k.refreshView()}};var a=b.paramquery.pqGrid.prototype;a.getChanges=function(f){this.quitEditMode();if(f){var e=f.format;if(e){if(e=="byVal"){return this.iUCData.getChangesValue()}else{if(e=="raw"){return this.iUCData.getChangesRaw()}}}}return this.iUCData.getChanges()};a.rollback=function(e){this.quitEditMode();this.iUCData.rollback(e)};a.isDirty=function(){return this.iUCData.isDirty()};a.commit=function(e){this.quitEditMode();this.iUCData.commit(e)};a._getRowIndx=function(){var j=this;var f=j.selection({type:"row",method:"getSelection"});if(f&&f.length>0){var i=f[0].rowIndx,l=j.rowIndxOffset,h=j.options.pageModel,g=h.type,e=i-l,k=h.rPP;if(g){if(e>=0&&e<k){return i}}else{return i}}else{return null}};a._updateRowRemote=function(g){var e=this,f=g.rowData;f.pq_oper="edit";e.options.dataModel.postDataOnce=f;e.refreshDataAndView()};a._updateRowLocal=function(j){var m=this,h=j.rowIndx,e=j.rowData,l=m.options.dataModel.data[h],g=m.colModel;for(var k=0;k<g.length;k++){var f=g[k],n=f.dataIndx;l[n]=e[n]}m.refreshRow({rowIndx:h})};a._fillForm=function(p){var s=this,v=s.options.dataModel,u=s.options.pageModel,f=u.type,q=v.data,k=s.colModel,n=s.rowIndxOffset,e=(p.rowIndxPage==null)?p.rowIndx-n:p.rowIndxPage,m=(p.rowIndx==null)?e+n:p.rowIndx,r=(f=="remote")?e:m,j=q[r];this.rowData=j;this.$crudDialog.dialog("option","title","Edit Record ("+(m+1)+")");var l=this.$crudForm;for(var o=0;o<k.length;o++){var h=k[o],t=h.dataIndx,g=j[t];l.find("*[name='"+t+"']").val(g)}};a.updateRow=function(i){var h=this,g=h.options.dataModel,e=g.location,f=this;f._updateRowLocal(i)};a.openEditForm=function(k){var i=this,g=this;var h=k.rowIndx,l=k.title,l=l?l.replace("{0}",(h+1)):"Edit Record ("+(h+1)+")";if(h!=null){this.createDialog();var f=this.$crudDialog;var j=this.createForm({oper:"edit"});var e=b(j).appendTo(f);this.$crudForm=e;this.crudEditMode=true;g._fillForm({rowIndx:h});this.$crudDialog.dialog({title:l,buttons:{Update:function(){var n=i.options.dataModel,m=i.colModel;if(i._trigger("crudFormUpdate",{$form:g.$frm,dataModel:n,colModel:m})==false){return}var p=g.getFormData(g.$crudForm),o=g._getRowIndx();g.updateRow({rowIndx:o,rowData:p});b(this).dialog("close")},Cancel:function(){if(i._trigger("formCancel",{$frm:g.$frm})==false){return}b(this).dialog("close")}}}).dialog("open");this._trigger("openEditForm",null,{$frm:e,$dialog:f})}};a.getRecId=function(h){var f=this,e=f.options.dataModel;h.dataIndx=e.recIndx;var g=f.getCellData(h);return g};a.getCellData=function(g){var f=this.getRowData(g),e=g.dataIndx;return f[e]};a.getRowData=function(m){var s=m.rowData;if(s!=null){return s}var t=this.options.dataModel,r=this.options.pageModel,g=r.type,f=t.recIndx,p=m.recId,n=t.data;if(p!=null){for(var l=0,q=n.length;l<q;l++){var h=n[l];if(h[f]==p){return h}}}else{var k=m.rowIndx,e=m.rowIndxPage,j=this.rowIndxOffset,k=(k!=null)?k:e+j,e=(e!=null)?e:k-j,o=(g=="remote")?e:k,h=n[o];return h}};a.deleteRow=function(e){this._deleteLocal(e)};a._deleteLocal=function(k){var n=this,i=k.rowIndx,p=k.effect,q=n.options,r=q.dataModel,o=q.pageModel,e=o.type;if(i!=null){var m=(e=="remote")?(i-this.rowIndxOffset):i,j=r.data,f=q.track,f=(k.track!=null)?k.track:f;if(f){this.iUCData["delete"]({rowIndx:i});if(!k.skipHistory){var h=this.getRowData({rowIndx:i});n.iHistory.push({type:"delete",rowData:h,rowIndx:i})}}if(p){var n=this,l=this.getRow({rowIndx:i});if(l){l.effect("fade",null,350,function(){var s=k.complete;if(s&&typeof s=="function"){s.call(n)}var t=j.splice(m,1);if(t&&t.length&&e=="remote"){o.totalRecords--}n.refreshView()})}}else{var g=j.splice(m,1);if(g&&g.length&&e=="remote"){o.totalRecords--}this.refreshView()}}};a._deleteRemote=function(i){var h=this,j=h.data,f=h.options.dataModel,l=h.rowIndxOffset,e=i-l,g=f.recIndx;var k={pq_oper:"delete"};k[g]=j[e][g];f.postDataOnce=k;h.refreshDataAndView()};a._onDialogOpen=function(){var g=this,f=this,h=this.$crudDialog.parent(".ui-dialog");b(".pq-dialog-buttonset",h).remove();if(this.crudEditMode==false){return}var e=b("<div style='' class='pq-dialog-buttonset'></div>").prependTo(b(".ui-dialog-buttonpane",h));this.prev=b("<button type='button' class='ui-corner-left'></button>").appendTo(e).button({icons:{primary:"ui-icon-circle-triangle-w"},text:false}).bind("click",function(j){var i=g.rowPrevSelect();f._fillForm({rowIndxPage:i})});this.prev.removeClass("ui-corner-all");this.next=b("<button type='button' class='ui-corner-right'></button>").appendTo(e).button({icons:{primary:"ui-icon-circle-triangle-e"},text:false}).bind("click",function(j){var i=g.rowNextSelect();f._fillForm({rowIndxPage:i})});this.next.removeClass("ui-corner-all")};a.getFormData=function(m){var k=this,l={},e=k.colModel;for(var g=0;g<e.length;g++){var h=e[g],f=h.dataIndx,j=m.find("*[name='"+f+"']");l[f]=j.val()}return l};a.createForm=function(g){var p=this,r=g.oper,t=p.colModel;var q=["<table align='center'>"];var B=[];for(var x=0,A=t.length;x<A;x++){var k=t[x],s=k.dataIndx;if(k.hidden){B.push("<input type='hidden' name='"+s+"' />")}else{var f="ui-widget-content ui-corner-all pq-field ",m=k.editor,h;if(k.dataType=="date"){f+="pq-editor-date "}if(m){var n=m.type,o=m.cls?m.cls:"",f=f+o,v=m.attr,u="name='"+s+"' "+(v?v:""),z=m.style?m.style:"";if(typeof n=="function"){h=n.call(p.element,{oper:r,cls:f,dataIndx:s,colModel:t})}else{if(n=="textarea"){h="<textarea class='"+f+"' "+u+" style='"+z+"'  ></textarea>"}else{if(n=="checkbox"){h="<input class='"+f+"' "+u+" style='"+z+"' type=checkbox />"}else{if(n=="select"){var l=m.options;h=["<select class='"+f+"' "+u+" style='"+z+"' >"];if(l){for(var w=0,y=l.length;w<y;w++){var e=l[w];h.push('<option value="'+e+'">'+e+"</option>")}}h.push("</select>");h=h.join("")}else{if(n==="textbox"){h="<input class='"+f+"' "+u+" style='"+z+"' type=text />"}else{if(typeof n=="string"){h=n}}}}}}}else{h="<input class='"+f+"' type=text name='"+s+"' />"}q.push("<tr>","<td class='pq-label'>",k.title,":</td>","<td>",h,"</td>","</tr>")}}q.push("</table>");return"<form class='pq-grid-form'>"+B.join("")+q.join("")+"</form>"};a.createDialog=function(){var k=this,h=this,i=k.options,e=k.colModel;var g=["<div style='display:none;' class=''></div>"];var j=g.join("");if(h.$crudDialog){h.$crudDialog.remove()}var f=b(j).appendTo(document.body);h.$crudDialog=f;h.$crudForm=this.$crudDialog.find("form");f.dialog({width:"auto",modal:true,open:function(){b(".ui-dialog").position({of:this.element});b(".ui-dialog").find('button:contains("Cancel")').button({icons:{primary:"ui-icon-close"}});b(".ui-dialog").find('button:contains("Add")').button({icons:{primary:"ui-icon-disk"}});b(".ui-dialog").find('button:contains("Update")').button({icons:{primary:"ui-icon-disk"}});k._trigger("crudFormOpen",null,{$form:h.$crudForm,colModel:e,dataModel:i.dataModel})},close:function(){window.setTimeout(function(){h.$crudDialog.dialog("destroy")},1)},autoOpen:false});f.parent(".ui-dialog").addClass("pq-grid-dialog");f.on("dialogopen",function(l,m){h._onDialogOpen()});return f};a.openAddForm=function(){var h=this,g=this;this.crudEditMode=false;this.createDialog();var f=this.$crudDialog;var i=this.createForm({oper:"add"});var e=b(i).appendTo(f);this.$crudForm=e;f.dialog({title:"Add Record",buttons:[{text:"Add",click:function(){var k=h.options.dataModel,j=h.colModel;if(h._trigger("openAdd",{$form:g.$crudForm,dataModel:k,colModel:j})==false){}else{var l=g.getFormData(g.$crudForm);g.addRow({rowData:l})}b(this).dialog("close")}},{text:"Cancel",click:function(){b(this).dialog("close")}}]});f.dialog("open")};a.addRow=function(f){var e=this;return e._addLocal(f)};a._addLocal=function(m){var o=this,i=m.rowData,k=m.rowIndx,e=m.rowIndxPage,h=o.options,q=h.dataModel,p=h.pageModel,f=p.type,g=h.track,g=(m.track!=null)?m.track:g,l=q.data;if(l==null){return null}if(g){this.iUCData.add({rowData:i});if(!m.skipHistory){o.iHistory.push({type:"add",rowData:i})}}if(k==null&&e==null){l.push(i)}else{var j=this.rowIndxOffset,k=(k==null)?(e+j):k,e=(e==null)?(k-j):e,n=(f=="remote")?e:k;l.splice(n,0,i)}if(f=="remote"){p.totalRecords++}this.refreshView();if(k==null){return l.length-1}else{return k}};a._addRemote=function(g){var e=this,f=g.rowData;f.pq_oper="add";e.options.dataModel.postDataOnce=f}})(jQuery);(function(b){var a={};a.options={items:[],gridInstance:null};a._create=function(){var r=this,h=this.options,o=h.gridInstance,g=o.colModel,s=h.items,e=this.element,n=e.closest(".pq-grid");e.addClass("pq-toolbar");for(var A=0,D=s.length;A<D;A++){var F=s[A],k=F.type,E=F.icon,h=F.options,p=F.label,u=F.listeners,v=F.cls,d="ui-corner-all "+(v?v:""),q=F.style,C=q?'style="'+q+'"':"",m=F.attr,x=m?m:"",t;if(k=="textbox"){t=b("<input type='text' class='"+d+"' "+x+" "+C+">").appendTo(e)}else{if(k=="checkbox"){t=b("<input type='checkbox' class='"+d+"' "+x+" "+C+">").appendTo(e)}else{if(k=="separator"){b("<span class='pq-separator '"+d+"' "+x+" "+C+"></span>").appendTo(e)}else{if(k=="button"){t=b("<button type='button' class='"+d+"' "+x+" "+C+">"+p+"</button>").button({text:p?true:false,icons:{primary:E}}).appendTo(e)}else{if(k=="select"){var h=F.options?F.options:[];if(typeof h==="function"){h=h.call(o.element,{colModel:g})}var f=["<select class='"+d+"' "+x+" "+C+" >"];for(var z=0,B=h.length;z<B;z++){var c=h[z];if(typeof c=="object"){for(var w in c){f.push('<option value="'+w+'">'+c[w]+"</option>")}}else{f.push("<option>"+c+"</option>")}}f.push("</select>");f=f.join("");t=b(f).appendTo(e)}else{if(typeof k=="string"){t=b(k).appendTo(e)}else{if(typeof k=="function"){var f=k.call(o,{colModel:g,cls:d});t=b(f).appendTo(e)}}}}}}}if(u){for(var z=0;z<u.length;z++){var l=u[z];for(var y in l){t.bind(y,l[y])}}}}};a._destroy=function(){this.element.empty().removeClass("pq-toolbar").enableSelection()};a._disable=function(){if(this.$disable==null){this.$disable=b("<div class='pq-grid-disable'></div>").css("opacity",0.2).appendTo(this.element)}};a._enable=function(){if(this.$disable){this.element[0].removeChild(this.$disable[0]);this.$disable=null}};a._setOption=function(c,d){if(c=="disabled"){if(d==true){this._disable()}else{this._enable()}}};b.widget("paramquery.pqToolbar",a)})(jQuery);